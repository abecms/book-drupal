(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{152:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return l})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return p}));var a=n(1),r=n(9),i=(n(0),n(177)),o={},l={id:"dynamisation/modules",title:"modules",description:"# Modules",source:"@site/docs/dynamisation/modules.md",permalink:"/docs/dynamisation/modules",sidebar:"docs",previous:{title:"ckeditor",permalink:"/docs/dynamisation/ckeditor"},next:{title:"domains",permalink:"/docs/dynamisation/domains"}},c=[{value:"Core",id:"core",children:[{value:"statistics",id:"statistics",children:[]}]},{value:"Contrib",id:"contrib",children:[{value:"Install and activate a contrib module",id:"install-and-activate-a-contrib-module",children:[]},{value:"Ajax loader",id:"ajax-loader",children:[]},{value:"color field",id:"color-field",children:[]},{value:"cookieconsent",id:"cookieconsent",children:[]},{value:"simple popup blocks",id:"simple-popup-blocks",children:[]},{value:"Simplenews",id:"simplenews",children:[]},{value:"Pathauto",id:"pathauto",children:[]},{value:"Metatag",id:"metatag",children:[]},{value:"ElasticSearch",id:"elasticsearch",children:[]},{value:"Videos transcoding",id:"videos-transcoding",children:[]},{value:"Redis",id:"redis",children:[]},{value:"Webform",id:"webform",children:[]},{value:"Webform recaptcha",id:"webform-recaptcha",children:[]},{value:"Datalayer",id:"datalayer",children:[]},{value:"AMP",id:"amp",children:[]},{value:"flag",id:"flag",children:[]},{value:"Site settings",id:"site-settings",children:[]},{value:"hierarchical_term_formatter",id:"hierarchical_term_formatter",children:[]},{value:"taxonomy_menu",id:"taxonomy_menu",children:[]},{value:"Maestro : business process workflow",id:"maestro--business-process-workflow",children:[]},{value:"RGPD : Tarte au citron",id:"rgpd--tarte-au-citron",children:[]},{value:"Store Locator",id:"store-locator",children:[]},{value:"Shield",id:"shield",children:[]},{value:"Commerce",id:"commerce",children:[]}]},{value:"Custom",id:"custom",children:[{value:"Instagram",id:"instagram",children:[]},{value:"view_filter",id:"view_filter",children:[]},{value:"simplenews_ajax",id:"simplenews_ajax",children:[]},{value:"facebook_feeds_block",id:"facebook_feeds_block",children:[]},{value:"view unpublished",id:"view-unpublished",children:[]},{value:"Robot",id:"robot",children:[]},{value:"Views Reference Field",id:"views-reference-field",children:[]}]}],s={rightToc:c};function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h1",{id:"modules"},"Modules"),Object(i.b)("h2",{id:"core"},"Core"),Object(i.b)("h3",{id:"statistics"},"statistics"),Object(i.b)("p",null,"Un patch a \xe9t\xe9 cr\xe9\xe9 pour le projet \"Consommateurs & Citoyen\". Ce patch permet de r\xe9aliser des stats sur toutes les entit\xe9s et pas seulement les nodes. De plus, l'appel ajax d'incr\xe9mentation de la vue renvoie le compte de l'entit\xe9."),Object(i.b)("h2",{id:"contrib"},"Contrib"),Object(i.b)("h3",{id:"install-and-activate-a-contrib-module"},"Install and activate a contrib module"),Object(i.b)("h4",{id:"install"},"Install"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Never download a zip file or a tar.gz file to install a module")),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Find your module - ie: ",Object(i.b)("inlineCode",{parentName:"li"},"https://www.drupal.org/project/search_api_synonym")),Object(i.b)("li",{parentName:"ol"},"Click on version link you need at the bottom of the page - ie: ",Object(i.b)("inlineCode",{parentName:"li"},"8.x-1.2")),Object(i.b)("li",{parentName:"ol"},"Copy the composer command to install the command - ie: ",Object(i.b)("inlineCode",{parentName:"li"},"composer require 'drupal/search_api_synonym:^1.2'")),Object(i.b)("li",{parentName:"ol"},"Run this command at the root of the project")),Object(i.b)("p",null,"Note: The module is installed but not active."),Object(i.b)("h4",{id:"activate"},"Activate"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Got to admin of your project - ",Object(i.b)("inlineCode",{parentName:"li"},"/admin/modules")),Object(i.b)("li",{parentName:"ol"},"Search you module"),Object(i.b)("li",{parentName:"ol"},"Select it and click on install"),Object(i.b)("li",{parentName:"ol"},"Drupal will activate this module")),Object(i.b)("h3",{id:"ajax-loader"},"Ajax loader"),Object(i.b)("p",null,"Pour remplacer le loader ajax drupal par un custom loader il faut :\n1. le module Ajax Loader - ",Object(i.b)("inlineCode",{parentName:"p"},"https://www.drupal.org/project/ajax_loader"),"\n1. On copie le repertoire ",Object(i.b)("inlineCode",{parentName:"p"},"modules/contrib/src/Plugin/ajax_loader")," dans module le module customization ",Object(i.b)("inlineCode",{parentName:"p"},"public/sites/default/modules/custom/customization/src/Plugin/ajax_loader"),"\n1. Les custom Loader commencent par ",Object(i.b)("inlineCode",{parentName:"p"},"Trobbernomduloader.php"),"\n1. Ne garder qu'un seul fichier php et le renommer du nom du loader voulu ",Object(i.b)("inlineCode",{parentName:"p"},"Trobbernomduclient.php")," et\nremplacer dans le fichier la class et la fonction pour ne pas provoquer de conflit avec le nom voulu.\n1. Dans la fonction ",Object(i.b)("inlineCode",{parentName:"p"},"setMarkup")," remplacer le ",Object(i.b)("inlineCode",{parentName:"p"},"return")," par votre loader. ie:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-php"}),"protected function setMarkup() {\n    return '<div class=\"preloader-drupal\"><div></div><div></div><div></div></div>';\n  }\n")),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Vider la cache depuis le B.O."),Object(i.b)("li",{parentName:"ol"},"dans l'admin ",Object(i.b)("inlineCode",{parentName:"li"},"admin/config/user-interface/ajax-loader")," Choisissez votre loader qui apparait dans la liste d\xe9roulante.")),Object(i.b)("h3",{id:"color-field"},"color field"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Installer le module color field (",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.drupal.org/project/color_field"}),"https://www.drupal.org/project/color_field"),")"),Object(i.b)("li",{parentName:"ol"},'Ajouter le champ color au contenu souhait\xe9 et le configurer dans la section "g\xe9rer l\'affichage du formulaire"')),Object(i.b)("h3",{id:"cookieconsent"},"cookieconsent"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Installer le module Cookie consent  (",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.drupal.org/project/cookieconsent"}),"https://www.drupal.org/project/cookieconsent"),")"),Object(i.b)("li",{parentName:"ol"},"Configurer les donn\xe9e de personnalisation (texte, lien vers la page de consentement, css)")),Object(i.b)("h3",{id:"simple-popup-blocks"},"simple popup blocks"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Installer le module simple popup blocks  (",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.drupal.org/project/simple_popup_blocks"}),"https://www.drupal.org/project/simple_popup_blocks"),")\nPermet de cr\xe9er des popin \xe0 partir de n'importe quel contenu (m\xeame les formulaires)")),Object(i.b)("h3",{id:"simplenews"},"Simplenews"),Object(i.b)("h4",{id:"ajouter-une-vue-sur-la-newsletter"},"Ajouter une vue sur la newsletter"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"function YOURTHEME_preprocess_simplenews_newsletter_body(&$variables) {\n$variables['latestnews'] = views_embed_view('latestnews', 'block_1');\n}\n")),Object(i.b)("p",null,"Create a template for the newsletter body simplenews-newsletter-body--","[newsletter_id]",".html.twig (newsletter_id = machine name). and add your view in it where you'd like to:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"{{ latestnews }}\n")),Object(i.b)("h4",{id:"configurer-simplenews"},"configurer simplenews"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"installer simplenews et swiftmailer"),Object(i.b)("li",{parentName:"ul"},"Cr\xe9er mytheme/templates/swiftmailer.html.twig et set mailsystem to use mytheme to render the emails."),Object(i.b)("li",{parentName:"ul"},"set mailsystem to use swiftmailers default formatter plugin"),Object(i.b)("li",{parentName:"ul"},"set mailsystem to use swiftmailers default sender plugin")),Object(i.b)("h3",{id:"pathauto"},"Pathauto"),Object(i.b)("h4",{id:"ajouter-des-conditions-sur-la-cr\xe9ation-des-patterns-de-pathauto"},"Ajouter des conditions sur la cr\xe9ation des patterns de pathauto"),Object(i.b)("p",null,"source: ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.deeson.co.uk/labs/dynamic-patterns-pathauto"}),"https://www.deeson.co.uk/labs/dynamic-patterns-pathauto")),Object(i.b)("p",null,"Si vous voulez par exemple cr\xe9er des patterns en fonction d'un type de contenu ",Object(i.b)("inlineCode",{parentName:"p"},"notice")," et d'une valeur de champ de taxonomie ",Object(i.b)("inlineCode",{parentName:"p"},"type_de_groupe")),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Cr\xe9er une classe de plugin de condition qui s'ajoutera aux conditions des patterns Pathauto"),Object(i.b)("li",{parentName:"ol"},"D\xe9clarer ce plugin \xe0 Drupal"),Object(i.b)("li",{parentName:"ol"},"Injecter ce plugin de condition dans le formulaire de cr\xe9ation/\xe9dition de pattern pathauto"),Object(i.b)("li",{parentName:"ol"},"Traiter la validation du formulaire de cr\xe9ation/\xe9dition de pattern de pathauto")),Object(i.b)("p",null,"Dans my_module/src/Plugin/Condition/ProgramGroup"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"<?php\n\nnamespace Drupal\\my_module\\Plugin\\Condition;\n\nuse Drupal\\Core\\Condition\\ConditionPluginBase;\nuse Drupal\\Core\\Entity\\EntityFieldManagerInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides a 'Program Group' condition.\n *\n * @Condition(\n *   id = \"program_group\",\n *   label = @Translation(\"Program Group\"),\n *   context = {\n *     \"node\" = @ContextDefinition(\"entity:node\", label = @Translation(\"Node\"))\n *   }\n * )\n */\nclass ProgramGroup extends ConditionPluginBase implements ContainerFactoryPluginInterface\n{\n\n  /**\n   * The entity field manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityFieldManagerInterface\n   */\n    protected $fieldManager;\n\n    /**\n     * Creates a new ProgramGroup instance.\n     *\n     * @param \\Drupal\\Core\\Entity\\EntityFieldManagerInterface $field_manager\n     *   The entity field manager.\n     * @param array $configuration\n     *   The plugin configuration, i.e. an array with configuration values keyed\n     *   by configuration option name. The special key 'context' may be used to\n     *   initialize the defined contexts by setting it to an array of context\n     *   values keyed by context names.\n     * @param string $plugin_id\n     *   The plugin_id for the plugin instance.\n     * @param mixed $plugin_definition\n     *   The plugin implementation definition.\n     */\n    public function __construct(EntityFieldManagerInterface $field_manager, array $configuration, $plugin_id, $plugin_definition)\n    {\n        parent::__construct($configuration, $plugin_id, $plugin_definition);\n        $this->fieldManager = $field_manager;\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition)\n    {\n        return new static(\n            $container->get('entity_field.manager'),\n            $configuration,\n            $plugin_id,\n            $plugin_definition\n        );\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public function buildConfigurationForm(array $form, FormStateInterface $form_state)\n    {\n        $form['program_group'] = [\n            '#title' => $this->t('Program Group'),\n            '#type' => 'select',\n            '#options' => $this->getProgramGroups(),\n            '#default_value' => $this->configuration['program_group'],\n            '#empty_value' => '',\n        ];\n        return parent::buildConfigurationForm($form, $form_state);\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public function submitConfigurationForm(array &$form, FormStateInterface $form_state)\n    {\n        $this->configuration['program_group'] = $form_state->getValue('program_group');\n        parent::submitConfigurationForm($form, $form_state);\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public function summary()\n    {\n        if ($program_group = $this->configuration['program_group']) {\n            $program_groups = $this->getProgramGroups();\n            $replace = ['@program_group' => $program_groups[$program_group]];\n\n            return $this->isNegated()\n                ? $this->t('Cette notice n\\'appartient pas au groupe @program_group', $replace)\n                : $this->t('Cette notice appartient au groupe @program_group', $replace);\n        }\n\n        // If no list is selected it means the program group should not be listed.\n        return $this->isNegated() ? $this->t('The program group is listed') : $this->t('The program group is not listed');\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public function evaluate()\n    {\n        $node = $this->getContextValue('node');\n\n        // This condition always fails if the node is not a notice.\n        if ($node->bundle() !== 'notice') {\n            return false;\n        }\n\n        // Check whether the node is listed on the selected list.\n        $node_program_group = $node->field_groupe_de_programmes[0]->entity->name->value;\n        if ($program_group = $this->configuration['program_group']) {\n            return $node_program_group == $program_group xor $this->isNegated();\n        }\n\n        // If no list is selected it means the event should not be listed.\n        return empty($node_program_group) xor $this->isNegated();\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public function defaultConfiguration()\n    {\n        return ['program_group' => ''] + parent::defaultConfiguration();\n    }\n\n    /**\n     * Retrieves the possible event lists.\n     *\n     * @return string[]\n     *   The list of possible event lists, keyed by their machine name.\n     */\n    public function getProgramGroups()\n    {\n        $existingTerms = \\Drupal::entityTypeManager()->getStorage('taxonomy_term')->loadTree('groupe_de_programmes');\n        $taxoArray = [];\n        foreach ($existingTerms as $existingTerm) {\n            $taxoArray[] = $existingTerm->name;\n        }\n\n        return $taxoArray;\n    }\n}\n")),Object(i.b)("p",null,"Dans my_module/config/schema/customization.schema.yml"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"condition.plugin.program_group:\n    type: condition.plugin\n    mapping:\n      program_group:\n        type: string\n")),Object(i.b)("p",null,"Dans my_module/my_module.module"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"\n/**\n * Implements hook_form_FORM_ID_alter().\n *\n * @see \\Drupal\\pathauto\\Form\\PatternEditForm\n */\nfunction customization_form_pathauto_pattern_form_alter(&$form, $form_state)\n{\n    /** @var \\Drupal\\pathauto\\Entity\\PathautoPattern $entity */\n    $entity = $form_state->getFormObject()->getEntity();\n\n    if ($entity->get('type') == 'canonical_entities:node') {\n        // Search the Pathauto pattern for our program_group condition.\n        foreach ($entity->getSelectionConditions() as $candidate) {\n            if ($candidate->getPluginId() == 'program_group') {\n                $condition = $candidate;\n                break;\n            }\n        }\n\n        // If we could not find a configured condition, create an empty one.\n        if (empty($condition)) {\n            /** @var \\Drupal\\Core\\Condition\\ConditionManager $condition_manager */\n            $condition_manager = \\Drupal::service('plugin.manager.condition');\n            $condition = $condition_manager->createInstance('program_group');\n        }\n\n        // Add the condition plugin form to the form, removing the negate checkbox.\n        $condition_form = $condition->buildConfigurationForm($form['pattern_container'], $form_state);\n        unset($condition_form['negate']);\n        $form['pattern_container'] += $condition_form;\n\n        // Add our submit handler after ::submit but before ::save.\n        $offset = array_search('::submit', $form['actions']['submit']['#submit']) + 1;\n        array_splice($form['actions']['submit']['#submit'], $offset, 0, 'customization_pathauto_pattern_submit');\n    }\n}\n\n/**\n * Submit handler for form ID pathauto_pattern_form.\n *\n * @see customization_form_pathauto_pattern_form_alter()\n */\nfunction customization_pathauto_pattern_submit($form, $form_state)\n{\n    /** @var \\Drupal\\pathauto\\Entity\\PathautoPattern $entity */\n    $entity = $form_state->getFormObject()->getEntity();\n\n    if ($program_group = $form_state->getValue('program_group')) {\n        $entity->addSelectionCondition([\n        'id' => 'program_group',\n        'program_group' => $program_group,\n        'negate' => false,\n        'context_mapping' => [\n          'node' => 'node',\n        ],\n      ]);\n    }\n}\n")),Object(i.b)("h4",{id:"permettre-de-g\xe9n\xe9rer-plusieurs-alias-pour-un-m\xeame-node-drupal-88"},"Permettre de g\xe9n\xe9rer plusieurs alias pour un m\xeame node (Drupal >8.8)"),Object(i.b)("p",null,"(bien penser \xe0 mettre le canonical sur la bonne URL racine). Cr\xe9er plusieurs URL pour un m\xeame node peut \xeatre pertinent.\nOn utilise le hook ",Object(i.b)("inlineCode",{parentName:"p"},"HOOK_pathauto_alias_alter")," :"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"function customization_pathauto_alias_alter(&$alias, array &$context)\n{\n    if (isset($context['data']['node']) && $context['data']['node']->bundle() === 'notice') {\n        $node = $context['data']['node'];\n        $typeProgramme = $node->field_type_de_programme[0]->entity->name->value;\n        $groupeProgramme = $node->field_groupe_de_programmes[0]->entity->name->value;\n\n        if ($typeProgramme === 'programme' &&  $groupeProgramme === 'unitaire') {\n            $parts = explode('/', $alias);\n            $playerAlias = $alias.'/player/'.strtolower($node->field_identifiant->value).'/'.$parts[2];\n            $pathAlias = \\Drupal\\path_alias\\Entity\\PathAlias::create([\n              'path' => '/node/'.$node->id(),\n              'alias' => $playerAlias,\n              'langcode' => 'fr'\n            ]);\n            $pathAlias->save();\n        }\n    }\n}\n")),Object(i.b)("h3",{id:"metatag"},"Metatag"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Installer le module metatag"),Object(i.b)("li",{parentName:"ul"},"Pour personnaliser un node, il suffit de cr\xe9er un nouveau champ de type metatag pour ce type de contenu. Automatiquement, il permettra de personnaliser les meta sur chaque node (dans l'\xe9dition du node menu metatag \xe0 droite)"),Object(i.b)("li",{parentName:"ul"},"pour placer l'image issue d'un champ du node qui est contenue dans un media : ",Object(i.b)("inlineCode",{parentName:"li"},"[node:field_visuel:entity:field_media_image:entity:url]")),Object(i.b)("li",{parentName:"ul"},"pour activer et configurer le partage Facebook et twitter :",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Activer les modules Metatag: Twitter Cards et Metatag: Open Graph"),Object(i.b)("li",{parentName:"ul"},"Aller sous admin/config/search/metatag/settings et activer les options Open Graph et Twitter Cards pour les entit\xe9s concern\xe9es"),Object(i.b)("li",{parentName:"ul"},"Puis modifier les metatag par d\xe9faut : sans /admin/config/search/metatag",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"pour l'entit\xe9  concern\xe9e cliquer sur modifier"),Object(i.b)("li",{parentName:"ul"},"ajouter la valeur souhait\xe9e pour les diff\xe9rents tag. Exemple pour le metatag MEDIA VIDEO, mettre ","[media:field_poster:large]"," pour la version large de l'url du poster")))))),Object(i.b)("h4",{id:"change--add-metatags-links-title-for-a-specific-page-in-a-controller"},"Change / add metatags, links, title for a specific page in a controller"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"make sure that the Metatag module doesn't have a global config for the tags you want to change"),Object(i.b)("li",{parentName:"ol"},"In your Controller, you may create a ",Object(i.b)("inlineCode",{parentName:"li"},"$htmlHead")," array. Then add your tags and links as follow (such an entry is composed by the array of data + a key (ie 'linkprevious'))")),Object(i.b)("p",null,"Consider the way we change the title of the page (",Object(i.b)("inlineCode",{parentName:"p"},"'#title' => 'R\xe9sultats de recherche - '.$input"),")"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"$htmlHead = [];\n$urlWithoutSort = str_replace('&sort='.$sort, '', \\Drupal::request()->getRequestUri());\n$htmlHead[] = [\n    [\n        '#tag' => 'meta',\n        '#attributes' => [\n            'name' => 'canonical',\n            'content' => $urlWithoutSort,\n        ],\n    ],\n    'tag'\n];\n\nif (true) {\n    $htmlHead[] = [\n        [\n            '#tag' => 'link',\n            '#attributes' => [\n                'rel' => 'next',\n                'href' => str_replace('&page='.$page, '', $urlWithoutSort).'&page='.($page + 1)\n            ],\n        ],\n        'linkprevious'\n    ];\n}\n\nif ($page && $page > 1) {\n    $htmlHead[] = [\n        [\n            '#tag' => 'link',\n            '#attributes' => [\n                'rel' => 'previous',\n                'href' => str_replace('&page='.$page, '', $urlWithoutSort).'&page='.($page - 1)\n            ],\n        ],\n        'linknext'\n    ];\n}\n\nreturn [\n    self::QTHEME => 'my_module_search_page',\n    '#q' => $input,\n    '#video' => (count($resultVideo[self::QHITS]) > 0) ? true : false,\n    '#audio' => (count($resultAudio[self::QHITS]) > 0) ? true : false,\n    '#article' => false,\n    '#children' => [\n        $resultVideo,\n        $resultAudio,\n    ],\n    '#attached' => [\n        'html_head' => $htmlHead\n    ],\n    '#title' => 'R\xe9sultats de recherche - '.$input\n];\n")),Object(i.b)("h3",{id:"elasticsearch"},"ElasticSearch"),Object(i.b)("p",null,"Note: ",Object(i.b)("inlineCode",{parentName:"p"},"http://letstoob.info/drupal-8/how-to-integrate-elasticsearch-6-3-0-with-drupal-8-5/")),Object(i.b)("p",null,"2 modules necessaires:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Elasticsearch connector - ",Object(i.b)("inlineCode",{parentName:"li"},"https://www.drupal.org/project/elasticsearch_connector")),Object(i.b)("li",{parentName:"ul"},"Search Api - ",Object(i.b)("inlineCode",{parentName:"li"},"https://www.drupal.org/project/search_api"))),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Go to ",Object(i.b)("inlineCode",{parentName:"li"},"admin/config/search/elasticsearch-connector")),Object(i.b)("li",{parentName:"ol"},"Click on ```Add Cluster````"),Object(i.b)("li",{parentName:"ol"},"Fill in ",Object(i.b)("inlineCode",{parentName:"li"},"name")," and URL ",Object(i.b)("inlineCode",{parentName:"li"},"http://localhost:9200")," ou ",Object(i.b)("inlineCode",{parentName:"li"},"http://nameofthedocker:9200")," if you use a docker elastic"),Object(i.b)("li",{parentName:"ol"},"Select ",Object(i.b)("inlineCode",{parentName:"li"},"Select this cluster default connection")),Object(i.b)("li",{parentName:"ol"},"Select ",Object(i.b)("inlineCode",{parentName:"li"},"Use multiple nodes connection")),Object(i.b)("li",{parentName:"ol"},"Click ",Object(i.b)("inlineCode",{parentName:"li"},"save"))),Object(i.b)("h3",{id:"videos-transcoding"},"Videos transcoding"),Object(i.b)("h4",{id:"cloudstack-trancoding"},"Cloudstack Trancoding"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"https://aws.amazon.com/blogs/networking-and-content-delivery/serverless-video-on-demand-vod-workflow/")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"If your s3 bucket is in north US-EAST (N. Virginia)"),Object(i.b)("li",{parentName:"ul"},"You need to apply this patch for s3fs_cors module for drupal cause this is the only region need to be http called without the region in URL"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingBucket.html#access-bucket-intro"))),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-php"}),"diff --git a/modules/contrib/s3fs_cors/src/Element/S3fsCorsFile.php b/modules/contrib/s3fs_cors/src/Element/S3fsCorsFile.php\nindex 5902592e..99616251 100644\n--- a/modules/contrib/s3fs_cors/src/Element/S3fsCorsFile.php\n+++ b/modules/contrib/s3fs_cors/src/Element/S3fsCorsFile.php\n@@ -231,7 +231,7 @@ public static function processManagedFile(&$element, FormStateInterface $form_st\n     // Pass the element parents through to the javascript function.\n     $js_settings['element_parents'] = implode('/', $element_parents);\n\n-    $js_settings['cors_form_action'] = $cors_config->get('s3fs_https') . '://s3-' . $config->get('region') . '.amazonaws.com/' . $bucket . '/';\n+    $js_settings['cors_form_action'] = $cors_config->get('s3fs_https') . '://s3' . '.amazonaws.com/' . $bucket . '/';\n\n     $field_name = $element['#field_name'];\n     if (!empty($element['#field_parents'])) {\n")),Object(i.b)("h4",{id:"cloudfront-and-s3-cors-config"},"CloudFront and S3 CORS config"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"https://stackoverflow.com/questions/50022326/amazon-s3-image-cors-issue")),Object(i.b)("h5",{id:"s3-cors-config"},"S3 CORS Config"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-xml"}),'<?xml version="1.0" encoding="UTF-8"?>\n<CORSConfiguration xmlns="http://s3.amazonaws.com/doc/2006-03-01/">\n<CORSRule>\n    <AllowedOrigin>http://*</AllowedOrigin>\n    <AllowedOrigin>https://*</AllowedOrigin>\n    <AllowedMethod>POST</AllowedMethod>\n    <MaxAgeSeconds>3000</MaxAgeSeconds>\n    <ExposeHeader>x-amz-version-id</ExposeHeader>\n    <AllowedHeader>*</AllowedHeader>\n</CORSRule>\n<CORSRule>\n    <AllowedOrigin>*</AllowedOrigin>\n    <AllowedMethod>GET</AllowedMethod>\n    <AllowedHeader>*</AllowedHeader>\n</CORSRule>\n<CORSRule>\n    <AllowedOrigin>*</AllowedOrigin>\n    <AllowedMethod>HEAD</AllowedMethod>\n    <AllowedHeader>*</AllowedHeader>\n</CORSRule>\n</CORSConfiguration>\n')),Object(i.b)("h5",{id:"cloudfront-config"},"CloudFront Config"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"https://stackoverflow.com/questions/50022326/amazon-s3-image-cors-issue")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Got to ",Object(i.b)("inlineCode",{parentName:"li"},"Behaviors")," tab"),Object(i.b)("li",{parentName:"ul"},"Select your distribution but ticking it and click on ",Object(i.b)("inlineCode",{parentName:"li"},"Edit")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"Cache Based on Selected Request Headers")," set to ",Object(i.b)("inlineCode",{parentName:"li"},"Whitelist")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"Whitelist Headers")," add ",Object(i.b)("inlineCode",{parentName:"li"},"Access-Control-Request-Headers"),", ",Object(i.b)("inlineCode",{parentName:"li"},"Access-Control-Request-Method")," and ",Object(i.b)("inlineCode",{parentName:"li"},"Origin")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"Object Caching")," tick ",Object(i.b)("inlineCode",{parentName:"li"},"Use Origin Cache Headers"))),Object(i.b)("h4",{id:"drupal-8-config"},"Drupal 8 Config"),Object(i.b)("h5",{id:"modules-1"},"Modules"),Object(i.b)("p",null,"You'll need 2 modules"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Run ",Object(i.b)("inlineCode",{parentName:"p"},"composer require 'drupal/s3fs:^3.0'"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Run ",Object(i.b)("inlineCode",{parentName:"p"},"composer require 'drupal/s3fs_cors:^1.0'"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"You'll need you AWS accesskey and secretkey")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Edit your ",Object(i.b)("inlineCode",{parentName:"p"},"settings.php")),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-php"}),"/** S3 configuration security */\n$settings['s3fs.access_key'] = 'youraccesskey';\n$settings['s3fs.secret_key'] = 'yoursecretkey';\n")))),Object(i.b)("h4",{id:"drupal-admin-config"},"Drupal admin config"),Object(i.b)("h5",{id:"media-type"},"Media Type"),Object(i.b)("p",null,"Structure > Types de media > Video > G\xe9rer les champs\nor ",Object(i.b)("inlineCode",{parentName:"p"},"admin/structure/media/manage/video/fields")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Vid\xe9o file > modifier"),Object(i.b)("li",{parentName:"ul"},"Repertoire du fichier must be ",Object(i.b)("inlineCode",{parentName:"li"},"input")),Object(i.b)("li",{parentName:"ul"},"Param\xe8tres du champs pick ",Object(i.b)("inlineCode",{parentName:"li"},"S3 File System"))),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"admin/structure/media/manage/video/form-display")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"for ",Object(i.b)("inlineCode",{parentName:"li"},"Video file")," pick ",Object(i.b)("inlineCode",{parentName:"li"},"S3fs Cors File Upload")),Object(i.b)("li",{parentName:"ul"},"Click on the toothed wheel to setup the FileSize Limit")),Object(i.b)("h5",{id:"s3-config"},"S3 Config"),Object(i.b)("p",null,"Go to ",Object(i.b)("inlineCode",{parentName:"p"},"https://yourdrupalsite/admin/config/media/s3fs")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Fill your bucket previsouly created from AWS cloudstack"),Object(i.b)("li",{parentName:"ul"},"Tick ```Always serve files from S3 via HTTPS````")),Object(i.b)("p",null,"Go to ",Object(i.b)("inlineCode",{parentName:"p"},"admin/config/media/s3fs/cors")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"tick ",Object(i.b)("inlineCode",{parentName:"li"},"https")," for ",Object(i.b)("inlineCode",{parentName:"li"},"Use Https/Http"))),Object(i.b)("h3",{id:"redis"},"Redis"),Object(i.b)("p",null,"Module Install - ",Object(i.b)("inlineCode",{parentName:"p"},"https://www.drupal.org/project/redis"),"\n1. Run ",Object(i.b)("inlineCode",{parentName:"p"},"composer require 'drupal/redis:^1.1'")," in docroot\n1. Activate module in Back Office\n1. Clear the cache\n1. Update ",Object(i.b)("inlineCode",{parentName:"p"},"settings.php")," with"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"/**\n * Redis Configuration.\n */\n$settings['redis.connection']['host'] =  'redis';\n$settings['redis.connection']['port'] = NULL;\n$settings['cache']['default'] = 'cache.backend.redis';\n$settings['redis.connection']['base'] = 8;\n\n $conf['chq_redis_cache_enabled'] = TRUE;\nif (isset($conf['chq_redis_cache_enabled']) && $conf['chq_redis_cache_enabled']) {\n  $settings['redis.connection']['interface'] = 'PhpRedis';\n  $settings['cache']['default'] = 'cache.backend.redis';\n  // Note that unlike memcached, redis persists cache items to disk so we can\n  // actually store cache_class_cache_form in the default cache.\n  $conf['cache_class_cache'] = 'Redis_Cache';\n}\n")),Object(i.b)("h3",{id:"webform"},"Webform"),Object(i.b)("h4",{id:"webform-children"},"Webform children"),Object(i.b)("p",null,"Les children de webform sont en fait des contenus d\xe9j\xe0 pr\xe9par\xe9s. On ne peut donc pas faire de ",Object(i.b)("inlineCode",{parentName:"p"},"{{for child in children")),Object(i.b)("p",null,"Pour remplacer, ajouter, supprimer une classe par ex. il suffit juste d'utiliser la fonction replace de twig !"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"{{ children | replace({'webform-flex ': \"webform-flex form__section \"}) | raw }}\n")),Object(i.b)("h4",{id:"conditionner-email-destinataire-selon-options-liste-d\xe9roulante"},"Conditionner email destinataire selon options liste d\xe9roulante"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Structure webform : Cr\xe9er un formulaire ou modifier le formulaire concern\xe9"),Object(i.b)("li",{parentName:"ol"},'Tab construire : ajouter un champ "liste de selection" et saisir les diff\xe9rentes options'),Object(i.b)("li",{parentName:"ol"},"Tab Handler :")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Ajouter un handler,"),Object(i.b)("li",{parentName:"ul"},'Dans "Envoyer A", s\xe9lectionner la liste cr\xe9er dans le formulaire'),Object(i.b)("li",{parentName:"ul"},"Pour chaque entr\xe9e de la liste saisir le destinataire concern\xe9")),Object(i.b)("h3",{id:"webform-recaptcha"},"Webform recaptcha"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Installer les modules Captcha et reCaptcha (",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.drupal.org/project/recaptcha"}),"https://www.drupal.org/project/recaptcha"),")"),Object(i.b)("li",{parentName:"ol"},"Aller dans configuration/personnes/Captcha et configurer Captcha et reCaptcha : Bien cr\xe9er un reCaptcha Google avec les bonnes cl\xe9s et autorisant les bons domaines."),Object(i.b)("li",{parentName:"ol"},"Aller dans le mod\xe8le du webform et ajouter un champ de type reCaptcha. Enjoy !"),Object(i.b)("li",{parentName:"ol"},"Important d\xe9cocher ",Object(i.b)("inlineCode",{parentName:"li"},"Local domain name validation")," dans la configuration drupal si il est cocher c\xf4t\xe9s serveur et inversement")),Object(i.b)("h3",{id:"datalayer"},"Datalayer"),Object(i.b)("h4",{id:"bug-lors-de-la-suppresion-dun-inscrit-newsletter-via-simplenews"},"Bug lors de la suppresion d'un inscrit newsletter (via simplenews)"),Object(i.b)("p",null,"attention patch \xe0 faire (manuel) sur datalayer.module pour \xe9viter un message d'erreur sur la suppression d'un inscrit newsletter (ligne 331) :"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"// For entities with an owner/author, get the username\nif ((empty($selected_properties) || array_key_exists('name', $properties))\n  && !isset($output_data['entityName']) && is_object($entity->uid && isset($entity->uid->entity->name))) {\n  $output_data['entityName'] = $entity->uid->entity->name->getString();\n}\n")),Object(i.b)("h3",{id:"amp"},"AMP"),Object(i.b)("p",null,"Permet de proposer la version AMP pour un node.\ncf. ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.drupal.org/docs/8/modules/accelerated-mobile-pages-amp/amp-version-82"}),"https://www.drupal.org/docs/8/modules/accelerated-mobile-pages-amp/amp-version-82")),Object(i.b)("p",null,"Installer ",Object(i.b)("inlineCode",{parentName:"p"},"composer require 'drupal/schema_metatag:^1.3'")," pour les micro-formats AMP"),Object(i.b)("p",null,"il y a actuellement un bug sur l'install de masterminds. Il faut faire :"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"composer require drupal/amp masterminds/html5:~2.3.0\n")),Object(i.b)("h3",{id:"flag"},"flag"),Object(i.b)("h4",{id:"cr\xe9er-ses-propres-liens-de-bookmarks-par-le-user"},"Cr\xe9er ses propres liens de bookmarks par le user"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"utiliser le module flag(/admin/structure/flags) et:")),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"cr\xe9er un type de block (ex. myOwnBookmarks)"),Object(i.b)("li",{parentName:"ol"},"Cr\xe9er un block de ce type (utilisons aussi myOwnBookmarks comme nom)"),Object(i.b)("li",{parentName:"ol"},"Cr\xe9er un flag (aussi myOwnBookmarks :) associ\xe9 au type de bloc myOwnBookmarks."),Object(i.b)("li",{parentName:"ol"},"Ajouter un champ link \xe0 ce flag (qu'on peut limiter \xe0 10 r\xe9p\xe9titions par ex. dans la config)"),Object(i.b)("li",{parentName:"ol"},"demandons l'affichage du flag en form popin puis sauvegardons le flag"),Object(i.b)("li",{parentName:"ol"},"Si on affiche le bloc myOwnBookmarks dans une r\xe9gion, on aura l'affichage du flag. au clic, popin avec le fomulaire de saisie des links !"),Object(i.b)("li",{parentName:"ol"},"Il ne reste plus qu'\xe0 cr\xe9er une vue qui affiche le contenu du flag, et \xe0 utiliser cette vue ou on veut.")),Object(i.b)("h4",{id:"bug-dans-le-module--httpswwwdrupalorgprojectflagissues2888268"},"bug dans le module : ",Object(i.b)("a",Object(a.a)({parentName:"h4"},{href:"https://www.drupal.org/project/flag/issues/2888268"}),"https://www.drupal.org/project/flag/issues/2888268")),Object(i.b)("p",null,"Pour que le bon template twig soit utilis\xe9 il faut faire \xe7a :\n",Object(i.b)("inlineCode",{parentName:"p"},"https://www.drupal.org/files/issues/2888268-8-views-link-doesnt-use-twig.patch")),Object(i.b)("h4",{id:"requetes-sql-de-stats"},"REQUETES SQL DE STATS"),Object(i.b)("p",null,"Les likes"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'  SELECT distinct nf.title, fc.count FROM flag_counts as fc\n  inner join flagging as f on fc.entity_id = f.entity_id\n  inner join node as n on fc.entity_id = n.nid\n  inner join node_field_data as nf on nf.vid = n.vid\n  where f.flag_id = "like"\n  order by count desc\n')),Object(i.b)("h3",{id:"site-settings"},"Site settings"),Object(i.b)("p",null,Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.drupal.org/project/site_settings"}),"https://www.drupal.org/project/site_settings")),Object(i.b)("p",null,"Cr\xe9er les configurations dont vous avez besoin.\nAller dans Manage Site setting pour cr\xe9er vos \xe9l\xe9ments\nAller dans site settings pour renseigner vos \xe9l\xe9ments"),Object(i.b)("p",null,"Pour les appeler depuis Twig:\nSi vous avez plusieurs champs :\n``` {{ site_settings.group_name.site_setting_name.field_name }} ````"),Object(i.b)("p",null,"Si vous avez un seul champ :\n",Object(i.b)("inlineCode",{parentName:"p"},"{{ site_settings.group_name.site_setting_name }}")),Object(i.b)("p",null,"Il semble qu'un bug dans site_settings emp\xeache d'utiliser les entity reference normalement. Cela ne retient que l'id de l'entity reference. Il faut donc utiliser twig tweak :"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"{{ drupal_entity('media', site_settings.theme.popup_teaser.field_video, 'popup') }}\n")),Object(i.b)("p",null,"De plus, pour un lien, voici comment g\xe9n\xe9rer l'url dans twig, qu'elle soit interne ou externe :"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"{% if site_settings.theme.popup_teaser.field_bouton.url.isExternal() %}\n    {% set uri = file_url(site_settings.theme.popup_teaser.field_bouton.uri) %}\n{% else %}\n    {% set uri = path('entity.node.canonical', {'node': site_settings.theme.popup_teaser.field_bouton.url.getRouteParameters()['node']}) %}\n{% endif %}\n")),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"NB : S'il s'agit d'un site settings avec plusieurs champs, il faut que tous les champs soient aliment\xe9s pour qu'ils s'affichent en front")),Object(i.b)("h3",{id:"hierarchical_term_formatter"},"hierarchical_term_formatter"),Object(i.b)("p",null,Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.drupal.org/project/hierarchical_term_formatter"}),"https://www.drupal.org/project/hierarchical_term_formatter")),Object(i.b)("p",null,"Ce module permet d'afficher une taxonomie ainsi que ses parents dans une hi\xe9rarchie."),Object(i.b)("h3",{id:"taxonomy_menu"},"taxonomy_menu"),Object(i.b)("p",null,"Ce module permet de cr\xe9er un menu \xe0 partir d'une taxonomy."),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},'NB : Pour pouvoir ordonner les termes en drag and drop \xe0 partir de la taxonomie concern\xe9e, il faut cocher la case "Use term weight order" dans la configuration de Taxonomy menu')),Object(i.b)("h3",{id:"maestro--business-process-workflow"},"Maestro : business process workflow"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Install all the Maestro module :")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Maestro Engine Module,"),Object(i.b)("li",{parentName:"ul"},"Maestro Task Console,"),Object(i.b)("li",{parentName:"ul"},"Maestro Template Builder,"),Object(i.b)("li",{parentName:"ul"},"Maestro Utility Functions,"),Object(i.b)("li",{parentName:"ul"},"Maestro Webform Integration")),Object(i.b)("ol",{start:2},Object(i.b)("li",{parentName:"ol"},"In the Engine module (/admin/config/workflow/maestro) :")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Create a Token that allows to run the orchestrator")),Object(i.b)("ol",{start:3},Object(i.b)("li",{parentName:"ol"},"In the template builder (maestro/templates/list):")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Build the template by adding tasks from the starting point to the ending point of the process"),Object(i.b)("li",{parentName:"ul"},"In the edit template option, set the number of stage to show in the process timeline"),Object(i.b)("li",{parentName:"ul"},"In the task settings",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"set the workflow stage number of the task in the process"),Object(i.b)("li",{parentName:"ul"},"set Unique identifier = submission"),Object(i.b)("li",{parentName:"ul"},"in the dropdown menu Webform select the concerned webform"),Object(i.b)("li",{parentName:"ul"},"in the assignment details, select the concerned role (or user)")))),Object(i.b)("ol",{start:4},Object(i.b)("li",{parentName:"ol"},"In the webform settings :")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Add a Spawn Maestro Workflow handler"),Object(i.b)("li",{parentName:"ul"},"In Maestro Workflow Template, select the process created in step 3"),Object(i.b)("li",{parentName:"ul"},"Add an email handler to configure the user email notification :",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},'In the edit panel, select "current user" in the To email field'))),Object(i.b)("li",{parentName:"ul"},"Add an email handler to configure the manager email notification :",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"If the email is related to a select of the form, choose the concerned field in the To email list, and set the email adress."))),Object(i.b)("li",{parentName:"ul"},"For fields dedicated to manager, select the acces rights in the access tab."),Object(i.b)("li",{parentName:"ul"},"champ disabled = settings / form display -> d\xe9sactiv\xe9"),Object(i.b)("li",{parentName:"ul"},"champ valeur par d\xe9faut = settings / avanc\xe9"),Object(i.b)("li",{parentName:"ul"},"Draft -> in the settings webform / param\xe8tres / submission : admin/structure/webform/manage/form_demat/settings/submissions"),Object(i.b)("li",{parentName:"ul"},"Download PDF",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Activer les modules Weform Webform Entity Print (PDF) et Webform Entity Print (PDF) Attachment"),Object(i.b)("li",{parentName:"ul"},"Activer le t\xe9l\xe9chargement sur le webform admin/structure/webform/manage/form_demat/results/download"),Object(i.b)("li",{parentName:"ul"},"config ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://youtu.be/Zj1HQNGTHFI"}),"https://youtu.be/Zj1HQNGTHFI")),Object(i.b)("li",{parentName:"ul"},"Si erreur apr\xe8s installation des modules, r\xe9parer la config /admin/structure/webform/config/advanced")))),Object(i.b)("h3",{id:"rgpd--tarte-au-citron"},"RGPD : Tarte au citron"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"T\xe9l\xe9charger le module : ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://opt-out.ferank.eu/fr/install/"}),"https://opt-out.ferank.eu/fr/install/")),Object(i.b)("li",{parentName:"ol"},"Poser les sources dans le dossiers des assets du site"),Object(i.b)("li",{parentName:"ol"},"Coller le ",Object(i.b)("inlineCode",{parentName:"li"},"<script>")," dans le head (mettre \xe0 jour si n\xe9cessaire le path vers le .js) :")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Mettre le lien vers la page de politique de cookies",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},'"privacyUrl": "/{{directory}}/charte-de-confidentialite"'))),Object(i.b)("li",{parentName:"ul"},"Pour remplacer la pastille par d\xe9faut par un lien (dans footer par exemple) :",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},'"showAlertSmall": false'))),Object(i.b)("li",{parentName:"ul"},"Pour d\xe9sactiver l'auto consent",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},'"highPrivacy": true'),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},'<a href="#" onclick="tarteaucitron.userInterface.openPanel();">GESTION DES COOKIES</a>'))))),Object(i.b)("ol",{start:4},Object(i.b)("li",{parentName:"ol"},"S\xe9lectionner le(s) service(s) sur le site ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://opt-out.ferank.eu/fr/install/"}),"https://opt-out.ferank.eu/fr/install/")," (\xe9tape 3)"),Object(i.b)("li",{parentName:"ol"},"Copier le code dans le body")),Object(i.b)("h3",{id:"store-locator"},"Store Locator"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Modules :",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},'Geolocation Field : "',Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.drupal.org/project/geolocation"}),"https://www.drupal.org/project/geolocation"),'"'),Object(i.b)("li",{parentName:"ul"},'Geocoder : "',Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.drupal.org/project/geocoder"}),"https://www.drupal.org/project/geocoder"),'"'))),Object(i.b)("li",{parentName:"ol"},"Configuration :",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Create a Store content type"),Object(i.b)("li",{parentName:"ul"},"In your Store create an address field"),Object(i.b)("li",{parentName:"ul"},"In your Store create a geolocation field"),Object(i.b)("li",{parentName:"ul"},"Link these two links via geocoder using the provider that you want"),Object(i.b)("li",{parentName:"ul"},"Create a view that list your store content type filtered by proximity on location field (expose this filter if needed)"))),Object(i.b)("li",{parentName:"ol"},"Code :",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Use google map autocomplete library: ",Object(i.b)("inlineCode",{parentName:"li"},'<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places"><\/script>')),Object(i.b)("li",{parentName:"ul"},"Make your input autocomplete with this library."),Object(i.b)("li",{parentName:"ul"},"In js use geolocate: ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.googleapis.com/geolocation/v1/geolocate"}),"https://www.googleapis.com/geolocation/v1/geolocate")," and geocode: ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://maps.googleapis.com/maps/api/geocode"}),"https://maps.googleapis.com/maps/api/geocode")," libraries."),Object(i.b)("li",{parentName:"ul"},"If you want to search location from address you will transform the address into a lat-lng data with ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://maps.googleapis.com/maps/api/geocode/"}),"https://maps.googleapis.com/maps/api/geocode/")),Object(i.b)("li",{parentName:"ul"},"Then fill lat field and lng field with the data you fetched from this google API."),Object(i.b)("li",{parentName:"ul"},"If you want to geolocate the user use ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.googleapis.com/geolocation/v1/geolocate"}),"https://www.googleapis.com/geolocation/v1/geolocate")),Object(i.b)("li",{parentName:"ul"},"Then fill lat field and lng field with the data you fetched from this google API."))),Object(i.b)("li",{parentName:"ol"},"Example (cf. krug project: ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://gitlab.com/abecms/moet-hennessy/krug"}),"https://gitlab.com/abecms/moet-hennessy/krug"),") :",Object(i.b)("ol",{parentName:"li"},Object(i.b)("li",{parentName:"ol"},"Configuration:",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"activate geolocation + geolocation address + geocoder extensions."),Object(i.b)("li",{parentName:"ul"},"install google map provider using composer."),Object(i.b)("li",{parentName:"ul"},"In geocoder configuration link google map provider."))),Object(i.b)("li",{parentName:"ol"},"Code (cf. ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://developers.google.com/maps/documentation/geocoding"}),"https://developers.google.com/maps/documentation/geocoding")," /// ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://developers.google.com/maps/documentation/geolocation"}),"https://developers.google.com/maps/documentation/geolocation")," /// ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://developers.google.com/maps/documentation/javascript/places-autocomplete"}),"https://developers.google.com/maps/documentation/javascript/places-autocomplete"),"):")))),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"$('.js-form-item').hide();\n\n$('#geolocate').once().click(function(e) {\n    e.preventDefault();\n    $.post(`https://www.googleapis.com/geolocation/v1/geolocate?key=${gmapApiKey}`, function(data) {\n        $('#edit-lat').val(data.location.lat);\n        $('#edit-lng').val(data.location.lng);\n        $('#edit-submit-find-krug').click();\n    })\n});\n\nfunction initializeAutocomplete() {\n    var element = document.getElementById(\"address\");\n\n    if (element) {\n        var autocomplete = new google.maps.places.Autocomplete(element, {\n            types: [\"geocode\"]\n        });\n        google.maps.event.addListener(\n            autocomplete,\n            \"place_changed\",\n            function() {\n            $.get(`https://maps.googleapis.com/maps/api/geocode/json?address=${autocomplete.getPlace().formatted_address.replace(\" \", \"+\")}&key=${gmapApiKey}`, function(data) {\n                console.log('result', data.results[0].geometry.location);\n                $('#edit-lat').val(data.results[0].geometry.location.lat);\n                $('#edit-lng').val(data.results[0].geometry.location.lng);\n            });\n        });\n    }\n}\ngoogle.maps.event.addDomListener(window, \"load\", function() {\n    initializeAutocomplete();\n});\n")),Object(i.b)("h3",{id:"shield"},"Shield"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Attention si le module du core HTTP BASIC AUTHENTICATION il rentre en conflit avec shield.\nSolution :"),Object(i.b)("li",{parentName:"ul"},"Installer a derni\xe8re version de shield ",Object(i.b)("inlineCode",{parentName:"li"},"composer require 'drupal/shield:^1.3'")),Object(i.b)("li",{parentName:"ul"},"Appliquer  le patch ci-dessous patch ",Object(i.b)("inlineCode",{parentName:"li"},"https://www.drupal.org/files/issues/2019-09-20/2815945-shield-1.3-rc1_basic_auth_compatibility-40.patch"),":")),Object(i.b)("p",null,"Methode pour appliquer le patch ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/abecms/book-drupal8/blob/master/dev.md#patches"}),"title")),Object(i.b)("h3",{id:"commerce"},"Commerce"),Object(i.b)("h4",{id:"configurer-une-variation-de-produit"},"Configurer une variation de produit"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"aller sous /admin/commerce/config/product-variation-types"),Object(i.b)("li",{parentName:"ul"},"ajouter les champs n\xe9cessaires (image, ...)")),Object(i.b)("h4",{id:"paiement-cb"},"Paiement CB"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},'Pour conserver les infos CB : Saisir une phrase dans "Alias usage" pour afficher la case \xe0 cocher sur la page ingenico')),Object(i.b)("h2",{id:"custom"},"Custom"),Object(i.b)("h3",{id:"instagram"},"Instagram"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"D\xe9veloppement d'un module instagram."),Object(i.b)("li",{parentName:"ol"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://rudrastyh.com/javascript/get-photos-from-instagram.html#tags"}),"https://rudrastyh.com/javascript/get-photos-from-instagram.html#tags")," pour la cr\xe9ation du token"),Object(i.b)("li",{parentName:"ol"},"find user id : ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://smashballoon.com/instagram-feed/find-instagram-user-id"}),"https://smashballoon.com/instagram-feed/find-instagram-user-id")),Object(i.b)("li",{parentName:"ol"},"Cr\xe9er la r\xe9gion home_instagram dans theme.info.yml"),Object(i.b)("li",{parentName:"ol"},"Placer le block dans la r\xe9gion home_instagram"),Object(i.b)("li",{parentName:"ol"},"Dans configuration, mettre le token et les username souhait\xe9s"),Object(i.b)("li",{parentName:"ol"},"ajout du template block--instagramblock.html.twig dans themes/custom/h1765/templates/block"),Object(i.b)("li",{parentName:"ol"},"ajout du template instagram-block-image.html.twig dans themes/custom/h1765/templates/block\nATTENTION: En mode sandbox de l'app Instagram, le plugin ne peut \xeatre utilis\xe9 car la recherche sur username ne fonctionne pas.")),Object(i.b)("h3",{id:"view_filter"},"view_filter"),Object(i.b)("p",null,"Ce module permet de customiser les filtres des formulaires des vues."),Object(i.b)("p",null,"Pour cr\xe9er un template sp\xe9cifique, il suffit de cr\xe9er cette fonction dans un module:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"function view_filter_theme()\n{\n  return [\n    'view_filter_input' => [\n      'variables' => [\n        'attributes' => [],\n      ],\n    ],\n  ];\n}\n")),Object(i.b)("p",null,"Ensuite, pour utiliser les variables d\xe9finies dans le template, il suffit d'utiliser le '#' (ici ca donne #attributes):"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"$form[$attributeId.'-links'] = [\n  '#theme' => 'view_filter_input',\n  '#attributes' => array(\n    'class' => array(\n      'cp-sticky-bar__list-dropdown',\n      'dropdown-default'\n    ),\n    'id' => $attributeId.'-pop'\n  )\n];\n")),Object(i.b)("p",null,"Et ne pas oublier de cr\xe9er le template view_filter_input.html.twig dans le r\xe9pertoire 'templates' du module."),Object(i.b)("p",null,"On peut d\xe9finir aussi des templates dans le theme qu'on cr\xe9e (par exemple pour h1765.theme):"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"function h1765_theme()\n{\n  // Register the theme mymodule_hello_name\n  return [\n    'mymodule_hello_name' => [\n      'variables' => [\n        'name' => FALSE,\n      ]\n    ],\n  ];\n}\n")),Object(i.b)("h3",{id:"simplenews_ajax"},"simplenews_ajax"),Object(i.b)("p",null,"Ce module permet de compl\xe9ter simplenewsajax. Il permet de rendre une soumission de formulaire en ajax :"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"function simplenewsajax_form_alter(&$form, FormStateInterface $form_state, $form_id) {\n  if (substr( $form_id, 0, 30 ) === \"simplenews_subscriptions_block\") {\n    $form['submit'] = [\n      '#type' => 'submit',\n      '#value' => 'Submit',\n      '#weight' => 6,\n      '#id' => 'edit-subscribe-ajax',\n      '#ajax' => [\n        'callback' => '\\Drupal\\simplenewsajax\\Controller\\ConfirmationController::ajaxconfirmSubscription',\n        'wrapper' => 'edit-mail-0-result',\n        'method' => 'replace',\n      ]\n    ];\n\n    $form['submit']['#executes_submit_callback'] = TRUE;\n    unset($form['#submit']);\n    unset($form['actions']['subscribe']['#submit']);\n    unset($form['#validate']);\n  }\n}\n")),Object(i.b)("h3",{id:"facebook_feeds_block"},"facebook_feeds_block"),Object(i.b)("p",null,"Affichage des feeds FB via un bloc."),Object(i.b)("p",null,"Pour obtenir un access de page token  : ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://elfsight.com/blog/2017/10/how-to-get-facebook-access-token/"}),"https://elfsight.com/blog/2017/10/how-to-get-facebook-access-token/")," Dans le cas de ce block, il faut le page access token."),Object(i.b)("p",null,"La solution pour obtenir un jeton qui dure toujours :\nHere's my solution using only Graph API Explorer & Access Token Debugger:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Graph API Explorer:"),Object(i.b)("li",{parentName:"ul"},"Select your App from the top right dropdown menu"),Object(i.b)("li",{parentName:"ul"},'Select "Get User Access Token" from dropdown (right of access token field) and select needed permissions'),Object(i.b)("li",{parentName:"ul"},"Copy user access token"),Object(i.b)("li",{parentName:"ul"},"Access Token Debugger:"),Object(i.b)("li",{parentName:"ul"},'Paste copied token and press "Debug"'),Object(i.b)("li",{parentName:"ul"},'Press "Extend Access Token" and copy the generated long-lived user access token'),Object(i.b)("li",{parentName:"ul"},"Graph API Explorer:"),Object(i.b)("li",{parentName:"ul"},'Paste copied token into the "Access Token" field'),Object(i.b)("li",{parentName:"ul"},'Make a GET request with "PAGE_ID?fields=access_token"'),Object(i.b)("li",{parentName:"ul"},'Find the permanent page access token in the response (node "access_token")'),Object(i.b)("li",{parentName:"ul"},"(Optional) Access Token Debugger:"),Object(i.b)("li",{parentName:"ul"},'Paste the permanent token and press "Debug"'),Object(i.b)("li",{parentName:"ul"},'"Expires" should be "Never"')),Object(i.b)("h3",{id:"view-unpublished"},"view unpublished"),Object(i.b)("p",null,'Lorsque des droits restreints sont appliqu\xe9s sur des types de contenus pour un r\xf4le donn\xe9, les contenus unpublished ne sont pas visibles de ce r\xf4le. L\'installation du module view_unpublished permet d\'appliquer les droits de "voir les contenus non publi\xe9s" pour chaque type de contenu (voir "view unpublished" dans admin/people/permissions).\nUne fois install\xe9, il est n\xe9cessaire de recalculer les droits (un message apparaitra en BO).'),Object(i.b)("h3",{id:"robot"},"Robot"),Object(i.b)("p",null,'Afin de d\xe9finir la valeur du fichier robots.txt installer le module "RobotsTxt".\nA noter : Il est n\xe9cessaire de supprimer (ou renommer) le fichier robots.txt d\xe9j\xe0 pr\xe9sent pour que le module affiche son propre robots.txt'),Object(i.b)("h3",{id:"views-reference-field"},"Views Reference Field"),Object(i.b)("p",null,"Ce module permet de r\xe9f\xe9rencer une vue dans le champs d'un node. Une fois install\xe9 :\n1. Cr\xe9er la vue\n1. Cr\xe9er un nouveau champ dans le contenu concern\xe9"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Type de champ = views reference"),Object(i.b)("li",{parentName:"ul"},"Type d'\xe9l\xe9ment \xe0 r\xe9f\xe9rencer = vue"),Object(i.b)("li",{parentName:"ul"},"View display plugins to allow = bloc"),Object(i.b)("li",{parentName:"ul"},"Preselect View Options = S\xe9lectionner la vue cr\xe9er \xe0 l'\xe9tape 1")))}p.isMDXComponent=!0},177:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=r.a.createContext({}),p=function(e){var t=r.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l({},t,{},e)),n},u=function(e){var t=p(e.components);return r.a.createElement(s.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=Object(a.forwardRef)((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),u=p(n),d=a,m=u["".concat(o,".").concat(d)]||u[d]||b[d]||i;return n?r.a.createElement(m,l({ref:t},s,{components:n})):r.a.createElement(m,l({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var s=2;s<i;s++)o[s]=n[s];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);