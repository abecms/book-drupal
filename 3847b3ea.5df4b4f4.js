(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{131:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return l})),r.d(t,"rightToc",(function(){return c})),r.d(t,"metadata",(function(){return i})),r.d(t,"default",(function(){return p}));var a=r(1),n=r(9),o=(r(0),r(153)),l={},c=[{value:"ADMIN",id:"admin",children:[]},{value:"CONFIG",id:"config",children:[]},{value:"NODE",id:"node",children:[]},{value:"TAXONOMY",id:"taxonomy",children:[]},{value:"VIEWS",id:"views",children:[]},{value:"SEO",id:"seo",children:[]},{value:"CKEDITOR",id:"ckeditor",children:[]},{value:"DEV",id:"dev",children:[]},{value:"SEARCH",id:"search",children:[]},{value:"IMAGES",id:"images",children:[]},{value:"FORMULAIRES",id:"formulaires",children:[]},{value:"MAIL & NEWSLETTER",id:"mail--newsletter",children:[]},{value:"PROBLEME COMPOSER",id:"probleme-composer",children:[]},{value:"Debug",id:"debug",children:[]},{value:"chargement de la base de donn\xe9es",id:"chargement-de-la-base-de-donn\xe9es",children:[]},{value:"Mesurer la taille des tables de la BDD",id:"mesurer-la-taille-des-tables-de-la-bdd",children:[]},{value:"Patches",id:"patches",children:[{value:"Appliquer un patch via composer",id:"appliquer-un-patch-via-composer",children:[]},{value:"Cr\xe9er un patch",id:"cr\xe9er-un-patch",children:[]},{value:"Appliquer un patch en ligne de commande",id:"appliquer-un-patch-en-ligne-de-commande",children:[]}]},{value:"Debug drush",id:"debug-drush",children:[]},{value:"on AcquiaDev",id:"on-acquiadev",children:[]},{value:"Cheat sheet",id:"cheat-sheet",children:[]},{value:"Mise \xe0 jour Drupal core via acquia cloud",id:"mise-\xe0-jour-drupal-core-via-acquia-cloud",children:[]},{value:"Vider le cache sur dev/stage/prod",id:"vider-le-cache-sur-devstageprod",children:[]}],i={id:"setup",title:"setup",description:"# Setup d'un nouveau projet Drupal",source:"@site/docs/setup.md",permalink:"/docs/setup",sidebar:"docs",previous:{title:"introduction",permalink:"/docs/introduction"},next:{title:"configuration",permalink:"/docs/configuration"}},u={rightToc:c,metadata:i},d="wrapper";function p(e){var t=e.components,r=Object(n.a)(e,["components"]);return Object(o.b)(d,Object(a.a)({},u,r,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h1",{id:"setup-dun-nouveau-projet-drupal"},"Setup d'un nouveau projet Drupal"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Ajout du theme livingcolor (le renommer dans le nom du th\xe8me souhait\xe9) (Appearance / install and set as default)"),Object(o.b)("li",{parentName:"ol"},"Dans le static : remove l'appel de jquery.min.js dans le gulp-config.js dans les vendors."),Object(o.b)("li",{parentName:"ol"},"Ajouter les modules suivants \xe0 l'aide de composer, en fonction des besoins (et les modules d\xe9pendants):")),Object(o.b)("h3",{id:"admin"},"ADMIN"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/admin_toolbar"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/adminimal_admin_toolbar"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/entity_browser"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/entity_embed"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/inline_entity_form"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/site_settings"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/ultimate_cron"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/redis"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/varnish_purge"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/shield")),Object(o.b)("h3",{id:"config"},"CONFIG"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/config_filter"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/config_split")),Object(o.b)("h3",{id:"node"},"NODE"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/paragraphs"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/entityqueue"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/entity_print"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/maxlength")),Object(o.b)("h3",{id:"taxonomy"},"TAXONOMY"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/hierarchical_term_formatter"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/taxonomy_menu")),Object(o.b)("h3",{id:"views"},"VIEWS"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/views_add_button"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/views_infinite_scroll"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/viewsreference")),Object(o.b)("h3",{id:"seo"},"SEO"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/easy_breadcrumb"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/pathauto"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/cookieconsent"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/datalayer"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/google_tag"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/metatag"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/redirect"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/xmlsitemap")),Object(o.b)("h3",{id:"ckeditor"},"CKEDITOR"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/linkit"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/embed"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/footnotes"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/colorbutton")),Object(o.b)("h3",{id:"dev"},"DEV"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/devel"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/twig_tweak")),Object(o.b)("h3",{id:"search"},"SEARCH"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/elasticsearch_connector"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/search_api"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/search_api_autocomplete")),Object(o.b)("h3",{id:"images"},"IMAGES"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/image_widget_crop"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/crop"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/svg_image")),Object(o.b)("h3",{id:"formulaires"},"FORMULAIRES"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/webform"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/captcha"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/recaptcha"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/simple_popup_blocks")),Object(o.b)("h3",{id:"mail--newsletter"},"MAIL & NEWSLETTER"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/mailsystem"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/simplenews"),Object(o.b)("li",{parentName:"ul"},"docroot/modules/contrib/swiftmailer")),Object(o.b)("h2",{id:"probleme-composer"},"PROBLEME COMPOSER"),Object(o.b)("p",null,"Si vous rencontrer le message suivant \xe0 l'installation via composer :"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"don't install drupal/core 8.6 |remove drupal/drupal dev-develop\n")),Object(o.b)("p",null,"Il faut revenir \xe0 la version 1.7.2 de composer."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"curl -sS https://getcomposer.org/download/1.7.2/composer.phar --output composer.phar && \\\nmv composer.phar /usr/local/bin/composer && \\\nchmod u+x /usr/local/bin/composer\n")),Object(o.b)("h1",{id:"d\xe9velopper"},"D\xe9velopper"),Object(o.b)("h2",{id:"debug"},"Debug"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Activer le module kint puis aller dans modules/contrib/devel/kint/config.default.php et changer ",Object(o.b)("inlineCode",{parentName:"li"},"$_kintSettings['maxLevels'] = 4;")," et lui mettre un niveau 4"),Object(o.b)("li",{parentName:"ol"},"Pour acquia : dans settings.php d\xe9commenter :")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"if (file_exists($app_root . '/' . $site_path . '/settings.local.php')) {\n  include $app_root . '/' . $site_path . '/settings.local.php';\n}\n")),Object(o.b)("ol",{start:3},Object(o.b)("li",{parentName:"ol"},"Mettre la configuration locale :")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"<?php\n\nassert_options(ASSERT_ACTIVE, TRUE);\n\\Drupal\\Component\\Assertion\\Handle::register();\n\n$settings['container_yamls'][] = DRUPAL_ROOT . '/sites/development.services.yml';\n$config['system.logging']['error_level'] = 'verbose';\n$config['system.performance']['css']['preprocess'] = FALSE;\n$config['system.performance']['js']['preprocess'] = FALSE;\n$settings['cache']['bins']['render'] = 'cache.backend.null';\n$settings['cache']['bins']['page'] = 'cache.backend.null';\n$settings['cache']['bins']['dynamic_page_cache'] = 'cache.backend.null';\n$settings['rebuild_access'] = TRUE;\n$settings['skip_permissions_hardening'] = TRUE;\n")),Object(o.b)("p",null,"et dans development.services.yml :"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"parameters:\n  http.response.debug_cacheability_headers: true\n  twig.config:\n    debug: true\n    auto_reload: true\n    cache: false\nservices:\n  cache.backend.null:\n    class: Drupal\\Core\\Cache\\NullBackendFactory\n")),Object(o.b)("p",null,"Cela vous pemrettra d'afficher les suggestions dans le code source de vos pages Drupal."),Object(o.b)("h1",{id:"bdd"},"BDD"),Object(o.b)("h2",{id:"chargement-de-la-base-de-donn\xe9es"},"chargement de la base de donn\xe9es"),Object(o.b)("p",null,"mysql -u #user# -p moet < #databasefile#.sql"),Object(o.b)("h2",{id:"mesurer-la-taille-des-tables-de-la-bdd"},"Mesurer la taille des tables de la BDD"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"SELECT\n     table_schema as `Database`,\n     table_name AS `Table`,\n     round(((data_length + index_length) / 1024 / 1024), 2) `Size in MB`\nFROM information_schema.TABLES\nWHERE table_schema = 'myDatabase'\nORDER BY table_schema ASC, (data_length + index_length) DESC;\n")),Object(o.b)("h2",{id:"patches"},"Patches"),Object(o.b)("p",null,"Le fonctionnement des patches repose sur composer."),Object(o.b)("h3",{id:"appliquer-un-patch-via-composer"},"Appliquer un patch via composer"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://kgaut.net/blog/2016/drupal-8-composer-appliquer-un-patch-dans-le-fichier-composerjson.html"}),"https://kgaut.net/blog/2016/drupal-8-composer-appliquer-un-patch-dans-le-fichier-composerjson.html"),"\nEn r\xe9sum\xe9 : installer ",Object(o.b)("inlineCode",{parentName:"li"},"composer require cweagans/composer-patches")," pour g\xe9rer les patches puis (rep patchs au m\xeame niveau que composer.json) :")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'"patches": {\n  "drupal/monmodule": {\n    "Patch custom stock\xe9 localement": "patchs/patch-custom-stocke-localement.patch"\n  }\n}\n')),Object(o.b)("p",null,"Il faut aussi un composer de ce type :"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'{\n    "name": "drupal/drupal",\n    "description": "Drupal is an open source content management platform powering millions of websites and applications.",\n    "type": "project",\n    "license": "GPL-2.0-or-later",\n    "require": {\n        "composer/installers": "^1.0.24",\n        "wikimedia/composer-merge-plugin": "^1.4",\n        "cweagans/composer-patches": "^1.6",\n        "drupal/core": "^8.6.4",\n        "drupal/maxlength": "^1.0",\n        "drupal/publication_date": "^2.0",\n        "drupal/metatag": "^1.7",\n        "drupal/entityqueue": "^1.0",\n        "drupal/devel": "^1.2",\n        "drupal/easy_breadcrumb": "^1.8",\n        "drupal/linkit": "^5.0",\n        "drupal/paragraphs": "^1.5",\n        "drupal/entity_embed": "^1.0",\n        "drupal/shield": "^1.2"\n    },\n    "minimum-stability": "dev",\n    "prefer-stable": true,\n    "config": {\n        "preferred-install": "dist",\n        "autoloader-suffix": "Drupal8"\n    },\n    "extra": {\n        "_readme": [\n            "By default Drupal loads the autoloader from ./vendor/autoload.php.",\n            "To change the autoloader you can edit ./autoload.php.",\n            "This file specifies the packages.drupal.org repository.",\n            "You can read more about this composer repository at:",\n            "https://www.drupal.org/node/2718229"\n        ],\n        "merge-plugin": {\n            "include": [\n                "core/composer.json"\n            ],\n            "recurse": true,\n            "replace": false,\n            "merge-extra": false\n        },\n        "installer-paths": {\n            "core": ["type:drupal-core"],\n            "modules/contrib/{name}": ["type:drupal-module"],\n            "profiles/contrib/{name}": ["type:drupal-profile"],\n            "themes/contrib/{name}": ["type:drupal-theme"],\n            "drush/contrib/{name}": ["type:drupal-drush"],\n            "modules/custom/{name}": ["type:drupal-custom-module"],\n            "themes/custom/{name}": ["type:drupal-custom-theme"]\n        },\n        "patches": {\n            "drupal/core": {\n              "Patch filtres groupes sur les vues": "patches/1810148-58.patch"\n            }\n        }\n    },\n    "autoload": {\n        "psr-4": {\n            "Drupal\\Core\\Composer\\": "core/lib/Drupal/Core/Composer"\n        }\n    },\n    "scripts": {\n        "pre-autoload-dump": "Drupal\\Core\\Composer\\Composer::preAutoloadDump",\n        "post-autoload-dump": "Drupal\\Core\\Composer\\Composer::ensureHtaccess",\n        "post-package-install": "Drupal\\Core\\Composer\\Composer::vendorTestCodeCleanup",\n        "post-package-update": "Drupal\\Core\\Composer\\Composer::vendorTestCodeCleanup",\n        "drupal-phpunit-upgrade-check": "Drupal\\Core\\Composer\\Composer::upgradePHPUnit",\n        "drupal-phpunit-upgrade": "@composer update phpunit/phpunit phpspec/prophecy symfony/yaml --with-dependencies --no-progress",\n        "phpcs": "phpcs --standard=core/phpcs.xml.dist --runtime-set installed_paths $(COMPOSER_BINARY config vendor-dir)/drupal/coder/coder_sniffer --",\n        "phpcbf": "phpcbf --standard=core/phpcs.xml.dist --runtime-set installed_paths $(COMPOSER_BINARY config vendor-dir)/drupal/coder/coder_sniffer --"\n    },\n    "repositories": [\n        {\n            "type": "composer",\n            "url": "https://packages.drupal.org/8"\n        }\n    ]\n}\n\n')),Object(o.b)("p",null,"IL NE FAUT PAS :"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'    "replace": {\n        "drupal/core": "^8.6"\n    },\n')),Object(o.b)("p",null,"mais mettre la version de Drupal en dependency !"),Object(o.b)("h3",{id:"cr\xe9er-un-patch"},"Cr\xe9er un patch"),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"git diff mon-fichier > [description]-[issue-number]-[comment-number].patch ")),Object(o.b)("p",null,"Pour cr\xe9er un patch de r\xe9pertoire avec des fichiers cr\xe9\xe9s, il faut d'abord faire git add du r\xe9pertoire puis :\n",Object(o.b)("inlineCode",{parentName:"p"},"git diff core/modules/statistics --cached --staged > patches/mon-patch.patch")),Object(o.b)("h3",{id:"appliquer-un-patch-en-ligne-de-commande"},"Appliquer un patch en ligne de commande"),Object(o.b)("p",null,"Se placer \xe0 la racine du projet. --dry-run pour tester sans appliquer le patch, --igonre-whitespace pour ignorer les diff\xe9rences d'espaces et tab et --fuzz 3 pour permettre une recherche des lignes en dehors de leur num\xe9ro de ligne not\xe9 dans le patch (si le code d'origine a un peu \xe9volu\xe9 par exemple depuis le patch\n",Object(o.b)("inlineCode",{parentName:"p"},"patch -p1 --dry-run --ignore-whitespace --fuzz 3 < patches/statistics-all-entities-2532334-43.patch")),Object(o.b)("p",null,"Pour l'ex\xe9cuter :\n",Object(o.b)("inlineCode",{parentName:"p"},"patch -p1 --ignore-whitespace --fuzz 3 < patches/statistics-all-entities-2532334-43.patch")),Object(o.b)("h1",{id:"drush"},"Drush"),Object(o.b)("h2",{id:"debug-drush"},"Debug drush"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},'drush sqlq "DELETE FROM cache_config"'),Object(o.b)("li",{parentName:"ol"},"drush sqlq \"DELETE FROM config WHERE name = 'field.storage.node.field_body' OR data LIKE '%field.storage.node.field_body%'\"")),Object(o.b)("h2",{id:"on-acquiadev"},"on AcquiaDev"),Object(o.b)("p",null,"ATTENTION : Si vous avez un message d'erreur sur deepcopy quand vous ex\xe9cuter drush, il faut \xe9diter la commande drush de devdesktop ",Object(o.b)("inlineCode",{parentName:"p"},"/Applications/DevDesktop/tools/drush")," en lui mettant comme version de PHP minimale :"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'[ -z "$PHP_ID" ] && PHP_ID=php5_6\n')),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"pour drush cr :")),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"dans /var/www/html/monProjet.dev/docroot/"),Object(o.b)("li",{parentName:"ul"},"executer drush cr")),Object(o.b)("h2",{id:"cheat-sheet"},"Cheat sheet"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"cache rebuild : drush cr (--all)"),Object(o.b)("li",{parentName:"ol"},"update db : drush updb (-y)"),Object(o.b)("li",{parentName:"ol"},"Remove module : drush pm-uninstall")),Object(o.b)("h1",{id:"acquia-cloud"},"Acquia cloud"),Object(o.b)("h2",{id:"mise-\xe0-jour-drupal-core-via-acquia-cloud"},"Mise \xe0 jour Drupal core via acquia cloud"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"ouvrir une console dans acquia dev desktop : drush up")),Object(o.b)("h2",{id:"vider-le-cache-sur-devstageprod"},"Vider le cache sur dev/stage/prod"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"ouvrir une console dans acquia dev desktop"),Object(o.b)("li",{parentName:"ul"},"/var/www/html/projet.dev/docroot : drush cr"),Object(o.b)("li",{parentName:"ul"},"ie projet tvconso /var/www/html/tvconso.dev/docroot : drush cr")),Object(o.b)("h1",{id:"bdd-erreurs-de-module-en-local-"},"BDD erreurs de module en local :"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Rendre drush utilisable (cf. debug drush)"),Object(o.b)("li",{parentName:"ol"},"D\xe9sinstaller le module probl\xe9matique (cf. drush cheat sheet)"),Object(o.b)("li",{parentName:"ol"},"Rebuild le cache (cf. drush cheat sheet)")))}p.isMDXComponent=!0},153:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return p}));var a=r(0),n=r.n(a),o=n.a.createContext({}),l=function(e){var t=n.a.useContext(o),r=t;return e&&(r="function"==typeof e?e(t):Object.assign({},t,e)),r},c=function(e){var t=l(e.components);return n.a.createElement(o.Provider,{value:t},e.children)};var i="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},d=Object(a.forwardRef)((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,i=function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&-1===t.indexOf(a)&&(r[a]=e[a]);return r}(e,["components","mdxType","originalType","parentName"]),d=l(r),p=a,s=d[c+"."+p]||d[p]||u[p]||o;return r?n.a.createElement(s,Object.assign({},{ref:t},i,{components:r})):n.a.createElement(s,Object.assign({},{ref:t},i))}));function p(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,l=new Array(o);l[0]=d;var c={};for(var u in t)hasOwnProperty.call(t,u)&&(c[u]=t[u]);c.originalType=e,c[i]="string"==typeof e?e:a,l[1]=c;for(var p=2;p<o;p++)l[p]=r[p];return n.a.createElement.apply(null,l)}return n.a.createElement.apply(null,r)}d.displayName="MDXCreateElement"}}]);