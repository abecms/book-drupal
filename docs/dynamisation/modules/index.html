<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.50">


<title data-react-helmet="true">modules | Drupal Stickers Book</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="modules | Drupal Stickers Book"><meta data-react-helmet="true" name="description" content="# Modules"><meta data-react-helmet="true" property="og:description" content="# Modules"><meta data-react-helmet="true" property="og:url" content="https://drupal.livingcolor.academy/docs/dynamisation/modules">

<link data-react-helmet="true" rel="shortcut icon" href="/img/logo-white.png">


<link rel="stylesheet" href="/styles.3b60f707.css">


<link rel="preload" href="/styles.2c614eb7.js" as="script">

<link rel="preload" href="/runtime~main.50b2ae9f.js" as="script">

<link rel="preload" href="/main.bae6580d.js" as="script">

<link rel="preload" href="/1.add223de.js" as="script">

<link rel="preload" href="/2.a785adde.js" as="script">

<link rel="preload" href="/38.51af2228.js" as="script">

<link rel="preload" href="/20ac7829.e17cb876.js" as="script">

<link rel="preload" href="/17896441.3a92ccfa.js" as="script">

<link rel="preload" href="/3db804d2.4ebbd684.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.png" alt="livingcolor"><strong class="navbar__title">Drupal Stickers Recipes</strong></a><a class="navbar__item navbar__link" href="/docs/setup/introduction">Docs</a></div><div class="navbar__items navbar__items--right"><a target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/docusaurus" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.png" alt="livingcolor"><strong class="navbar__title">Drupal Stickers Recipes</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/setup/introduction">Docs</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/docusaurus" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Setup</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/setup/introduction">introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/setup/setup">setup</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/config/configuration">configuration</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config/multilingue">multilingue</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config/webforms">webforms</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config/config-blocks">config-blocks</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config/config-nodes">config-nodes</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config/seo">seo</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Dynamisation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/nodes">nodes</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/paragraphs">paragraphs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/views">views</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/search">search</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/forms">forms</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/taxonomies">taxonomies</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/tokens">tokens</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/images">images</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/users">users</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/comments">comments</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/newsletters">newsletters</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/menus">menus</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/ckeditor">ckeditor</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/dynamisation/modules">modules</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/domains">domains</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/dev/dev">dev</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dev/debug">debug</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dev/tests">tests</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">modules</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="modules"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#modules" title="Direct link to heading">#</a>Modules</h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="core"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#core" title="Direct link to heading">#</a>Core</h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="statistics"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#statistics" title="Direct link to heading">#</a>statistics</h3><p>Un patch a été créé pour le projet &quot;Consommateurs &amp; Citoyen&quot;. Ce patch permet de réaliser des stats sur toutes les entités et pas seulement les nodes. De plus, l&#x27;appel ajax d&#x27;incrémentation de la vue renvoie le compte de l&#x27;entité.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="contrib"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#contrib" title="Direct link to heading">#</a>Contrib</h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="install-and-activate-a-contrib-module"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#install-and-activate-a-contrib-module" title="Direct link to heading">#</a>Install and activate a contrib module</h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="install"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#install" title="Direct link to heading">#</a>Install</h4><p><strong>Never download a zip file or a tar.gz file to install a module</strong></p><ol><li>Find your module - ie: <code>https://www.drupal.org/project/search_api_synonym</code></li><li>Click on version link you need at the bottom of the page - ie: <code>8.x-1.2</code></li><li>Copy the composer command to install the command - ie: <code>composer require &#x27;drupal/search_api_synonym:^1.2&#x27;</code></li><li>Run this command at the root of the project</li></ol><p>Note: The module is installed but not active.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="activate"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#activate" title="Direct link to heading">#</a>Activate</h4><ol><li>Got to admin of your project - <code>/admin/modules</code></li><li>Search you module</li><li>Select it and click on install</li><li>Drupal will activate this module</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="ajax-loader"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#ajax-loader" title="Direct link to heading">#</a>Ajax loader</h3><p>Pour remplacer le loader ajax drupal par un custom loader il faut :
1. le module Ajax Loader - <code>https://www.drupal.org/project/ajax_loader</code>
1. On copie le repertoire <code>modules/contrib/src/Plugin/ajax_loader</code> dans module le module customization <code>public/sites/default/modules/custom/customization/src/Plugin/ajax_loader</code>
1. Les custom Loader commencent par <code>Trobbernomduloader.php</code>
1. Ne garder qu&#x27;un seul fichier php et le renommer du nom du loader voulu <code>Trobbernomduclient.php</code> et
remplacer dans le fichier la class et la fonction pour ne pas provoquer de conflit avec le nom voulu.
1. Dans la fonction <code>setMarkup</code> remplacer le <code>return</code> par votre loader. ie:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-php codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">protected</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setMarkup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;&lt;div class=&quot;preloader-drupal&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><ol><li>Vider la cache depuis le B.O.</li><li>dans l&#x27;admin <code>admin/config/user-interface/ajax-loader</code> Choisissez votre loader qui apparait dans la liste déroulante.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="color-field"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#color-field" title="Direct link to heading">#</a>color field</h3><ol><li>Installer le module color field (<a href="https://www.drupal.org/project/color_field">https://www.drupal.org/project/color_field</a>)</li><li>Ajouter le champ color au contenu souhaité et le configurer dans la section &quot;gérer l&#x27;affichage du formulaire&quot;</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="cookieconsent"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#cookieconsent" title="Direct link to heading">#</a>cookieconsent</h3><ol><li>Installer le module Cookie consent  (<a href="https://www.drupal.org/project/cookieconsent">https://www.drupal.org/project/cookieconsent</a>)</li><li>Configurer les donnée de personnalisation (texte, lien vers la page de consentement, css)</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="simple-popup-blocks"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#simple-popup-blocks" title="Direct link to heading">#</a>simple popup blocks</h3><ol><li>Installer le module simple popup blocks  (<a href="https://www.drupal.org/project/simple_popup_blocks">https://www.drupal.org/project/simple_popup_blocks</a>)
Permet de créer des popin à partir de n&#x27;importe quel contenu (même les formulaires)</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="simplenews"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#simplenews" title="Direct link to heading">#</a>Simplenews</h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="ajouter-une-vue-sur-la-newsletter"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#ajouter-une-vue-sur-la-newsletter" title="Direct link to heading">#</a>Ajouter une vue sur la newsletter</h4><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function YOURTHEME_preprocess_simplenews_newsletter_body(&amp;$variables) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$variables[&#x27;latestnews&#x27;] = views_embed_view(&#x27;latestnews&#x27;, &#x27;block_1&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>Create a template for the newsletter body simplenews-newsletter-body--[newsletter_id].html.twig (newsletter_id = machine name). and add your view in it where you&#x27;d like to:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{{ latestnews }}</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="configurer-simplenews"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#configurer-simplenews" title="Direct link to heading">#</a>configurer simplenews</h4><ul><li>installer simplenews et swiftmailer</li><li>Créer mytheme/templates/swiftmailer.html.twig et set mailsystem to use mytheme to render the emails.</li><li>set mailsystem to use swiftmailers default formatter plugin</li><li>set mailsystem to use swiftmailers default sender plugin</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="pathauto"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#pathauto" title="Direct link to heading">#</a>Pathauto</h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="ajouter-des-conditions-sur-la-création-des-patterns-de-pathauto"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#ajouter-des-conditions-sur-la-création-des-patterns-de-pathauto" title="Direct link to heading">#</a>Ajouter des conditions sur la création des patterns de pathauto</h4><p>source: <a href="https://www.deeson.co.uk/labs/dynamic-patterns-pathauto">https://www.deeson.co.uk/labs/dynamic-patterns-pathauto</a></p><p>Si vous voulez par exemple créer des patterns en fonction d&#x27;un type de contenu <code>notice</code> et d&#x27;une valeur de champ de taxonomie <code>type_de_groupe</code></p><ol><li>Créer une classe de plugin de condition qui s&#x27;ajoutera aux conditions des patterns Pathauto</li><li>Déclarer ce plugin à Drupal</li><li>Injecter ce plugin de condition dans le formulaire de création/édition de pattern pathauto</li><li>Traiter la validation du formulaire de création/édition de pattern de pathauto</li></ol><p>Dans my_module/src/Plugin/Condition/ProgramGroup</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;?php</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">namespace Drupal\my_module\Plugin\Condition;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use Drupal\Core\Condition\ConditionPluginBase;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use Drupal\Core\Entity\EntityFieldManagerInterface;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use Drupal\Core\Form\FormStateInterface;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use Drupal\Core\Plugin\ContainerFactoryPluginInterface;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use Symfony\Component\DependencyInjection\ContainerInterface;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * Provides a &#x27;Program Group&#x27; condition.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @Condition(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *   id = &quot;program_group&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *   label = @Translation(&quot;Program Group&quot;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *   context = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *     &quot;node&quot; = @ContextDefinition(&quot;entity:node&quot;, label = @Translation(&quot;Node&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ProgramGroup extends ConditionPluginBase implements ContainerFactoryPluginInterface</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  /**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   * The entity field manager.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   * @var \Drupal\Core\Entity\EntityFieldManagerInterface</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    protected $fieldManager;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     * Creates a new ProgramGroup instance.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     * @param \Drupal\Core\Entity\EntityFieldManagerInterface $field_manager</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     *   The entity field manager.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     * @param array $configuration</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     *   The plugin configuration, i.e. an array with configuration values keyed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     *   by configuration option name. The special key &#x27;context&#x27; may be used to</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     *   initialize the defined contexts by setting it to an array of context</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     *   values keyed by context names.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     * @param string $plugin_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     *   The plugin_id for the plugin instance.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     * @param mixed $plugin_definition</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     *   The plugin implementation definition.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public function __construct(EntityFieldManagerInterface $field_manager, array $configuration, $plugin_id, $plugin_definition)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        parent::__construct($configuration, $plugin_id, $plugin_definition);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $this-&gt;fieldManager = $field_manager;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     * {@inheritdoc}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return new static(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            $container-&gt;get(&#x27;entity_field.manager&#x27;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            $configuration,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            $plugin_id,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            $plugin_definition</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     * {@inheritdoc}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public function buildConfigurationForm(array $form, FormStateInterface $form_state)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $form[&#x27;program_group&#x27;] = [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;#title&#x27; =&gt; $this-&gt;t(&#x27;Program Group&#x27;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;#type&#x27; =&gt; &#x27;select&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;#options&#x27; =&gt; $this-&gt;getProgramGroups(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;#default_value&#x27; =&gt; $this-&gt;configuration[&#x27;program_group&#x27;],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;#empty_value&#x27; =&gt; &#x27;&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return parent::buildConfigurationForm($form, $form_state);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     * {@inheritdoc}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public function submitConfigurationForm(array &amp;$form, FormStateInterface $form_state)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $this-&gt;configuration[&#x27;program_group&#x27;] = $form_state-&gt;getValue(&#x27;program_group&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        parent::submitConfigurationForm($form, $form_state);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     * {@inheritdoc}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public function summary()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if ($program_group = $this-&gt;configuration[&#x27;program_group&#x27;]) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            $program_groups = $this-&gt;getProgramGroups();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            $replace = [&#x27;@program_group&#x27; =&gt; $program_groups[$program_group]];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return $this-&gt;isNegated()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                ? $this-&gt;t(&#x27;Cette notice n\&#x27;appartient pas au groupe @program_group&#x27;, $replace)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                : $this-&gt;t(&#x27;Cette notice appartient au groupe @program_group&#x27;, $replace);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // If no list is selected it means the program group should not be listed.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return $this-&gt;isNegated() ? $this-&gt;t(&#x27;The program group is listed&#x27;) : $this-&gt;t(&#x27;The program group is not listed&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     * {@inheritdoc}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public function evaluate()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $node = $this-&gt;getContextValue(&#x27;node&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // This condition always fails if the node is not a notice.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if ($node-&gt;bundle() !== &#x27;notice&#x27;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return false;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // Check whether the node is listed on the selected list.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $node_program_group = $node-&gt;field_groupe_de_programmes[0]-&gt;entity-&gt;name-&gt;value;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if ($program_group = $this-&gt;configuration[&#x27;program_group&#x27;]) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return $node_program_group == $program_group xor $this-&gt;isNegated();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // If no list is selected it means the event should not be listed.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return empty($node_program_group) xor $this-&gt;isNegated();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     * {@inheritdoc}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public function defaultConfiguration()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return [&#x27;program_group&#x27; =&gt; &#x27;&#x27;] + parent::defaultConfiguration();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     * Retrieves the possible event lists.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     * @return string[]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     *   The list of possible event lists, keyed by their machine name.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public function getProgramGroups()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $existingTerms = \Drupal::entityTypeManager()-&gt;getStorage(&#x27;taxonomy_term&#x27;)-&gt;loadTree(&#x27;groupe_de_programmes&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $taxoArray = [];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        foreach ($existingTerms as $existingTerm) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            $taxoArray[] = $existingTerm-&gt;name;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return $taxoArray;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>Dans my_module/config/schema/customization.schema.yml</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">condition.plugin.program_group:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type: condition.plugin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    mapping:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      program_group:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type: string</span></div></div></div></div></div><p>Dans my_module/my_module.module</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * Implements hook_form_FORM_ID_alter().</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @see \Drupal\pathauto\Form\PatternEditForm</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">function customization_form_pathauto_pattern_form_alter(&amp;$form, $form_state)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /** @var \Drupal\pathauto\Entity\PathautoPattern $entity */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $entity = $form_state-&gt;getFormObject()-&gt;getEntity();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if ($entity-&gt;get(&#x27;type&#x27;) == &#x27;canonical_entities:node&#x27;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // Search the Pathauto pattern for our program_group condition.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        foreach ($entity-&gt;getSelectionConditions() as $candidate) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            if ($candidate-&gt;getPluginId() == &#x27;program_group&#x27;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                $condition = $candidate;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                break;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // If we could not find a configured condition, create an empty one.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (empty($condition)) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            /** @var \Drupal\Core\Condition\ConditionManager $condition_manager */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            $condition_manager = \Drupal::service(&#x27;plugin.manager.condition&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            $condition = $condition_manager-&gt;createInstance(&#x27;program_group&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // Add the condition plugin form to the form, removing the negate checkbox.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $condition_form = $condition-&gt;buildConfigurationForm($form[&#x27;pattern_container&#x27;], $form_state);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        unset($condition_form[&#x27;negate&#x27;]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $form[&#x27;pattern_container&#x27;] += $condition_form;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // Add our submit handler after ::submit but before ::save.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $offset = array_search(&#x27;::submit&#x27;, $form[&#x27;actions&#x27;][&#x27;submit&#x27;][&#x27;#submit&#x27;]) + 1;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        array_splice($form[&#x27;actions&#x27;][&#x27;submit&#x27;][&#x27;#submit&#x27;], $offset, 0, &#x27;customization_pathauto_pattern_submit&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * Submit handler for form ID pathauto_pattern_form.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @see customization_form_pathauto_pattern_form_alter()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">function customization_pathauto_pattern_submit($form, $form_state)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /** @var \Drupal\pathauto\Entity\PathautoPattern $entity */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $entity = $form_state-&gt;getFormObject()-&gt;getEntity();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if ($program_group = $form_state-&gt;getValue(&#x27;program_group&#x27;)) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $entity-&gt;addSelectionCondition([</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;id&#x27; =&gt; &#x27;program_group&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;program_group&#x27; =&gt; $program_group,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;negate&#x27; =&gt; false,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;context_mapping&#x27; =&gt; [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;node&#x27; =&gt; &#x27;node&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="permettre-de-générer-plusieurs-alias-pour-un-même-node-drupal-88"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#permettre-de-générer-plusieurs-alias-pour-un-même-node-drupal-88" title="Direct link to heading">#</a>Permettre de générer plusieurs alias pour un même node (Drupal &gt;8.8)</h4><p>(bien penser à mettre le canonical sur la bonne URL racine). Créer plusieurs URL pour un même node peut être pertinent.
On utilise le hook <code>HOOK_pathauto_alias_alter</code> :</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function customization_pathauto_alias_alter(&amp;$alias, array &amp;$context)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (isset($context[&#x27;data&#x27;][&#x27;node&#x27;]) &amp;&amp; $context[&#x27;data&#x27;][&#x27;node&#x27;]-&gt;bundle() === &#x27;notice&#x27;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $node = $context[&#x27;data&#x27;][&#x27;node&#x27;];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $typeProgramme = $node-&gt;field_type_de_programme[0]-&gt;entity-&gt;name-&gt;value;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $groupeProgramme = $node-&gt;field_groupe_de_programmes[0]-&gt;entity-&gt;name-&gt;value;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if ($typeProgramme === &#x27;programme&#x27; &amp;&amp;  $groupeProgramme === &#x27;unitaire&#x27;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            $parts = explode(&#x27;/&#x27;, $alias);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            $playerAlias = $alias.&#x27;/player/&#x27;.strtolower($node-&gt;field_identifiant-&gt;value).&#x27;/&#x27;.$parts[2];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            $pathAlias = \Drupal\path_alias\Entity\PathAlias::create([</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &#x27;path&#x27; =&gt; &#x27;/node/&#x27;.$node-&gt;id(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &#x27;alias&#x27; =&gt; $playerAlias,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &#x27;langcode&#x27; =&gt; &#x27;fr&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            $pathAlias-&gt;save();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="metatag"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#metatag" title="Direct link to heading">#</a>Metatag</h3><ul><li>Installer le module metatag</li><li>Pour personnaliser un node, il suffit de créer un nouveau champ de type metatag pour ce type de contenu. Automatiquement, il permettra de personnaliser les meta sur chaque node (dans l&#x27;édition du node menu metatag à droite)</li><li>pour placer l&#x27;image issue d&#x27;un champ du node qui est contenue dans un media : <code>[node:field_visuel:entity:field_media_image:entity:url]</code></li><li>pour activer et configurer le partage Facebook et twitter :<ul><li>Activer les modules Metatag: Twitter Cards et Metatag: Open Graph</li><li>Aller sous admin/config/search/metatag/settings et activer les options Open Graph et Twitter Cards pour les entités concernées</li><li>Puis modifier les metatag par défaut : sans /admin/config/search/metatag<ul><li>pour l&#x27;entité  concernée cliquer sur modifier</li><li>ajouter la valeur souhaitée pour les différents tag. Exemple pour le metatag MEDIA VIDEO, mettre [media:field_poster:large] pour la version large de l&#x27;url du poster</li></ul></li></ul></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="change--add-metatags-links-title-for-a-specific-page-in-a-controller"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#change--add-metatags-links-title-for-a-specific-page-in-a-controller" title="Direct link to heading">#</a>Change / add metatags, links, title for a specific page in a controller</h4><ol><li>make sure that the Metatag module doesn&#x27;t have a global config for the tags you want to change</li><li>In your Controller, you may create a <code>$htmlHead</code> array. Then add your tags and links as follow (such an entry is composed by the array of data + a key (ie &#x27;linkprevious&#x27;))</li></ol><p>Consider the way we change the title of the page (<code>&#x27;#title&#x27; =&gt; &#x27;Résultats de recherche - &#x27;.$input</code>)</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$htmlHead = [];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$urlWithoutSort = str_replace(&#x27;&amp;sort=&#x27;.$sort, &#x27;&#x27;, \Drupal::request()-&gt;getRequestUri());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$htmlHead[] = [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;#tag&#x27; =&gt; &#x27;meta&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;#attributes&#x27; =&gt; [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;name&#x27; =&gt; &#x27;canonical&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;content&#x27; =&gt; $urlWithoutSort,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;tag&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if (true) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $htmlHead[] = [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;#tag&#x27; =&gt; &#x27;link&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;#attributes&#x27; =&gt; [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;rel&#x27; =&gt; &#x27;next&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;href&#x27; =&gt; str_replace(&#x27;&amp;page=&#x27;.$page, &#x27;&#x27;, $urlWithoutSort).&#x27;&amp;page=&#x27;.($page + 1)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;linkprevious&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if ($page &amp;&amp; $page &gt; 1) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $htmlHead[] = [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;#tag&#x27; =&gt; &#x27;link&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;#attributes&#x27; =&gt; [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;rel&#x27; =&gt; &#x27;previous&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;href&#x27; =&gt; str_replace(&#x27;&amp;page=&#x27;.$page, &#x27;&#x27;, $urlWithoutSort).&#x27;&amp;page=&#x27;.($page - 1)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;linknext&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">return [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    self::QTHEME =&gt; &#x27;my_module_search_page&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;#q&#x27; =&gt; $input,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;#video&#x27; =&gt; (count($resultVideo[self::QHITS]) &gt; 0) ? true : false,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;#audio&#x27; =&gt; (count($resultAudio[self::QHITS]) &gt; 0) ? true : false,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;#article&#x27; =&gt; false,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;#children&#x27; =&gt; [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $resultVideo,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $resultAudio,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;#attached&#x27; =&gt; [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;html_head&#x27; =&gt; $htmlHead</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;#title&#x27; =&gt; &#x27;Résultats de recherche - &#x27;.$input</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">];</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="elasticsearch"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#elasticsearch" title="Direct link to heading">#</a>ElasticSearch</h3><p>Note: <code>http://letstoob.info/drupal-8/how-to-integrate-elasticsearch-6-3-0-with-drupal-8-5/</code></p><p>2 modules necessaires:</p><ul><li>Elasticsearch connector - <code>https://www.drupal.org/project/elasticsearch_connector</code></li><li>Search Api - <code>https://www.drupal.org/project/search_api</code></li></ul><ol><li>Go to <code>admin/config/search/elasticsearch-connector</code></li><li>Click on ```Add Cluster````</li><li>Fill in <code>name</code> and URL <code>http://localhost:9200</code> ou <code>http://nameofthedocker:9200</code> if you use a docker elastic</li><li>Select <code>Select this cluster default connection</code></li><li>Select <code>Use multiple nodes connection</code></li><li>Click <code>save</code></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="videos-transcoding"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#videos-transcoding" title="Direct link to heading">#</a>Videos transcoding</h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="cloudstack-trancoding"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#cloudstack-trancoding" title="Direct link to heading">#</a>Cloudstack Trancoding</h4><p><code>https://aws.amazon.com/blogs/networking-and-content-delivery/serverless-video-on-demand-vod-workflow/</code></p><ul><li>If your s3 bucket is in north US-EAST (N. Virginia)</li><li>You need to apply this patch for s3fs_cors module for drupal cause this is the only region need to be http called without the region in URL</li><li><code>https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingBucket.html#access-bucket-intro</code></li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-php codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">diff </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain">git a</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">modules</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">contrib</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">s3fs_cors</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">src</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">Element</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">S3fsCorsFile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">php b</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">modules</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">contrib</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">s3fs_cors</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">src</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">Element</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">S3fsCorsFile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">php</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">index </span><span class="token number" style="color:rgb(247, 140, 108)">5902592</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token number" style="color:rgb(247, 140, 108)">.99616251</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100644</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> a</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">modules</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">contrib</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">s3fs_cors</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">src</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">Element</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">S3fsCorsFile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">php</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> b</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">modules</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">contrib</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">s3fs_cors</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">src</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">Element</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">S3fsCorsFile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">php</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@@ </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">231</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token number" style="color:rgb(247, 140, 108)">231</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token plain"> @@ </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">processManagedFile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token variable" style="color:rgb(191, 199, 213)">$element</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> FormStateInterface </span><span class="token variable" style="color:rgb(191, 199, 213)">$form_st</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Pass the element parents through to the javascript function.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token variable" style="color:rgb(191, 199, 213)">$js_settings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;element_parents&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">implode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;/&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$element_parents</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">    </span><span class="token variable" style="color:rgb(191, 199, 213)">$js_settings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;cors_form_action&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$cors_config</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;s3fs_https&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;://s3-&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$config</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;region&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;.amazonaws.com/&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$bucket</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;/&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain">    </span><span class="token variable" style="color:rgb(191, 199, 213)">$js_settings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;cors_form_action&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$cors_config</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;s3fs_https&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;://s3&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;.amazonaws.com/&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$bucket</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;/&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token variable" style="color:rgb(191, 199, 213)">$field_name</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$element</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;#field_name&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token keyword" style="font-style:italic">empty</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$element</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;#field_parents&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="cloudfront-and-s3-cors-config"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#cloudfront-and-s3-cors-config" title="Direct link to heading">#</a>CloudFront and S3 CORS config</h4><p><code>https://stackoverflow.com/questions/50022326/amazon-s3-image-cors-issue</code></p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="s3-cors-config"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#s3-cors-config" title="Direct link to heading">#</a>S3 CORS Config</h5><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-xml codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">CORSConfiguration</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">xmlns</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://s3.amazonaws.com/doc/2006-03-01/</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">CORSRule</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedOrigin</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">http://*</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedOrigin</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedOrigin</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">https://*</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedOrigin</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedMethod</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">POST</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedMethod</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">MaxAgeSeconds</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">3000</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">MaxAgeSeconds</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">ExposeHeader</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">x-amz-version-id</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">ExposeHeader</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedHeader</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">*</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedHeader</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">CORSRule</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">CORSRule</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedOrigin</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">*</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedOrigin</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedMethod</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">GET</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedMethod</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedHeader</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">*</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedHeader</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">CORSRule</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">CORSRule</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedOrigin</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">*</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedOrigin</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedMethod</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">HEAD</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedMethod</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedHeader</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">*</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">AllowedHeader</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">CORSRule</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">CORSConfiguration</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="cloudfront-config"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#cloudfront-config" title="Direct link to heading">#</a>CloudFront Config</h5><p><code>https://stackoverflow.com/questions/50022326/amazon-s3-image-cors-issue</code></p><ul><li>Got to <code>Behaviors</code> tab</li><li>Select your distribution but ticking it and click on <code>Edit</code></li><li><code>Cache Based on Selected Request Headers</code> set to <code>Whitelist</code></li><li><code>Whitelist Headers</code> add <code>Access-Control-Request-Headers</code>, <code>Access-Control-Request-Method</code> and <code>Origin</code></li><li><code>Object Caching</code> tick <code>Use Origin Cache Headers</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="drupal-8-config"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#drupal-8-config" title="Direct link to heading">#</a>Drupal 8 Config</h4><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="modules-1"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#modules-1" title="Direct link to heading">#</a>Modules</h5><p>You&#x27;ll need 2 modules</p><ul><li><p>Run <code>composer require &#x27;drupal/s3fs:^3.0&#x27;</code></p></li><li><p>Run <code>composer require &#x27;drupal/s3fs_cors:^1.0&#x27;</code></p></li><li><p>You&#x27;ll need you AWS accesskey and secretkey</p></li><li><p>Edit your <code>settings.php</code></p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-php codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/** S3 configuration security */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$settings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;s3fs.access_key&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;youraccesskey&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$settings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;s3fs.secret_key&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;yoursecretkey&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="drupal-admin-config"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#drupal-admin-config" title="Direct link to heading">#</a>Drupal admin config</h4><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="media-type"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#media-type" title="Direct link to heading">#</a>Media Type</h5><p>Structure &gt; Types de media &gt; Video &gt; Gérer les champs
or <code>admin/structure/media/manage/video/fields</code></p><ul><li>Vidéo file &gt; modifier</li><li>Repertoire du fichier must be <code>input</code></li><li>Paramètres du champs pick <code>S3 File System</code></li></ul><p><code>admin/structure/media/manage/video/form-display</code></p><ul><li>for <code>Video file</code> pick <code>S3fs Cors File Upload</code></li><li>Click on the toothed wheel to setup the FileSize Limit</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="s3-config"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#s3-config" title="Direct link to heading">#</a>S3 Config</h5><p>Go to <code>https://yourdrupalsite/admin/config/media/s3fs</code></p><ul><li>Fill your bucket previsouly created from AWS cloudstack</li><li>Tick ```Always serve files from S3 via HTTPS````</li></ul><p>Go to <code>admin/config/media/s3fs/cors</code></p><ul><li>tick <code>https</code> for <code>Use Https/Http</code></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="redis"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#redis" title="Direct link to heading">#</a>Redis</h3><p>Module Install - <code>https://www.drupal.org/project/redis</code>
1. Run <code>composer require &#x27;drupal/redis:^1.1&#x27;</code> in docroot
1. Activate module in Back Office
1. Clear the cache
1. Update <code>settings.php</code> with</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * Redis Configuration.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$settings[&#x27;redis.connection&#x27;][&#x27;host&#x27;] =  &#x27;redis&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$settings[&#x27;redis.connection&#x27;][&#x27;port&#x27;] = NULL;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$settings[&#x27;cache&#x27;][&#x27;default&#x27;] = &#x27;cache.backend.redis&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$settings[&#x27;redis.connection&#x27;][&#x27;base&#x27;] = 8;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> $conf[&#x27;chq_redis_cache_enabled&#x27;] = TRUE;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if (isset($conf[&#x27;chq_redis_cache_enabled&#x27;]) &amp;&amp; $conf[&#x27;chq_redis_cache_enabled&#x27;]) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $settings[&#x27;redis.connection&#x27;][&#x27;interface&#x27;] = &#x27;PhpRedis&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $settings[&#x27;cache&#x27;][&#x27;default&#x27;] = &#x27;cache.backend.redis&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // Note that unlike memcached, redis persists cache items to disk so we can</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // actually store cache_class_cache_form in the default cache.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $conf[&#x27;cache_class_cache&#x27;] = &#x27;Redis_Cache&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="webform"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#webform" title="Direct link to heading">#</a>Webform</h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="webform-children"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#webform-children" title="Direct link to heading">#</a>Webform children</h4><p>Les children de webform sont en fait des contenus déjà préparés. On ne peut donc pas faire de <code>{{for child in children</code></p><p>Pour remplacer, ajouter, supprimer une classe par ex. il suffit juste d&#x27;utiliser la fonction replace de twig !</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{{ children | replace({&#x27;webform-flex &#x27;: &quot;webform-flex form__section &quot;}) | raw }}</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="conditionner-email-destinataire-selon-options-liste-déroulante"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#conditionner-email-destinataire-selon-options-liste-déroulante" title="Direct link to heading">#</a>Conditionner email destinataire selon options liste déroulante</h4><ol><li>Structure webform : Créer un formulaire ou modifier le formulaire concerné</li><li>Tab construire : ajouter un champ &quot;liste de selection&quot; et saisir les différentes options</li><li>Tab Handler :</li></ol><ul><li>Ajouter un handler,</li><li>Dans &quot;Envoyer A&quot;, sélectionner la liste créer dans le formulaire</li><li>Pour chaque entrée de la liste saisir le destinataire concerné</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="webform-recaptcha"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#webform-recaptcha" title="Direct link to heading">#</a>Webform recaptcha</h3><ol><li>Installer les modules Captcha et reCaptcha (<a href="https://www.drupal.org/project/recaptcha">https://www.drupal.org/project/recaptcha</a>)</li><li>Aller dans configuration/personnes/Captcha et configurer Captcha et reCaptcha : Bien créer un reCaptcha Google avec les bonnes clés et autorisant les bons domaines.</li><li>Aller dans le modèle du webform et ajouter un champ de type reCaptcha. Enjoy !</li><li>Important décocher <code>Local domain name validation</code> dans la configuration drupal si il est cocher côtés serveur et inversement</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="datalayer"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#datalayer" title="Direct link to heading">#</a>Datalayer</h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="bug-lors-de-la-suppresion-dun-inscrit-newsletter-via-simplenews"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#bug-lors-de-la-suppresion-dun-inscrit-newsletter-via-simplenews" title="Direct link to heading">#</a>Bug lors de la suppresion d&#x27;un inscrit newsletter (via simplenews)</h4><p>attention patch à faire (manuel) sur datalayer.module pour éviter un message d&#x27;erreur sur la suppression d&#x27;un inscrit newsletter (ligne 331) :</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// For entities with an owner/author, get the username</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if ((empty($selected_properties) || array_key_exists(&#x27;name&#x27;, $properties))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &amp;&amp; !isset($output_data[&#x27;entityName&#x27;]) &amp;&amp; is_object($entity-&gt;uid &amp;&amp; isset($entity-&gt;uid-&gt;entity-&gt;name))) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $output_data[&#x27;entityName&#x27;] = $entity-&gt;uid-&gt;entity-&gt;name-&gt;getString();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="amp"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#amp" title="Direct link to heading">#</a>AMP</h3><p>Permet de proposer la version AMP pour un node.
cf. <a href="https://www.drupal.org/docs/8/modules/accelerated-mobile-pages-amp/amp-version-82">https://www.drupal.org/docs/8/modules/accelerated-mobile-pages-amp/amp-version-82</a></p><p>Installer <code>composer require &#x27;drupal/schema_metatag:^1.3&#x27;</code> pour les micro-formats AMP</p><p>il y a actuellement un bug sur l&#x27;install de masterminds. Il faut faire :</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">composer require drupal/amp masterminds/html5:~2.3.0</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="flag"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#flag" title="Direct link to heading">#</a>flag</h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="créer-ses-propres-liens-de-bookmarks-par-le-user"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#créer-ses-propres-liens-de-bookmarks-par-le-user" title="Direct link to heading">#</a>Créer ses propres liens de bookmarks par le user</h4><ul><li>utiliser le module flag et:</li></ul><ol><li>créer un type de block (ex. myOwnBookmarks)</li><li>Créer un block de ce type (utilisons aussi myOwnBookmarks comme nom)</li><li>Créer un flag (aussi myOwnBookmarks :) associé au type de bloc myOwnBookmarks.</li><li>Ajouter un champ link à ce flag (qu&#x27;on peut limiter à 10 répétitions par ex. dans la config)</li><li>demandons l&#x27;affichage du flag en form popin puis sauvegardons le flag</li><li>Si on affiche le bloc myOwnBookmarks dans une région, on aura l&#x27;affichage du flag. au clic, popin avec le fomulaire de saisie des links !</li><li>Il ne reste plus qu&#x27;à créer une vue qui affiche le contenu du flag, et à utiliser cette vue ou on veut.</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="bug-dans-le-module--httpswwwdrupalorgprojectflagissues2888268"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#bug-dans-le-module--httpswwwdrupalorgprojectflagissues2888268" title="Direct link to heading">#</a>bug dans le module : <a href="https://www.drupal.org/project/flag/issues/2888268">https://www.drupal.org/project/flag/issues/2888268</a></h4><p>Pour que le bon template twig soit utilisé il faut faire ça :
<code>https://www.drupal.org/files/issues/2888268-8-views-link-doesnt-use-twig.patch</code></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="requetes-sql-de-stats"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#requetes-sql-de-stats" title="Direct link to heading">#</a>REQUETES SQL DE STATS</h4><p>Les likes</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SELECT distinct nf.title, fc.count FROM flag_counts as fc</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  inner join flagging as f on fc.entity_id = f.entity_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  inner join node as n on fc.entity_id = n.nid</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  inner join node_field_data as nf on nf.vid = n.vid</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  where f.flag_id = &quot;like&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  order by count desc</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="site-settings"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#site-settings" title="Direct link to heading">#</a>Site settings</h3><p><a href="https://www.drupal.org/project/site_settings">https://www.drupal.org/project/site_settings</a></p><p>Créer les configurations dont vous avez besoin.
Aller dans Manage Site setting pour créer vos éléments
Aller dans site settings pour renseigner vos éléments</p><p>Pour les appeler depuis Twig:
Si vous avez plusieurs champs :
``` {{ site_settings.group_name.site_setting_name.field_name }} ````</p><p>Si vous avez un seul champ :
<code>{{ site_settings.group_name.site_setting_name }}</code></p><p>Il semble qu&#x27;un bug dans site_settings empêche d&#x27;utiliser les entity reference normalement. Cela ne retient que l&#x27;id de l&#x27;entity reference. Il faut donc utiliser twig tweak :</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{{ drupal_entity(&#x27;media&#x27;, site_settings.theme.popup_teaser.field_video, &#x27;popup&#x27;) }}</span></div></div></div></div></div><p>De plus, pour un lien, voici comment générer l&#x27;url dans twig, qu&#x27;elle soit interne ou externe :</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{% if site_settings.theme.popup_teaser.field_bouton.url.isExternal() %}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {% set uri = file_url(site_settings.theme.popup_teaser.field_bouton.uri) %}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{% else %}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {% set uri = path(&#x27;entity.node.canonical&#x27;, {&#x27;node&#x27;: site_settings.theme.popup_teaser.field_bouton.url.getRouteParameters()[&#x27;node&#x27;]}) %}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{% endif %}</span></div></div></div></div></div><blockquote><p>NB : S&#x27;il s&#x27;agit d&#x27;un site settings avec plusieurs champs, il faut que tous les champs soient alimentés pour qu&#x27;ils s&#x27;affichent en front</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="hierarchical_term_formatter"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#hierarchical_term_formatter" title="Direct link to heading">#</a>hierarchical_term_formatter</h3><p><a href="https://www.drupal.org/project/hierarchical_term_formatter">https://www.drupal.org/project/hierarchical_term_formatter</a></p><p>Ce module permet d&#x27;afficher une taxonomie ainsi que ses parents dans une hiérarchie.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="taxonomy_menu"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#taxonomy_menu" title="Direct link to heading">#</a>taxonomy_menu</h3><p>Ce module permet de créer un menu à partir d&#x27;une taxonomy.</p><blockquote><p>NB : Pour pouvoir ordonner les termes en drag and drop à partir de la taxonomie concernée, il faut cocher la case &quot;Use term weight order&quot; dans la configuration de Taxonomy menu</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="maestro--business-process-workflow"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#maestro--business-process-workflow" title="Direct link to heading">#</a>Maestro : business process workflow</h3><ol><li>Install all the Maestro module :</li></ol><ul><li>Maestro Engine Module,</li><li>Maestro Task Console,</li><li>Maestro Template Builder,</li><li>Maestro Utility Functions,</li><li>Maestro Webform Integration</li></ul><ol start="2"><li>In the Engine module (/admin/config/workflow/maestro) :</li></ol><ul><li>Create a Token that allows to run the orchestrator</li></ul><ol start="3"><li>In the template builder (maestro/templates/list):</li></ol><ul><li>Build the template by adding tasks from the starting point to the ending point of the process</li><li>In the edit template option, set the number of stage to show in the process timeline</li><li>In the task settings<ul><li>set the workflow stage number of the task in the process</li><li>set Unique identifier = submission</li><li>in the dropdown menu Webform select the concerned webform</li><li>in the assignment details, select the concerned role (or user)</li></ul></li></ul><ol start="4"><li>In the webform settings :</li></ol><ul><li>Add a Spawn Maestro Workflow handler</li><li>In Maestro Workflow Template, select the process created in step 3</li><li>Add an email handler to configure the user email notification :<ul><li>In the edit panel, select &quot;current user&quot; in the To email field</li></ul></li><li>Add an email handler to configure the manager email notification :<ul><li>If the email is related to a select of the form, choose the concerned field in the To email list, and set the email adress.</li></ul></li><li>For fields dedicated to manager, select the acces rights in the access tab.</li><li>champ disabled = settings / form display -&gt; désactivé</li><li>champ valeur par défaut = settings / avancé</li><li>Draft -&gt; in the settings webform / paramètres / submission : admin/structure/webform/manage/form_demat/settings/submissions</li><li>Download PDF<ul><li>Activer les modules Weform Webform Entity Print (PDF) et Webform Entity Print (PDF) Attachment</li><li>Activer le téléchargement sur le webform admin/structure/webform/manage/form_demat/results/download</li><li>config <a href="https://youtu.be/Zj1HQNGTHFI">https://youtu.be/Zj1HQNGTHFI</a></li><li>Si erreur après installation des modules, réparer la config /admin/structure/webform/config/advanced</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="rgpd--tarte-au-citron"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#rgpd--tarte-au-citron" title="Direct link to heading">#</a>RGPD : Tarte au citron</h3><ol><li>Télécharger le module : <a href="https://opt-out.ferank.eu/fr/install/">https://opt-out.ferank.eu/fr/install/</a></li><li>Poser les sources dans le dossiers des assets du site</li><li>Coller le <code>&lt;script&gt;</code> dans le head (mettre à jour si nécessaire le path vers le .js) :</li></ol><ul><li>Mettre le lien vers la page de politique de cookies<ul><li>&quot;privacyUrl&quot;: &quot;/{{directory}}/charte-de-confidentialite&quot;</li></ul></li><li>Pour remplacer la pastille par défaut par un lien (dans footer par exemple) :<ul><li>&quot;showAlertSmall&quot;: false</li></ul></li><li>Pour désactiver l&#x27;auto consent<ul><li>&quot;highPrivacy&quot;: true</li><li><code>&lt;a href=&quot;#&quot; onclick=&quot;tarteaucitron.userInterface.openPanel();&quot;&gt;GESTION DES COOKIES&lt;/a&gt;</code></li></ul></li></ul><ol start="4"><li>Sélectionner le(s) service(s) sur le site <a href="https://opt-out.ferank.eu/fr/install/">https://opt-out.ferank.eu/fr/install/</a> (étape 3)</li><li>Copier le code dans le body</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="store-locator"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#store-locator" title="Direct link to heading">#</a>Store Locator</h3><ol><li>Modules :<ul><li>Geolocation Field : &quot;<a href="https://www.drupal.org/project/geolocation">https://www.drupal.org/project/geolocation</a>&quot;</li><li>Geocoder : &quot;<a href="https://www.drupal.org/project/geocoder">https://www.drupal.org/project/geocoder</a>&quot;</li></ul></li><li>Configuration :<ul><li>Create a Store content type</li><li>In your Store create an address field</li><li>In your Store create a geolocation field</li><li>Link these two links via geocoder using the provider that you want</li><li>Create a view that list your store content type filtered by proximity on location field (expose this filter if needed)</li></ul></li><li>Code :<ul><li>Use google map autocomplete library: <code>&lt;script type=&quot;text/javascript&quot; src=&quot;https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&amp;libraries=places&quot;&gt;&lt;/script&gt;</code></li><li>Make your input autocomplete with this library.</li><li>In js use geolocate: <a href="https://www.googleapis.com/geolocation/v1/geolocate">https://www.googleapis.com/geolocation/v1/geolocate</a> and geocode: <a href="https://maps.googleapis.com/maps/api/geocode">https://maps.googleapis.com/maps/api/geocode</a> libraries.</li><li>If you want to search location from address you will transform the address into a lat-lng data with <a href="https://maps.googleapis.com/maps/api/geocode/">https://maps.googleapis.com/maps/api/geocode/</a></li><li>Then fill lat field and lng field with the data you fetched from this google API.</li><li>If you want to geolocate the user use <a href="https://www.googleapis.com/geolocation/v1/geolocate">https://www.googleapis.com/geolocation/v1/geolocate</a></li><li>Then fill lat field and lng field with the data you fetched from this google API.</li></ul></li><li>Example (cf. krug project: <a href="https://gitlab.com/abecms/moet-hennessy/krug">https://gitlab.com/abecms/moet-hennessy/krug</a>) :<ol><li>Configuration:<ul><li>activate geolocation + geolocation address + geocoder extensions.</li><li>install google map provider using composer.</li><li>In geocoder configuration link google map provider.</li></ul></li><li>Code (cf. <a href="https://developers.google.com/maps/documentation/geocoding">https://developers.google.com/maps/documentation/geocoding</a> /// <a href="https://developers.google.com/maps/documentation/geolocation">https://developers.google.com/maps/documentation/geolocation</a> /// <a href="https://developers.google.com/maps/documentation/javascript/places-autocomplete">https://developers.google.com/maps/documentation/javascript/places-autocomplete</a>):</li></ol></li></ol><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$(&#x27;.js-form-item&#x27;).hide();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$(&#x27;#geolocate&#x27;).once().click(function(e) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    e.preventDefault();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $.post(`https://www.googleapis.com/geolocation/v1/geolocate?key=${gmapApiKey}`, function(data) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $(&#x27;#edit-lat&#x27;).val(data.location.lat);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $(&#x27;#edit-lng&#x27;).val(data.location.lng);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $(&#x27;#edit-submit-find-krug&#x27;).click();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    })</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">function initializeAutocomplete() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var element = document.getElementById(&quot;address&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (element) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        var autocomplete = new google.maps.places.Autocomplete(element, {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            types: [&quot;geocode&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        });</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        google.maps.event.addListener(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            autocomplete,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;place_changed&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            function() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            $.get(`https://maps.googleapis.com/maps/api/geocode/json?address=${autocomplete.getPlace().formatted_address.replace(&quot; &quot;, &quot;+&quot;)}&amp;key=${gmapApiKey}`, function(data) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                console.log(&#x27;result&#x27;, data.results[0].geometry.location);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                $(&#x27;#edit-lat&#x27;).val(data.results[0].geometry.location.lat);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                $(&#x27;#edit-lng&#x27;).val(data.results[0].geometry.location.lng);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            });</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        });</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">google.maps.event.addDomListener(window, &quot;load&quot;, function() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    initializeAutocomplete();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="shield"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#shield" title="Direct link to heading">#</a>Shield</h3><ul><li>Attention si le module du core HTTP BASIC AUTHENTICATION il rentre en conflit avec shield.
Solution :</li><li>Installer a dernière version de shield <code>composer require &#x27;drupal/shield:^1.3&#x27;</code></li><li>Appliquer  le patch ci-dessous patch <code>https://www.drupal.org/files/issues/2019-09-20/2815945-shield-1.3-rc1_basic_auth_compatibility-40.patch</code>:</li></ul><p>Methode pour appliquer le patch <a href="https://github.com/abecms/book-drupal8/blob/master/dev.md#patches">title</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="commerce"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#commerce" title="Direct link to heading">#</a>Commerce</h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="configurer-une-variation-de-produit"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#configurer-une-variation-de-produit" title="Direct link to heading">#</a>Configurer une variation de produit</h4><ul><li>aller sous /admin/commerce/config/product-variation-types</li><li>ajouter les champs nécessaires (image, ...)</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="paiement-cb"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#paiement-cb" title="Direct link to heading">#</a>Paiement CB</h4><ul><li>Pour conserver les infos CB : Saisir une phrase dans &quot;Alias usage&quot; pour afficher la case à cocher sur la page ingenico</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="custom"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#custom" title="Direct link to heading">#</a>Custom</h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="instagram"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#instagram" title="Direct link to heading">#</a>Instagram</h3><ol><li>Développement d&#x27;un module instagram.</li><li><a href="https://rudrastyh.com/javascript/get-photos-from-instagram.html#tags">https://rudrastyh.com/javascript/get-photos-from-instagram.html#tags</a> pour la création du token</li><li>find user id : <a href="https://smashballoon.com/instagram-feed/find-instagram-user-id">https://smashballoon.com/instagram-feed/find-instagram-user-id</a></li><li>Créer la région home_instagram dans theme.info.yml</li><li>Placer le block dans la région home_instagram</li><li>Dans configuration, mettre le token et les username souhaités</li><li>ajout du template block--instagramblock.html.twig dans themes/custom/h1765/templates/block</li><li>ajout du template instagram-block-image.html.twig dans themes/custom/h1765/templates/block
ATTENTION: En mode sandbox de l&#x27;app Instagram, le plugin ne peut être utilisé car la recherche sur username ne fonctionne pas.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="view_filter"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#view_filter" title="Direct link to heading">#</a>view_filter</h3><p>Ce module permet de customiser les filtres des formulaires des vues.</p><p>Pour créer un template spécifique, il suffit de créer cette fonction dans un module:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function view_filter_theme()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;view_filter_input&#x27; =&gt; [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;variables&#x27; =&gt; [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;attributes&#x27; =&gt; [],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>Ensuite, pour utiliser les variables définies dans le template, il suffit d&#x27;utiliser le &#x27;#&#x27; (ici ca donne #attributes):</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$form[$attributeId.&#x27;-links&#x27;] = [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;#theme&#x27; =&gt; &#x27;view_filter_input&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;#attributes&#x27; =&gt; array(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;class&#x27; =&gt; array(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;cp-sticky-bar__list-dropdown&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;dropdown-default&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;id&#x27; =&gt; $attributeId.&#x27;-pop&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">];</span></div></div></div></div></div><p>Et ne pas oublier de créer le template view_filter_input.html.twig dans le répertoire &#x27;templates&#x27; du module.</p><p>On peut définir aussi des templates dans le theme qu&#x27;on crée (par exemple pour h1765.theme):</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function h1765_theme()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // Register the theme mymodule_hello_name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;mymodule_hello_name&#x27; =&gt; [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;variables&#x27; =&gt; [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;name&#x27; =&gt; FALSE,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="simplenews_ajax"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#simplenews_ajax" title="Direct link to heading">#</a>simplenews_ajax</h3><p>Ce module permet de compléter simplenewsajax. Il permet de rendre une soumission de formulaire en ajax :</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function simplenewsajax_form_alter(&amp;$form, FormStateInterface $form_state, $form_id) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if (substr( $form_id, 0, 30 ) === &quot;simplenews_subscriptions_block&quot;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $form[&#x27;submit&#x27;] = [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;#type&#x27; =&gt; &#x27;submit&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;#value&#x27; =&gt; &#x27;Submit&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;#weight&#x27; =&gt; 6,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;#id&#x27; =&gt; &#x27;edit-subscribe-ajax&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;#ajax&#x27; =&gt; [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;callback&#x27; =&gt; &#x27;\Drupal\simplenewsajax\Controller\ConfirmationController::ajaxconfirmSubscription&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;wrapper&#x27; =&gt; &#x27;edit-mail-0-result&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;method&#x27; =&gt; &#x27;replace&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $form[&#x27;submit&#x27;][&#x27;#executes_submit_callback&#x27;] = TRUE;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    unset($form[&#x27;#submit&#x27;]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    unset($form[&#x27;actions&#x27;][&#x27;subscribe&#x27;][&#x27;#submit&#x27;]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    unset($form[&#x27;#validate&#x27;]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="facebook_feeds_block"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#facebook_feeds_block" title="Direct link to heading">#</a>facebook_feeds_block</h3><p>Affichage des feeds FB via un bloc.</p><p>Pour obtenir un access de page token  : <a href="https://elfsight.com/blog/2017/10/how-to-get-facebook-access-token/">https://elfsight.com/blog/2017/10/how-to-get-facebook-access-token/</a> Dans le cas de ce block, il faut le page access token.</p><p>La solution pour obtenir un jeton qui dure toujours :
Here&#x27;s my solution using only Graph API Explorer &amp; Access Token Debugger:</p><ul><li>Graph API Explorer:</li><li>Select your App from the top right dropdown menu</li><li>Select &quot;Get User Access Token&quot; from dropdown (right of access token field) and select needed permissions</li><li>Copy user access token</li><li>Access Token Debugger:</li><li>Paste copied token and press &quot;Debug&quot;</li><li>Press &quot;Extend Access Token&quot; and copy the generated long-lived user access token</li><li>Graph API Explorer:</li><li>Paste copied token into the &quot;Access Token&quot; field</li><li>Make a GET request with &quot;PAGE_ID?fields=access_token&quot;</li><li>Find the permanent page access token in the response (node &quot;access_token&quot;)</li><li>(Optional) Access Token Debugger:</li><li>Paste the permanent token and press &quot;Debug&quot;</li><li>&quot;Expires&quot; should be &quot;Never&quot;</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="view-unpublished"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#view-unpublished" title="Direct link to heading">#</a>view unpublished</h3><p>Lorsque des droits restreints sont appliqués sur des types de contenus pour un rôle donné, les contenus unpublished ne sont pas visibles de ce rôle. L&#x27;installation du module view_unpublished permet d&#x27;appliquer les droits de &quot;voir les contenus non publiés&quot; pour chaque type de contenu (voir &quot;view unpublished&quot; dans admin/people/permissions).
Une fois installé, il est nécessaire de recalculer les droits (un message apparaitra en BO).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="robot"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#robot" title="Direct link to heading">#</a>Robot</h3><p>Afin de définir la valeur du fichier robots.txt installer le module &quot;RobotsTxt&quot;.
A noter : Il est nécessaire de supprimer (ou renommer) le fichier robots.txt déjà présent pour que le module affiche son propre robots.txt</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="views-reference-field"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#views-reference-field" title="Direct link to heading">#</a>Views Reference Field</h3><p>Ce module permet de référencer une vue dans le champs d&#x27;un node. Une fois installé :
1. Créer la vue
1. Créer un nouveau champ dans le contenu concerné</p><ul><li>Type de champ = views reference</li><li>Type d&#x27;élément à référencer = vue</li><li>View display plugins to allow = bloc</li><li>Preselect View Options = Sélectionner la vue créer à l&#x27;étape 1</li></ul></div></article><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/dynamisation/ckeditor"><div class="pagination-nav__link--sublabel">Previous</div><div class="pagination-nav__link--label">« ckeditor</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/dynamisation/domains"><div class="pagination-nav__link--sublabel">Next</div><div class="pagination-nav__link--label">domains »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#core" class="contents__link">Core</a><ul><li><a href="#statistics" class="contents__link">statistics</a></li></ul></li><li><a href="#contrib" class="contents__link">Contrib</a><ul><li><a href="#install-and-activate-a-contrib-module" class="contents__link">Install and activate a contrib module</a></li><li><a href="#ajax-loader" class="contents__link">Ajax loader</a></li><li><a href="#color-field" class="contents__link">color field</a></li><li><a href="#cookieconsent" class="contents__link">cookieconsent</a></li><li><a href="#simple-popup-blocks" class="contents__link">simple popup blocks</a></li><li><a href="#simplenews" class="contents__link">Simplenews</a></li><li><a href="#pathauto" class="contents__link">Pathauto</a></li><li><a href="#metatag" class="contents__link">Metatag</a></li><li><a href="#elasticsearch" class="contents__link">ElasticSearch</a></li><li><a href="#videos-transcoding" class="contents__link">Videos transcoding</a></li><li><a href="#redis" class="contents__link">Redis</a></li><li><a href="#webform" class="contents__link">Webform</a></li><li><a href="#webform-recaptcha" class="contents__link">Webform recaptcha</a></li><li><a href="#datalayer" class="contents__link">Datalayer</a></li><li><a href="#amp" class="contents__link">AMP</a></li><li><a href="#flag" class="contents__link">flag</a></li><li><a href="#site-settings" class="contents__link">Site settings</a></li><li><a href="#hierarchical_term_formatter" class="contents__link">hierarchical_term_formatter</a></li><li><a href="#taxonomy_menu" class="contents__link">taxonomy_menu</a></li><li><a href="#maestro--business-process-workflow" class="contents__link">Maestro : business process workflow</a></li><li><a href="#rgpd--tarte-au-citron" class="contents__link">RGPD : Tarte au citron</a></li><li><a href="#store-locator" class="contents__link">Store Locator</a></li><li><a href="#shield" class="contents__link">Shield</a></li><li><a href="#commerce" class="contents__link">Commerce</a></li></ul></li><li><a href="#custom" class="contents__link">Custom</a><ul><li><a href="#instagram" class="contents__link">Instagram</a></li><li><a href="#view_filter" class="contents__link">view_filter</a></li><li><a href="#simplenews_ajax" class="contents__link">simplenews_ajax</a></li><li><a href="#facebook_feeds_block" class="contents__link">facebook_feeds_block</a></li><li><a href="#view-unpublished" class="contents__link">view unpublished</a></li><li><a href="#robot" class="contents__link">Robot</a></li><li><a href="#views-reference-field" class="contents__link">Views Reference Field</a></li></ul></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/setup/introduction">Docs</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://abecms.slack.com">Slack</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Website</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://livingcolor.fr">Website</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1Wg7"><img class="footer__logo" alt="Facebook Open Source Logo" src="https://docusaurus.io/img/oss_logo.png"></a></div><div>Copyright © 2020 Abe SAS. Built with Docusaurus.</div></div></div></footer>
</div>

<script src="/styles.2c614eb7.js"></script>

<script src="/runtime~main.50b2ae9f.js"></script>

<script src="/main.bae6580d.js"></script>

<script src="/1.add223de.js"></script>

<script src="/2.a785adde.js"></script>

<script src="/38.51af2228.js"></script>

<script src="/20ac7829.e17cb876.js"></script>

<script src="/17896441.3a92ccfa.js"></script>

<script src="/3db804d2.4ebbd684.js"></script>


</body>
</html>