<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.50">


<title data-react-helmet="true">dev | Drupal Stickers Book</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="dev | Drupal Stickers Book"><meta data-react-helmet="true" name="description" content="# Headless"><meta data-react-helmet="true" property="og:description" content="# Headless"><meta data-react-helmet="true" property="og:url" content="https://drupal.livingcolor.academy/docs/dev/dev">

<link data-react-helmet="true" rel="shortcut icon" href="/img/logo-white.png">


<link rel="stylesheet" href="/styles.3b60f707.css">


<link rel="preload" href="/styles.2c614eb7.js" as="script">

<link rel="preload" href="/runtime~main.53bc7229.js" as="script">

<link rel="preload" href="/main.bae6580d.js" as="script">

<link rel="preload" href="/1.add223de.js" as="script">

<link rel="preload" href="/2.a785adde.js" as="script">

<link rel="preload" href="/38.51af2228.js" as="script">

<link rel="preload" href="/20ac7829.e17cb876.js" as="script">

<link rel="preload" href="/17896441.3a92ccfa.js" as="script">

<link rel="preload" href="/8037c9c6.797e19fd.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.png" alt="livingcolor"><strong class="navbar__title">Drupal Stickers Recipes</strong></a><a class="navbar__item navbar__link" href="/docs/setup/introduction">Docs</a></div><div class="navbar__items navbar__items--right"><a target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/docusaurus" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.png" alt="livingcolor"><strong class="navbar__title">Drupal Stickers Recipes</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/setup/introduction">Docs</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/docusaurus" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Setup</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/setup/introduction">introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/setup/setup">setup</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/config/configuration">configuration</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config/multilingue">multilingue</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config/webforms">webforms</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config/config-blocks">config-blocks</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config/config-nodes">config-nodes</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config/seo">seo</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Dynamisation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/nodes">nodes</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/paragraphs">paragraphs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/views">views</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/search">search</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/forms">forms</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/taxonomies">taxonomies</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/tokens">tokens</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/images">images</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/users">users</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/comments">comments</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/newsletters">newsletters</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/menus">menus</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/ckeditor">ckeditor</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/modules">modules</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamisation/domains">domains</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Development</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/dev/dev">dev</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dev/debug">debug</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dev/tests">tests</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">dev</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="headless"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#headless" title="Direct link to heading">#</a>Headless</h1><p>Utiliser exclusivement json:api + les extensions suivantes :</p><ul><li>&quot;drupal/consumer_image_styles&quot;: &quot;^3.0&quot;,</li><li>&quot;drupal/jsonapi_extras&quot;: &quot;^3.12&quot;</li></ul><p>Le premier permet d&#x27;afficher des styles spécifiques dans le retour json. On va d&#x27;abord sélectionner le consumer en choisissant les styles accessibles :
<code>/admin/config/services/consumer</code>
Puis dans la config json:api, on choisit le field qui affiche une image et on lui assigne les styles d&#x27;image.</p><p>Le second permet de configurer l&#x27;affichage json par type d&#x27;entité !</p><p>Au lieu d&#x27;avoir :</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/jsonapi/node/homepage?include=field_video_a_la_une,field_video_a_la_une.field_poster,field_video_a_la_une.field_media_video_file,field_video_a_la_une.field_category,field_paragraphes.field_reusable_paragraph.paragraphs.field_categorie&amp;fields[node--homepage]=field_titre&amp;fields[media--video]=field_titre,field_poster,field_duree&amp;fields[file--file]=uri&amp;fields[node--categorie]=drupal_internal__nid,title,field_couleur,field_description,field_description_courte</span></div></div></div></div></div><p>on peut avoir apres config :</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/jsonapi/node/homepage</span></div></div></div></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="create-a-module"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-a-module" title="Direct link to heading">#</a>Create a module</h1><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="site-settings"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#site-settings" title="Direct link to heading">#</a>Site settings</h1><p>To get the site_settings in a specific language, then get a specific group of site settings then a translated value of a specific key :</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$language = &#x27;fr&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if ($cache = \Drupal::cache(&#x27;site_settings&#x27;)-&gt;get(&#x27;settings&#x27;.&#x27;:&#x27;.$language)) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $site_settings = $cache-&gt;data;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">} else {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $site_settings = \Drupal::service(&#x27;site_settings.loader&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $site_settings-&gt;rebuildCache($language);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $cache = \Drupal::cache(&#x27;site_settings&#x27;)-&gt;get(&#x27;settings&#x27;.&#x27;:&#x27;.$language);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $site_settings = $cache-&gt;data;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$cellarIntro = $site_settings[&#x27;cellar_master_intro&#x27;];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if (method_exists($cellarIntro, &#x27;hasTranslation&#x27;) &amp;&amp; $cellarIntro-&gt;hasTranslation($language)) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $cellarIntro = $cellarIntro-&gt;getTranslation($language);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$str = $cellarIntro[&#x27;my-key&#x27;][&#x27;value&#x27;];</span></div></div></div></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="node"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#node" title="Direct link to heading">#</a>Node</h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="text-list-values-of-a-field"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#text-list-values-of-a-field" title="Direct link to heading">#</a>text list values of a field</h2><p>text list is difficult to manipulate. It&#x27;s easy to get the Id of the list, it&#x27;s not that easy to get its label.
1. get the id of the list : <code>$valBlend = $krug_id_edition-&gt;get(&#x27;field_blend&#x27;)-&gt;value;</code>
2. get the label of this id : <code>$blend = $krug_id_edition-&gt;get(&#x27;field_blend&#x27;)-&gt;getSetting(&#x27;allowed_values&#x27;)[$valBlend];</code>
3. If you want this label translated :</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-if codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $blend = \Drupal::languageManager()-&gt;getLanguageConfigOverride($language, &#x27;field.storage.node.field_blend&#x27;)-&gt;get(&#x27;settings&#x27;)[&#x27;allowed_values&#x27;][$valBlend][&#x27;label&#x27;];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="use-a-template-in-a-field"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-a-template-in-a-field" title="Direct link to heading">#</a>Use a template in a field</h2><p>Imagine that you want to propose a text including variables corresponding to other values in the node. In our example, we want to write :
&#x27;This wine is composed by X wines of Y different years&#x27;
You may create a text field in this form : &#x27;This wine is composed by [X] wines of [Y] different years&#x27;
field X will be replaced with the &#x27;field_number&#x27; field
field Y will be replaced with the &#x27;field_years&#x27; field</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$numberWines = $krug_id_edition-&gt;get(&#x27;field_number&#x27;)-&gt;value;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$numberyears = $krug_id_edition-&gt;get(&#x27;field_years&#x27;)-&gt;value;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$text = $krug_id_edition-&gt;get(&#x27;field_text&#x27;)-&gt;value;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$text = str_replace(&#x27;[field_number_of_wines]&#x27;, $numberWines, $text);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$text = str_replace(&#x27;[field_number_of_years]&#x27;, $numberyears, $text);</span></div></div></div></div></div><p>This way, it&#x27;s easy to compose complex sentences including &#x27;token&#x27; of the node. In Twig, you can replace these values by creating a Twig function.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="drupal-commerce"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#drupal-commerce" title="Direct link to heading">#</a>Drupal Commerce</h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="create-a-checkout-pane"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-a-checkout-pane" title="Direct link to heading">#</a>Create a checkout pane</h2><ul><li>cf. <a href="https://docs.drupalcommerce.org/commerce2/developer-guide/checkout/create-custom-checkout-pane">https://docs.drupalcommerce.org/commerce2/developer-guide/checkout/create-custom-checkout-pane</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="what-is-a-checkout-pane-"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-is-a-checkout-pane-" title="Direct link to heading">#</a>What is a checkout pane ?</h3><ol><li>It&#x27;s a section you can place/replace in commerce checkout flows(form) section.</li><li>Path =&gt; /admin/commerce/config/checkout-flows/manage/default</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="create-custom-pane-module"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-custom-pane-module" title="Direct link to heading">#</a>Create custom pane module</h3><ol><li>name your custom module (example: my_checkout_pane)</li><li>In this module create my_checkout_pane.info.yml fill it with your module infos :</li></ol><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">name: My Checkout Pane</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">type: module</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">description: Defines custom checkout panes.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">core: 8.x</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">package: Custom</span></div></div></div></div></div><ol><li>You can now create your php file in src/Plugin/Commerce/CheckoutPane/ and name it (example: <code>CustomMessagePane.php</code>):</li></ol><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">namespace Drupal\my_checkout_pane\Plugin\Commerce\CheckoutPane;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use Drupal\commerce_checkout\Plugin\Commerce\CheckoutPane\CheckoutPaneBase;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use Drupal\Core\Form\FormStateInterface;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * Provides a custom message pane.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @CommerceCheckoutPane(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *   id = &quot;my_checkout_pane_custom_message&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *   label = @Translation(&quot;Custom message&quot;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class CustomMessagePane extends CheckoutPaneBase {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  /**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   * {@inheritdoc}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public function buildPaneForm(array $pane_form, FormStateInterface $form_state, array &amp;$complete_form) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="create-a-field-in-a-form-a-pane-form"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-a-field-in-a-form-a-pane-form" title="Direct link to heading">#</a>Create a field in a form/ a pane form</h3><ol><li>To create a field in a form for example you have to use a form builder <code>protect function buildForm(array $form, FormStateInterface $form_state, array &amp;$complete_form)</code></li><li>Then in the region you want to add a field place the it.</li></ol><ul><li>Example for markup field :<div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$form[&#x27;message&#x27;] = [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;#markup&#x27; =&gt; $this-&gt;t(&#x27;This is my custom message.&#x27;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">];</span></div></div></div></div></div></li><li>Example for textfield :<div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$form[&#x27;message&#x27;] = [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;#type&#x27; =&gt; &#x27;textfield&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;#title&#x27; =&gt; $this-&gt;t(&#x27;My text field&#x27;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;#default_value&#x27; =&gt; &#x27;This is a textfield&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;#size&#x27; =&gt; 60,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">];</span></div></div></div></div></div></li><li>Example for checkbox field :<div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$form[&#x27;checkField&#x27;] = [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;#type&#x27; =&gt; &#x27;checkbox&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;#title&#x27; =&gt; t(&#x27;New option checkbox&#x27;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;required&#x27; =&gt; TRUE,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;#weight&#x27; =&gt; 10,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">];</span></div></div></div></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="créer-un-web-service"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#créer-un-web-service" title="Direct link to heading">#</a>Créer un web service</h2><ol><li>Définir une route dans mon_module.routing.yml:</li></ol><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">flag_vote.vote:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  path: &#x27;/flagvote/vote/{flag}/{entityId}/{timing}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  defaults:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    _controller: &#x27;\Drupal\mon_module\Controller\MonModuleController::vote&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  requirements:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    _access: &#x27;TRUE&#x27;</span></div></div></div></div></div><ol start="2"><li>Aller créer dans Controller\MonModuleController le controleur (ex.) :</li></ol><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;?php</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">namespace Drupal\flag_vote\Controller;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use GuzzleHttp\Client;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use Drupal\Core\Url;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use Drupal\Core\Controller\ControllerBase;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use Drupal\Component\Serialization\Json;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use \Symfony\Component\HttpFoundation\Response;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use Drupal\flag\FlagInterface;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use Drupal\flag\FlagServiceInterface;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">//require_once DRUPAL_ROOT . &#x27;/modules/contrib/devel/kint/kint/Kint.class.php&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">//\Kint::dump($flagging);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class FlagVoteController extends ControllerBase</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public function vote(FlagInterface $flag, $entityId, $timing)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $account = \Drupal::currentUser();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Votre code</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $response = new Response();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $res = [&quot;result&quot; =&gt; &quot;ok&quot;];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $response-&gt;setContent(json_encode($res, JSON_FORCE_OBJECT));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $response-&gt;headers-&gt;set(&#x27;Content-Type&#x27;, &#x27;application/json&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return $response;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="ajouter-des-paramètres-de-configuration-à-votre-module"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#ajouter-des-paramètres-de-configuration-à-votre-module" title="Direct link to heading">#</a>Ajouter des paramètres de configuration à votre module</h2><p>se référer au module ina_video pour avoir un webservice + config</p><ul><li>Ajouter ces répertoires / fichiers :</li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/config/install/ina_video.settings.yml : Définit les valeurs des paramètres par défaut</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/config/schema/import_content.schema.yml : Définit la liste des paramètres</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/src/Form/InaVideoConfigForm.php : Définit le formulaire de saisie dans le BO</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/ina_video.links.menu.yml : Définit l&#x27;endroit dans le BO ou s&#x27;affiche cette configuration</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/ina_video.permissions.yml : Définit les permissions nécessaires pour accéder à la config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/ina_video.routing.yml : Relie la route définie au formulaire</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="empêcher-la-mise-en-cache-dun-node-ou-type-de-node-spécifique"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#empêcher-la-mise-en-cache-dun-node-ou-type-de-node-spécifique" title="Direct link to heading">#</a>Empêcher la mise en cache d&#x27;un node ou type de node spécifique</h2><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function playground_node_view(array &amp;$build, \Drupal\node\Entity\Node $node, $display, $view_mode) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if ($node-&gt;getType() == &#x27;article&#x27; &amp;&amp; $view_mode == &#x27;full&#x27;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $paragraphs = $node-&gt;field_body-&gt;referencedEntities();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    foreach ( $paragraphs as $paragraph ) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if ($paragraph-&gt;bundle() === &#x27;playground&#x27;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $build[&#x27;#cache&#x27;][&#x27;max-age&#x27;] = 0;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="modifier-la-valeur-dun-paragraphe-par-appel-webservice"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#modifier-la-valeur-dun-paragraphe-par-appel-webservice" title="Direct link to heading">#</a>Modifier la valeur d&#x27;un paragraphe par appel webservice</h2><p>Ce code est à utiliser avec le chapitre &quot;empêcher la mise en cache d&#x27;un node ou type de node spécifique&quot; pour que l&#x27;appel ait lieu à chaque chargement de page (attention aux perf, il faut que cette page soit rarement utilisée donc pas sur la home !) Une meilleure option est de créer un appel ajax.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * PLAYGROUND</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * You need to create a paragraph named &quot;playground&quot; including a field &quot;field_playground_url&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * which will contain the relative game URL (ie. for http://www.playground.gg/postvote/mygame, just enter &quot;postvote/mygame&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * Then, if we detect such a pargraph in a page, we uncache the page and call playground to obtain a token for a user</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * thanks to the apiKey + playgroundUrl + email</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * The token is then used to create an iframe with the token + email as parameter.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * See below to have an example of the twig for the payground paragraph</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">function playground_preprocess_paragraph__playground(&amp;$variables) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $conf = \Drupal::configFactory()-&gt;getEditable(&#x27;playground.settings&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $account = \Drupal::currentUser();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $client = new Client([ &#x27;verify&#x27; =&gt; false ]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    try {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $apiKey = $conf-&gt;get(&#x27;username&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $host = $conf-&gt;get(&#x27;url&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $queries = &#x27;?apiKey=&#x27; . $apiKey . &#x27;&amp;email=&#x27; . $account-&gt;getEmail();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $from_url = $host . &#x27;/total-login&#x27; . $queries;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $response = $client-&gt;get(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          $from_url,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          array(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;headers&#x27; =&gt; array(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &#x27;Accept&#x27; =&gt; &#x27;application/json&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;auth&#x27; =&gt; [&#x27;playground&#x27;, &#x27;RfPRhS7F2T&#x27;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $data = Json::decode($response-&gt;getBody());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $returnUrl = $host . &#x27;/return-url&#x27; . &#x27;?token=&#x27; . $data[&#x27;token&#x27;] . &#x27;&amp;email=&#x27; . $account-&gt;getEmail() . &#x27;&amp;return=&#x27; . $variables[&#x27;content&#x27;][&#x27;field_playground_url&#x27;][0][&#x27;#context&#x27;][&#x27;value&#x27;];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $variables[&#x27;content&#x27;][&#x27;field_playground_url&#x27;][0][&#x27;#context&#x27;][&#x27;value&#x27;] = $returnUrl;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $variables[&#x27;paragraph&#x27;]-&gt;set(&#x27;field_playground_url&#x27;, $returnUrl);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    } catch (RequestException $e) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        \Drupal::logger(&#x27;playground_paragraph&#x27;)-&gt;error(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;Status code @status_code: @message&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            array(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;@status_code&#x27; =&gt; $e-&gt;getCode(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;@message&#x27; =&gt; $e-&gt;getMessage(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="créer-une-extension-twig"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#créer-une-extension-twig" title="Direct link to heading">#</a>Créer une extension Twig</h2><p>Se référer au module Customization de SVOD-DEV</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="créer-un-formulaire-avec-un-theme-spécifique"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#créer-un-formulaire-avec-un-theme-spécifique" title="Direct link to heading">#</a>Créer un formulaire avec un theme spécifique</h2><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function h1765_theme_suggestions_item_list_alter(array &amp;$suggestions, array $variables) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if (isset($variables[&#x27;attributes&#x27;][&#x27;template&#x27;])) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $suggestions[] = &#x27;item_list__&#x27; . $variables[&#x27;attributes&#x27;][&#x27;template&#x27;];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>(ici, c&#x27;est dans un module qu&#x27;on a créé cette item_list:)</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$form[$attributeId.&#x27;-links&#x27;] = [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;#theme&#x27; =&gt; &#x27;item_list&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;#items&#x27; =&gt; $pop_array,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;#attributes&#x27; =&gt; array(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;class&#x27; =&gt; array(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;pop-list&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $attributeId.&#x27;-pop&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;cp-list-tags&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;cp-list-tags--default&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;template&#x27; =&gt; &#x27;filter&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;#wrapper_attributes&#x27; =&gt; array(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;id&#x27; =&gt; $attributeId.&#x27;-pop&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">];</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="créer-un-module-de-block-recevant-le-node-sur-lequel-il-apparait-en-contexte"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#créer-un-module-de-block-recevant-le-node-sur-lequel-il-apparait-en-contexte" title="Direct link to heading">#</a>Créer un module de block recevant le node sur lequel il apparait en contexte</h2><p>Dans src/Plugin/Block/MonBlock.php mettre cette annotation:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @Block(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *   id = &quot;instagram_block_block&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *   admin_label = @Translation(&quot;Instagram block&quot;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *   category = @Translation(&quot;Social&quot;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *   context = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *     &quot;node&quot; = @ContextDefinition(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *       &quot;entity:node&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *       required = FALSE,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *     )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class InstagramBlockBlock extends BlockBase implements ContainerFactoryPluginInterface</span></div></div></div></div></div><p>Mettre le node en context avec required= FALSE permet de ne pas rendre obligatoire ce contexte.
Dans build(), pour récupérer le node : <code>$node = $this-&gt;getContextValue(&#x27;node&#x27;);</code></p><p>(l&#x27;id qui se trouve dans ce bloc de commentaire est utilisé par Twig tweak pour afficher un block).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="mettre-en-cache-le-resultat-dun-appel-externe"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#mettre-en-cache-le-resultat-dun-appel-externe" title="Direct link to heading">#</a>Mettre en cache le resultat d&#x27;un appel externe</h2><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $posts = [];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $cid = &#x27;facebook_feed_block:feeds&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if ($cache = \Drupal::cache()-&gt;get($cid)) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $posts = $cache-&gt;data;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    else {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $response = \Drupal::httpClient()-&gt;get($url, [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;headers&#x27; =&gt; array(&#x27;Accept&#x27; =&gt; &#x27;text/plain&#x27;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;timeout&#x27; =&gt;  5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $posts = json_decode((string) $response-&gt;getBody())-&gt;data;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      \Drupal::cache()-&gt;set($cid, $posts, REQUEST_TIME + (60*60*4));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return $posts;</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="obtenir-le-chemin-du-theme-actif"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#obtenir-le-chemin-du-theme-actif" title="Direct link to heading">#</a>obtenir le chemin du theme actif</h2><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$theme_handler = \Drupal::service(&#x27;theme_handler&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$default_theme = $theme_handler-&gt;getDefault();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$theme_path = $theme_handler-&gt;getTheme($default_theme)-&gt;getPath();</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="créer-du-html-depuis-php"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#créer-du-html-depuis-php" title="Direct link to heading">#</a>créer du html depuis php</h2><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$decoration = $dom-&gt;createDocumentFragment();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$decoration-&gt;appendXML(&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;span class=&quot;footnote__decoration&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;svg class=&quot;hidden-xs hidden-sm&quot; width=&quot;17&quot; height=&quot;152&quot; viewBox=&quot;0 0 17 152&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;path d=&quot;M16.5 151.758V.169c0 40.062-16 55.261-16 75.795 0 20.533 16 35.404 16 75.794z&quot; fill=&quot;#00B374&quot; fill-rule=&quot;nonzero&quot;&gt;&lt;/path&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;/svg&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;svg class=&quot;visible-xs-block visible-sm-block&quot; width=&quot;151&quot; height=&quot;16&quot; viewBox=&quot;0 0 151 16&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;path d=&quot;M-.258 16h151.589C111.269 16 96.07 0 75.536 0 55.003 0 40.132 16-.258 16z&quot; fill=&quot;#00B374&quot; fill-rule=&quot;nonzero&quot;&gt;&lt;/path&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;/svg&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;/span&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$theme_handler = \Drupal::service(&#x27;theme_handler&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$default_theme = $theme_handler-&gt;getDefault();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$theme_path = $theme_handler-&gt;getTheme($default_theme)-&gt;getPath();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$btnClose = $dom-&gt;createDocumentFragment();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$btnClose-&gt;appendXML(&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;a href=&#x27;#&#x27; class=&#x27;btn-close&#x27;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;img src=&#x27;$theme_path/images/close.svg&#x27;/&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;/a&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$blocknote = $dom-&gt;createElement(&#x27;div&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$blocknote-&gt;setAttribute(&#x27;class&#x27;, &#x27;footnote-holder&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$blocknote-&gt;setAttribute(&#x27;id&#x27;, &quot;footnote$idNote&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnote =  $dom-&gt;createElement(&#x27;div&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnote-&gt;setAttribute(&#x27;class&#x27;, &#x27;footnote&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnoteTitle =  $dom-&gt;createElement(&#x27;div&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnoteTitle-&gt;setAttribute(&#x27;class&#x27;, &#x27;footnote__title&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnoteTitleSpan =  $dom-&gt;createElement(&#x27;span&#x27;, &quot;($idNote)&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnoteTitleSpan-&gt;setAttribute(&#x27;class&#x27;, &#x27;count&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnoteEntry =  $dom-&gt;createElement(&#x27;div&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnoteEntry-&gt;setAttribute(&#x27;class&#x27;, &#x27;footnote__entry&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnoteEntryP =  $dom-&gt;createElement(&#x27;p&#x27;, $nodeText);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnoteTitle-&gt;appendChild($footnoteTitleSpan);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnoteEntry-&gt;appendChild($footnoteEntryP);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnote-&gt;appendChild($decoration);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnote-&gt;appendChild($btnClose);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnote-&gt;appendChild($footnoteTitle);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnote-&gt;appendChild($footnoteEntry);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$blocknote-&gt;appendChild($footnote);</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="envoyer-un-mail"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#envoyer-un-mail" title="Direct link to heading">#</a>Envoyer un mail</h2><p>Dans custom module, déclencher sur save:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public function save(array $form, FormStateInterface $form_state) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $entity = $this-&gt;entity;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $status = parent::save($form, $form_state);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $values=$form_state-&gt;getValues();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if (($values[&#x27;isurgent&#x27;][&#x27;value&#x27;]==1) &amp;&amp; ($values[&#x27;status&#x27;][&#x27;value&#x27;]==1)) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $iSeliste = \Drupal::currentUser()-&gt;id();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $oSeliste = \Drupal::entityTypeManager()-&gt;getStorage(&#x27;person&#x27;)-&gt;load($iSeliste);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $sSelite = $oSeliste-&gt;firstname-&gt;value . &quot; &quot; . $oSeliste-&gt;lastname-&gt;value;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $sAction = ($values[&#x27;action&#x27;][0][&#x27;value&#x27;]==0)?&quot;offre&quot;:&quot;demande&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $sDueDate = $values[&#x27;duedate&#x27;][0][&#x27;value&#x27;]-&gt;format(&quot;d/m/Y&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    _sendEmailForUrgentService($sSelite, $sAction, $sDueDate);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">function _sendEmailForUrgentService($sSeliste, $sAction, $sDueDate) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  \Drupal::service(&#x27;plugin.manager.mail&#x27;)-&gt;mail(&#x27;sel&#x27;, &#x27;emailforurgentservice&#x27;, $sTo, &#x27;fr&#x27;, $params);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  \Drupal::logger(&#x27;sel&#x27;)-&gt;info(&#x27;Courriel pour service urgent : envoi effectué.&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>my hook_mail:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function sel_mail($key, &amp;$message, $params) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $sFrom = &#x27;[redacted]&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $message[&#x27;from&#x27;] = $sFrom;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $message[&#x27;headers&#x27;] = array(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;Content-Type&#x27; =&gt; &#x27;text/html&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;bcc&#x27; =&gt; $params[3],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;From&#x27; =&gt; $sFrom,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;Sender&#x27; =&gt; $sFrom,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;Return-Path&#x27; =&gt; $sFrom,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  switch ($key) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    case &#x27;emailforurgentservice&#x27;:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $message[&#x27;subject&#x27;] = &#x27;[Le Grenier à SÉL] Un service urgent requiert votre attention...&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $sBody  = $params[0] . &quot; a posté une &quot; . $params[1] . &quot; urgente qui est valide jusqu&#x27;au &quot; . $params[2] . &quot;.&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $message[&#x27;body&#x27;][] = check_markup(nl2br($sBody), &#x27;full_html&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      break;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>And in my theme templates folder (mysite/web/themes/contrib/mayo/templates/), there is my email template swiftmailer--sel--emailforurgentservice.html.twig:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;html&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;head&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;style type=&quot;text/css&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;/style&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/head&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;body&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;div&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;table width=&quot;800px&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;tr&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;td&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;div style=&quot;padding: 0px 0px 0px 0px;&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &lt;p&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    {{ body }}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &lt;/p&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;/div&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;/td&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;/tr&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;/table&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/div&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/body&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/html&gt;</span></div></div></div></div></div><p>#iframe</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="source-de-liframe-example"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#source-de-liframe-example" title="Direct link to heading">#</a>source de l&#x27;iframe (example)</h2><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-html codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">style</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">type</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">text/css</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token style language-css selector" style="color:rgb(199, 146, 234)">main</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token style language-css"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token style language-css"></span><span class="token style language-css property">width</span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token style language-css"> </span><span class="token style language-css number" style="color:rgb(247, 140, 108)">100</span><span class="token style language-css unit">%</span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token style language-css"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token style language-css"></span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token style language-css"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token style language-css"></span><span class="token style language-css selector class" style="color:rgb(199, 146, 234)">.field-name-body.field-type-text-with-summary</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token style language-css"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token style language-css"></span><span class="token style language-css property">margin</span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token style language-css"> </span><span class="token style language-css number" style="color:rgb(247, 140, 108)">0</span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token style language-css"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token style language-css"></span><span class="token style language-css property">padding</span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token style language-css"> </span><span class="token style language-css number" style="color:rgb(247, 140, 108)">0</span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token style language-css"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token style language-css"></span><span class="token style language-css property">width</span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token style language-css"> </span><span class="token style language-css number" style="color:rgb(247, 140, 108)">100</span><span class="token style language-css unit">%</span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token style language-css"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token style language-css"></span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token style language-css"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token style language-css"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">style</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">iframe</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">height</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">1600</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">id</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">ifrm</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">src</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://dev.krug.com:8800/rockpepperscissors/</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">width</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">100%</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">iframe</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="allow-style-tag-in-ckeditor"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#allow-style-tag-in-ckeditor" title="Direct link to heading">#</a>Allow style tag in ckeditor</h2><ul><li><code>admin/config/content/ckeditor/edit/Full</code></li><li><code>Advanced content filter</code> to <code>disabled</code> and <code>save</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="static"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#static" title="Direct link to heading">#</a>Static</h2><p>The static should be put in files directory of the drupal.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="config-nginx"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#config-nginx" title="Direct link to heading">#</a>Config nginx</h2><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-nginx codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    location ~ /whatyouwantasurl/?(.*)$ {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        alias /absolute/path/to/files/staticsitedirectory/$1;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        index index.html;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div></div></div></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="embed-dune-url-interdite-par-le-site-drupal"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#embed-dune-url-interdite-par-le-site-drupal" title="Direct link to heading">#</a>Embed d&#x27;une URL interdite par le site drupal</h1><p>Il faut configurer le header <code>X-Frame-Options:</code></p><ul><li>Installation du module <code>https://www.drupal.org/project/x_frame_options</code></li><li>Commande en composer: <code>composer require &#x27;drupal/x_frame_options:^1.1&#x27;</code></li><li>Activer le module en B.O. <code>admin/config/system/x_frame_options_configuration/settings</code></li><li>Select <code>ALLOW-FROM uri</code> and <code>Uri field</code> <code>*</code></li><li>Vous pouvez restreindre l&#x27;accès à une URL si vous le souhaitez.</li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="astuces"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#astuces" title="Direct link to heading">#</a>Astuces</h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="twig"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#twig" title="Direct link to heading">#</a>Twig</h2><ol><li><p>La concaténation de strings :</p><ul><li>&quot;Heure de publication: &quot; ~ {{ node.field_published.value }}</li><li>&quot;background-image: url(#{file_url(node.field_visuel_push.entity.field_media_image.entity.uri.value)});&quot;</li></ul></li><li><p>Réduction de string :</p><blockquote><p> Pour couper une chaîne de caractere si elle est trop longue et rajouter &#x27;...&#x27; a la fin</p></blockquote><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{{ chemin.du.text.value|length &gt; 20 ? chemin.du.text.value|slice(0, 20) ~ &#x27;...&#x27; : chemin.du.text.value  }}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/* ici la chaine de caractere est couper au caractere 20 */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div></li></ol><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="envoyer-un-mail-du-compte-client-en-html"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#envoyer-un-mail-du-compte-client-en-html" title="Direct link to heading">#</a>Envoyer un mail du compte client en html</h1><p>Source : <code>https://www.flocondetoile.fr/blog/send-transactional-emails-related-user-account-html-format-drupal-8</code></p><ul><li>Configurer le type de mail envoyé par Swiftmailer dans <code>admin/config/swiftmailer/messages</code> cocher <code>HTML</code></li><li>Configurer les mails dans l&#x27;admin (configuration/personnes/paramètres de compte, tout en bas)</li><li>ajouter dans un module custom - par exemple - <code>customization</code></li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-php codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">use</span><span class="token plain"> </span><span class="token package">Drupal</span><span class="token package punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token package">component</span><span class="token package punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token package">render</span><span class="token package punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token package">FormattableMarkup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"> * Implements hook_mail_alter().</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"> */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">MYMODULE_mail_alter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token variable" style="color:rgb(191, 199, 213)">$message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;key&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;page_mail&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;page_copy&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;cancel_confirm&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;password_reset&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;register_admin_created&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;register_no_approval_required&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;register_pending_approval&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;register_pending_approval_admin&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;status_activated&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;status_blocked&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;status_canceled&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token variable" style="color:rgb(191, 199, 213)">$message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;headers&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;Content-Type&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;text/html; charset=UTF-8; format=flowed; delsp=yes&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;body&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$key</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$body</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token variable" style="color:rgb(191, 199, 213)">$message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token single-quoted-string string" style="color:rgb(195, 232, 141)">&#x27;body&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token variable" style="color:rgb(191, 199, 213)">$key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">FormattableMarkup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$body</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">break</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="envoyer-un-mail-en-html-depuis-votre-module"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#envoyer-un-mail-en-html-depuis-votre-module" title="Direct link to heading">#</a>Envoyer un mail en html depuis votre module</h1><p>Ce qui peut sembler complexe dans Drupal - envoyer un mail en HTML depuis votre module, est en fait très simple et se déroule en 6 étapes :</p><ol><li>Installer swiftmailer</li><li><code>/admin/config/system/mailsystem</code> configurer mailsystem:</li></ol><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Set &#x27;Default formatter&#x27; and &#x27;Default sender&#x27; to Swiftmailer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Set &#x27;Theme to render the emails&#x27; to your custom theme</span></div></div></div></div></div><ol start="3"><li><code>/admin/config/swiftmailer/messages</code> configurer swiftmailer:</li></ol><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Set &#x27;Message format&#x27; to html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Disable &#x27;Respect provided e-mail format.&#x27;</span></div></div></div></div></div><ol start="4"><li>Dans votre fonction de votre module qui doit envoyer le mail</li></ol><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$params = [];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$params[&#x27;options&#x27;][&#x27;username&#x27;] = $user-&gt;getUsername();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Drupal::service(&#x27;plugin.manager.mail&#x27;)-&gt;mail(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;customization&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;invitation_validation&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $email,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  \Drupal::config(&#x27;system.site&#x27;)-&gt;get(&#x27;langcode&#x27;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $params,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;no-reply@test.com&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div></div></div></div></div><p><code>$mailManager-&gt;mail($module, $key, $to, $langcode, $params, $reply, $send);</code></p><ul><li>$module qui servira ultérieurement à la sélection du Plugin responsable de l&#x27;envoi du mail.</li><li>$key qui va permettre d&#x27;identifier ce mail.</li><li>$to qui est le destinataire du mail</li><li>$langcode correspond à la langue dans lequel le mail doit être envoyé.</li><li>Le tableau $params contient les données qui seront utilisées dans le twig et pour formater le mail (subject, ...)</li><li>$reply est l&#x27;adresse mail de réponse</li><li>$send demande l&#x27;envoi du mail.</li></ul><ol start="5"><li>dans <code>MON_MODULE.module</code>, on crée la définition de ce mail dans le hook <code>MON_MODULE_mail</code>:</li></ol><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function MON_MODULE_mail($key, &amp;$message, $params)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  switch ($key) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    case &#x27;invitation_validation&#x27;:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $message[&#x27;from&#x27;] = \Drupal::config(&#x27;system.site&#x27;)-&gt;get(&#x27;mail&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $message[&#x27;headers&#x27;][&#x27;Content-Type&#x27;] = &#x27;text/html; charset=UTF-8; format=flowed; delsp=yes&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $message[&#x27;subject&#x27;] = &#x27;Your request has been accepted&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $message[&#x27;options&#x27;] = $params[&#x27;options&#x27;];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      return $message;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      break;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><ol start="6"><li>Il reste à créer le twig du mail dans votre thème. Le nom de votre template devra s&#x27;appeler <code>swiftmailer--MON_MODULE--MA_CLEF_MAIL.html.twig</code>
dans notre exemple, si j&#x27;ai créé le hook <code>customization_mail</code> dans le module <code>customization</code>, mon template de mail devra s&#x27;appeler : <code>swiftmailer--customization--invitation-validation.html.twig</code></li></ol><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;!doctype html&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;html&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;head&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;title&gt;&lt;/title&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/head&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;body&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;table&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;tr&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;td&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &lt;div class=&quot;content&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;table&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &lt;tr&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;td&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              {{ message.options.username }}, you may now access the &lt;a href=&quot;www.livingcolor.fr&quot;&gt;Livingcolor website&lt;/a&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;/td&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &lt;/tr&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;/table&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &lt;/div&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;/td&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;/tr&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/table&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/body&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/html&gt;</span></div></div></div></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="cookie"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#cookie" title="Direct link to heading">#</a>COOKIE</h1><p>Pour utiliser un cookie en Twig il faut au préalable créer une fonction php pour récupérer sa valeur .</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> function getCookie($attribute){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (isset($_COOKIE[$attribute])) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return ($_COOKIE[$attribute]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          return &quot;&quot; ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div></div></div></div></div><p>Pour cela créer votre fonction dans le fichier TwigExtension.php</p><blockquote><p>...\krugrefv2-dev\public\sites\default\modules\custom\customization\src\TwigExtension.php</p></blockquote><p>Afin que votre fonction puisse être utiliser en Twig il n&#x27;y a plus qu&#x27;a ajouter celle-ci dans ce getter</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/* In this function we can declare the extension function. */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public function getFunctions()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return array(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            new \Twig_SimpleFunction(&#x27;get_cookie&#x27;, array($this, &#x27;getCookie&#x27;), array(&#x27;is_safe&#x27; =&gt; array(&#x27;html&#x27;))),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div></div></div></div></div><p>Maintenant dans le fichier .twig appeler votre fonction</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{{ get_cookie(&#x27;age-gate&#x27;) }}</span></div></div></div></div></div><p>Afin d&#x27;utiliser les valeurs du cookie qui sont ici une liste de string JSON .
Il faudra utiliser  le template twig |split</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{% set cookie = get_cookie(&#x27;age-gate&#x27;)|split(&#x27;&quot;&#x27;)  %}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="limiter-les-dates-dans-un-champs-date"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#limiter-les-dates-dans-un-champs-date" title="Direct link to heading">#</a>Limiter les dates dans un champs date</h1><ol><li>Créer le champ date en BO (exemple: field_date)</li><li>Dans le .theme éditer les formulaires et étendre le #after_build du champ date :</li></ol><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function h1765_form_alter(&amp;$form, $form_state, $form_id) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if (isset($form[&#x27;actions&#x27;])) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if ($form[&#x27;#form_id&#x27;] === &quot;node_annonce_edit_form&quot; || $form[&#x27;#form_id&#x27;] === &quot;node_annonce_form&quot;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $form[&#x27;field_date&#x27;][&#x27;widget&#x27;][&#x27;#after_build&#x27;] =  array(&quot;custom_range_date&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><ol><li>Créer la fonction qui va gérer les restrictions de la date (ici restrictions que sur l&#x27;année):</li></ol><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function custom_range_date($form_element, &amp;$form_state){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  foreach ($form_element[0][&#x27;value&#x27;][&#x27;year&#x27;][&#x27;#options&#x27;] as $option) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if ($option &lt; date(&quot;Y&quot;)) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      unset($form_element[0][&#x27;value&#x27;][&#x27;year&#x27;][&#x27;#options&#x27;][$option]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return $form_element;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="rediriger-un-utilisateur-au-login-en-fonction-de-son-profil"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#rediriger-un-utilisateur-au-login-en-fonction-de-son-profil" title="Direct link to heading">#</a>Rediriger un utilisateur au login en fonction de son profil</h1><p>ATTENTION : NE JAMAIS UTILISER <code>REDIRECT</code> DANS LE HOOK _user_login (cela ne fonctionne pas correctement)</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function MYMODULE_user_login($account)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $user = \Drupal::currentUser();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $route_name = \Drupal::routeMatch()-&gt;getRouteName();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if (</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $route_name !== &#x27;user.reset.login&#x27; &amp;&amp;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    !in_array(&#x27;utilisateur_invite&#x27;, $user-&gt;getRoles()) &amp;&amp;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    !in_array(&#x27;administrateur_region&#x27;, $user-&gt;getRoles()) &amp;&amp;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    !in_array(&#x27;administrator&#x27;, $user-&gt;getRoles())</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $current_request = \Drupal::service(&#x27;request_stack&#x27;)-&gt;getCurrentRequest();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $current_request-&gt;query-&gt;set(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;destination&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;/form/invite&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/dynamisation/domains"><div class="pagination-nav__link--sublabel">Previous</div><div class="pagination-nav__link--label">« domains</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/dev/debug"><div class="pagination-nav__link--sublabel">Next</div><div class="pagination-nav__link--label">debug »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#text-list-values-of-a-field" class="contents__link">text list values of a field</a></li><li><a href="#use-a-template-in-a-field" class="contents__link">Use a template in a field</a></li><li><a href="#create-a-checkout-pane" class="contents__link">Create a checkout pane</a><ul><li><a href="#what-is-a-checkout-pane-" class="contents__link">What is a checkout pane ?</a></li><li><a href="#create-custom-pane-module" class="contents__link">Create custom pane module</a></li><li><a href="#create-a-field-in-a-form-a-pane-form" class="contents__link">Create a field in a form/ a pane form</a></li></ul></li><li><a href="#créer-un-web-service" class="contents__link">Créer un web service</a></li><li><a href="#ajouter-des-paramètres-de-configuration-à-votre-module" class="contents__link">Ajouter des paramètres de configuration à votre module</a></li><li><a href="#empêcher-la-mise-en-cache-dun-node-ou-type-de-node-spécifique" class="contents__link">Empêcher la mise en cache d&#39;un node ou type de node spécifique</a></li><li><a href="#modifier-la-valeur-dun-paragraphe-par-appel-webservice" class="contents__link">Modifier la valeur d&#39;un paragraphe par appel webservice</a></li><li><a href="#créer-une-extension-twig" class="contents__link">Créer une extension Twig</a></li><li><a href="#créer-un-formulaire-avec-un-theme-spécifique" class="contents__link">Créer un formulaire avec un theme spécifique</a></li><li><a href="#créer-un-module-de-block-recevant-le-node-sur-lequel-il-apparait-en-contexte" class="contents__link">Créer un module de block recevant le node sur lequel il apparait en contexte</a></li><li><a href="#mettre-en-cache-le-resultat-dun-appel-externe" class="contents__link">Mettre en cache le resultat d&#39;un appel externe</a></li><li><a href="#obtenir-le-chemin-du-theme-actif" class="contents__link">obtenir le chemin du theme actif</a></li><li><a href="#créer-du-html-depuis-php" class="contents__link">créer du html depuis php</a></li><li><a href="#envoyer-un-mail" class="contents__link">Envoyer un mail</a></li><li><a href="#source-de-liframe-example" class="contents__link">source de l&#39;iframe (example)</a></li><li><a href="#allow-style-tag-in-ckeditor" class="contents__link">Allow style tag in ckeditor</a></li><li><a href="#static" class="contents__link">Static</a></li><li><a href="#config-nginx" class="contents__link">Config nginx</a></li><li><a href="#twig" class="contents__link">Twig</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/setup/introduction">Docs</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://abecms.slack.com">Slack</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Website</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://livingcolor.fr">Website</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1Wg7"><img class="footer__logo" alt="Facebook Open Source Logo" src="https://docusaurus.io/img/oss_logo.png"></a></div><div>Copyright © 2020 Abe SAS. Built with Docusaurus.</div></div></div></footer>
</div>

<script src="/styles.2c614eb7.js"></script>

<script src="/runtime~main.53bc7229.js"></script>

<script src="/main.bae6580d.js"></script>

<script src="/1.add223de.js"></script>

<script src="/2.a785adde.js"></script>

<script src="/38.51af2228.js"></script>

<script src="/20ac7829.e17cb876.js"></script>

<script src="/17896441.3a92ccfa.js"></script>

<script src="/8037c9c6.797e19fd.js"></script>


</body>
</html>