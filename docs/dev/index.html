<!DOCTYPE html>
<html lang="en" data-theme="">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus">

<script type="text/javascript">/*<![CDATA[*/window.__chunkMapping={"17896441":["/17896441.e9c11e14.js"],"main":["/main.33f566fa.js"],"0e800433":["/0e800433.42d969ff.js"],"1be78505":[],"20ac7829":["/20ac7829.5e6f2fab.js"],"23d28cd9":["/23d28cd9.3ebaf342.js"],"3847b3ea":["/3847b3ea.bc3e66a8.js"],"3f607676":["/3f607676.f5ab2895.js"],"42b7455d":["/42b7455d.bff633b1.js"],"4cc4d2ba":["/4cc4d2ba.20b8dc5a.js"],"5caa2f80":["/5caa2f80.5f218aae.js"],"605b7772":["/605b7772.f4a03246.js"],"645d743a":["/645d743a.7c65d23b.js"],"683be167":["/683be167.edc449be.js"],"6aeeabde":["/6aeeabde.e88c0127.js"],"7047bd09":["/7047bd09.d96d4f9e.js"],"816165d5":["/816165d5.d0c55e5a.js"],"950718c7":["/950718c7.3cf64613.js"],"9ed00105":["/9ed00105.3a2bda90.js"],"a09c2993":["/a09c2993.7c1e6534.js"],"a303f551":["/a303f551.2c8ac8a9.js"],"ba0cd7c5":["/ba0cd7c5.1631c78c.js"],"c4f5d8e4":["/c4f5d8e4.6711272c.js"],"cbc948ce":["/cbc948ce.fac82fce.js"],"ce3e42ad":["/ce3e42ad.83614819.js"],"d59a3898":["/d59a3898.2916534c.js"],"febdf506":["/febdf506.c363fe48.js"]};/*]]>*/</script>

<title data-react-helmet="true">dev</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" property="og:title" content="Drupal Stickers Book · Build a Drupal website in no time !"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="description" content="# Headless"/><meta data-react-helmet="true" property="og:description" content="# Headless"/><meta data-react-helmet="true" property="og:url" content="https://drupal.livingcolor.academy/docs/dev"/>

<link data-react-helmet="true" rel="shortcut icon" href="/img/logo-white.png"/>


<link rel="stylesheet" type="text/css" href="/styles.fcdbc45b.css" />

</head>
<body >
<script type="text/javascript">(function() {
  function setDataThemeAttribute(theme) {
    document.querySelector('html').setAttribute('data-theme', theme);
  }
  
  var preferDarkQuery = '(prefers-color-scheme: dark)';
  var mql = window.matchMedia(preferDarkQuery);
  var supportsColorSchemeQuery = mql.media === preferDarkQuery;
  var localStorageTheme = null;
  try {
    localStorageTheme = localStorage.getItem('theme');
  } catch (err) {}
  var localStorageExists = localStorageTheme !== null;

  if (localStorageExists) {
    setDataThemeAttribute(localStorageTheme);
  } else if (supportsColorSchemeQuery && mql.matches) {
    setDataThemeAttribute('dark');
  }
})();</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.png" alt="livingcolor"/><strong class="">Drupal Stickers Recipes</strong></a><a class="navbar__item navbar__link" href="/docs/introduction">Docs</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/docusaurus">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"/></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.png" alt="livingcolor"/><strong>Drupal Stickers Recipes</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/introduction">Docs</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/docusaurus">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Setup</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/introduction">introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/setup">setup</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/configuration">configuration</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/multilingue">multilingue</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tests">tests</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/webforms">webforms</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Dynamisation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/nodes">nodes</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/paragraphs">paragraphs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/views">views</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/forms">forms</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/taxonomies">taxonomies</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tokens">tokens</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/images">images</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/users">users</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/comments">comments</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/newsletters">newsletters</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/menus">menus</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/ckeditor">ckeditor</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/modules">modules</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Dev specific</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/dev">dev</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">dev</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="headless"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#headless" title="Direct link to heading">#</a>Headless</h1><p>Utiliser exclusivement json:api + les extensions suivantes :</p><ul><li>&quot;drupal/consumer_image_styles&quot;: &quot;^3.0&quot;,</li><li>&quot;drupal/jsonapi_extras&quot;: &quot;^3.12&quot;</li></ul><p>Le premier permet d&#x27;afficher des styles spécifiques dans le retour json. On va d&#x27;abord sélectionner le consumer en choisissant les styles accessibles :
<code>/admin/config/services/consumer</code>
Puis dans la config json:api, on choisit le field qui affiche une image et on lui assigne les styles d&#x27;image.</p><p>Le second permet de configurer l&#x27;affichage json par type d&#x27;entité !</p><p>Au lieu d&#x27;avoir :</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/jsonapi/node/homepage?include=field_video_a_la_une,field_video_a_la_une.field_poster,field_video_a_la_une.field_media_video_file,field_video_a_la_une.field_category,field_paragraphes.field_reusable_paragraph.paragraphs.field_categorie&amp;fields[node--homepage]=field_titre&amp;fields[media--video]=field_titre,field_poster,field_duree&amp;fields[file--file]=uri&amp;fields[node--categorie]=drupal_internal__nid,title,field_couleur,field_description,field_description_courte</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>on peut avoir apres config :</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/jsonapi/node/homepage</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="dev-de-module"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#dev-de-module" title="Direct link to heading">#</a>Dev de module</h1><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="créer-un-web-service"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#créer-un-web-service" title="Direct link to heading">#</a>Créer un web service</h2><ol><li>Définir une route dans mon_module.routing.yml:</li></ol><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">flag_vote.vote:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  path: &#x27;/flagvote/vote/{flag}/{entityId}/{timing}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  defaults:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    _controller: &#x27;\Drupal\mon_module\Controller\MonModuleController::vote&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  requirements:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    _access: &#x27;TRUE&#x27;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><ol start="2"><li>Aller créer dans Controller\MonModuleController le controleur (ex.) :</li></ol><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;?php</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">namespace Drupal\flag_vote\Controller;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use GuzzleHttp\Client;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use Drupal\Core\Url;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use Drupal\Core\Controller\ControllerBase;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use Drupal\Component\Serialization\Json;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use \Symfony\Component\HttpFoundation\Response;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use Drupal\flag\FlagInterface;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use Drupal\flag\FlagServiceInterface;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">//require_once DRUPAL_ROOT . &#x27;/modules/contrib/devel/kint/kint/Kint.class.php&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">//\Kint::dump($flagging);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class FlagVoteController extends ControllerBase</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public function vote(FlagInterface $flag, $entityId, $timing)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $account = \Drupal::currentUser();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Votre code</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $response = new Response();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $res = [&quot;result&quot; =&gt; &quot;ok&quot;];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $response-&gt;setContent(json_encode($res, JSON_FORCE_OBJECT));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $response-&gt;headers-&gt;set(&#x27;Content-Type&#x27;, &#x27;application/json&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return $response;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="ajouter-des-paramètres-de-configuration-à-votre-module"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#ajouter-des-paramètres-de-configuration-à-votre-module" title="Direct link to heading">#</a>Ajouter des paramètres de configuration à votre module</h2><p>se référer au module ina_video pour avoir un webservice + config</p><ul><li>Ajouter ces répertoires / fichiers :</li></ul><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/config/install/ina_video.settings.yml : Définit les valeurs des paramètres par défaut</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/config/schema/import_content.schema.yml : Définit la liste des paramètres</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/src/Form/InaVideoConfigForm.php : Définit le formulaire de saisie dans le BO</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/ina_video.links.menu.yml : Définit l&#x27;endroit dans le BO ou s&#x27;affiche cette configuration</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/ina_video.permissions.yml : Définit les permissions nécessaires pour accéder à la config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/ina_video.routing.yml : Relie la route définie au formulaire</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="empêcher-la-mise-en-cache-dun-node-ou-type-de-node-spécifique"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#empêcher-la-mise-en-cache-dun-node-ou-type-de-node-spécifique" title="Direct link to heading">#</a>Empêcher la mise en cache d&#x27;un node ou type de node spécifique</h2><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function playground_node_view(array &amp;$build, \Drupal\node\Entity\Node $node, $display, $view_mode) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if ($node-&gt;getType() == &#x27;article&#x27; &amp;&amp; $view_mode == &#x27;full&#x27;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $paragraphs = $node-&gt;field_body-&gt;referencedEntities();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    foreach ( $paragraphs as $paragraph ) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if ($paragraph-&gt;bundle() === &#x27;playground&#x27;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $build[&#x27;#cache&#x27;][&#x27;max-age&#x27;] = 0;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="modifier-la-valeur-dun-paragraphe-par-appel-webservice"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#modifier-la-valeur-dun-paragraphe-par-appel-webservice" title="Direct link to heading">#</a>Modifier la valeur d&#x27;un paragraphe par appel webservice</h2><p>Ce code est à utiliser avec le chapitre &quot;empêcher la mise en cache d&#x27;un node ou type de node spécifique&quot; pour que l&#x27;appel ait lieu à chaque chargement de page (attention aux perf, il faut que cette page soit rarement utilisée donc pas sur la home !) Une meilleure option est de créer un appel ajax.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * PLAYGROUND</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * You need to create a paragraph named &quot;playground&quot; including a field &quot;field_playground_url&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * which will contain the relative game URL (ie. for http://www.playground.gg/postvote/mygame, just enter &quot;postvote/mygame&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * Then, if we detect such a pargraph in a page, we uncache the page and call playground to obtain a token for a user</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * thanks to the apiKey + playgroundUrl + email</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * The token is then used to create an iframe with the token + email as parameter.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * See below to have an example of the twig for the payground paragraph</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">function playground_preprocess_paragraph__playground(&amp;$variables) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $conf = \Drupal::configFactory()-&gt;getEditable(&#x27;playground.settings&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $account = \Drupal::currentUser();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $client = new Client([ &#x27;verify&#x27; =&gt; false ]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    try {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $apiKey = $conf-&gt;get(&#x27;username&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $host = $conf-&gt;get(&#x27;url&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $queries = &#x27;?apiKey=&#x27; . $apiKey . &#x27;&amp;email=&#x27; . $account-&gt;getEmail();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $from_url = $host . &#x27;/total-login&#x27; . $queries;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $response = $client-&gt;get(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          $from_url,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          array(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;headers&#x27; =&gt; array(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &#x27;Accept&#x27; =&gt; &#x27;application/json&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;auth&#x27; =&gt; [&#x27;playground&#x27;, &#x27;RfPRhS7F2T&#x27;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $data = Json::decode($response-&gt;getBody());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $returnUrl = $host . &#x27;/return-url&#x27; . &#x27;?token=&#x27; . $data[&#x27;token&#x27;] . &#x27;&amp;email=&#x27; . $account-&gt;getEmail() . &#x27;&amp;return=&#x27; . $variables[&#x27;content&#x27;][&#x27;field_playground_url&#x27;][0][&#x27;#context&#x27;][&#x27;value&#x27;];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $variables[&#x27;content&#x27;][&#x27;field_playground_url&#x27;][0][&#x27;#context&#x27;][&#x27;value&#x27;] = $returnUrl;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $variables[&#x27;paragraph&#x27;]-&gt;set(&#x27;field_playground_url&#x27;, $returnUrl);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    } catch (RequestException $e) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        \Drupal::logger(&#x27;playground_paragraph&#x27;)-&gt;error(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;Status code @status_code: @message&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            array(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;@status_code&#x27; =&gt; $e-&gt;getCode(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;@message&#x27; =&gt; $e-&gt;getMessage(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="créer-une-extension-twig"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#créer-une-extension-twig" title="Direct link to heading">#</a>Créer une extension Twig</h2><p>Se référer au module Customization de SVOD-DEV</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="créer-un-formulaire-avec-un-theme-spécifique"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#créer-un-formulaire-avec-un-theme-spécifique" title="Direct link to heading">#</a>Créer un formulaire avec un theme spécifique</h2><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function h1765_theme_suggestions_item_list_alter(array &amp;$suggestions, array $variables) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if (isset($variables[&#x27;attributes&#x27;][&#x27;template&#x27;])) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $suggestions[] = &#x27;item_list__&#x27; . $variables[&#x27;attributes&#x27;][&#x27;template&#x27;];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>(ici, c&#x27;est dans un module qu&#x27;on a créé cette item_list:)</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$form[$attributeId.&#x27;-links&#x27;] = [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;#theme&#x27; =&gt; &#x27;item_list&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;#items&#x27; =&gt; $pop_array,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;#attributes&#x27; =&gt; array(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;class&#x27; =&gt; array(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;pop-list&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $attributeId.&#x27;-pop&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;cp-list-tags&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;cp-list-tags--default&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;template&#x27; =&gt; &#x27;filter&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;#wrapper_attributes&#x27; =&gt; array(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;id&#x27; =&gt; $attributeId.&#x27;-pop&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">];</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="créer-un-module-de-block-recevant-le-node-sur-lequel-il-apparait-en-contexte"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#créer-un-module-de-block-recevant-le-node-sur-lequel-il-apparait-en-contexte" title="Direct link to heading">#</a>Créer un module de block recevant le node sur lequel il apparait en contexte</h2><p>Dans src/Plugin/Block/MonBlock.php mettre cette annotation:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @Block(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *   id = &quot;instagram_block_block&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *   admin_label = @Translation(&quot;Instagram block&quot;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *   category = @Translation(&quot;Social&quot;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *   context = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *     &quot;node&quot; = @ContextDefinition(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *       &quot;entity:node&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *       required = FALSE,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *     )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class InstagramBlockBlock extends BlockBase implements ContainerFactoryPluginInterface</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>Mettre le node en context avec required= FALSE permet de ne pas rendre obligatoire ce contexte.
Dans build(), pour récupérer le node : <code>$node = $this-&gt;getContextValue(&#x27;node&#x27;);</code></p><p>(l&#x27;id qui se trouve dans ce bloc de commentaire est utilisé par Twig tweak pour afficher un block).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="mettre-en-cache-le-resultat-dun-appel-externe"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#mettre-en-cache-le-resultat-dun-appel-externe" title="Direct link to heading">#</a>Mettre en cache le resultat d&#x27;un appel externe</h2><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$posts = [];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $cid = &#x27;facebook_feed_block:feeds&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if ($cache = \Drupal::cache()-&gt;get($cid)) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $posts = $cache-&gt;data;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    else {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $response = \Drupal::httpClient()-&gt;get($url, [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;headers&#x27; =&gt; array(&#x27;Accept&#x27; =&gt; &#x27;text/plain&#x27;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;timeout&#x27; =&gt;  5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $posts = json_decode((string) $response-&gt;getBody())-&gt;data;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      \Drupal::cache()-&gt;set($cid, $posts, REQUEST_TIME + (60*60*4));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return $posts;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="obtenir-le-chemin-du-theme-actif"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#obtenir-le-chemin-du-theme-actif" title="Direct link to heading">#</a>obtenir le chemin du theme actif</h2><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$theme_handler = \Drupal::service(&#x27;theme_handler&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$default_theme = $theme_handler-&gt;getDefault();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$theme_path = $theme_handler-&gt;getTheme($default_theme)-&gt;getPath();</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="créer-du-html-depuis-php"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#créer-du-html-depuis-php" title="Direct link to heading">#</a>créer du html depuis php</h2><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$decoration = $dom-&gt;createDocumentFragment();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$decoration-&gt;appendXML(&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;span class=&quot;footnote__decoration&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;svg class=&quot;hidden-xs hidden-sm&quot; width=&quot;17&quot; height=&quot;152&quot; viewBox=&quot;0 0 17 152&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;path d=&quot;M16.5 151.758V.169c0 40.062-16 55.261-16 75.795 0 20.533 16 35.404 16 75.794z&quot; fill=&quot;#00B374&quot; fill-rule=&quot;nonzero&quot;&gt;&lt;/path&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;/svg&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;svg class=&quot;visible-xs-block visible-sm-block&quot; width=&quot;151&quot; height=&quot;16&quot; viewBox=&quot;0 0 151 16&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;path d=&quot;M-.258 16h151.589C111.269 16 96.07 0 75.536 0 55.003 0 40.132 16-.258 16z&quot; fill=&quot;#00B374&quot; fill-rule=&quot;nonzero&quot;&gt;&lt;/path&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;/svg&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;/span&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$theme_handler = \Drupal::service(&#x27;theme_handler&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$default_theme = $theme_handler-&gt;getDefault();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$theme_path = $theme_handler-&gt;getTheme($default_theme)-&gt;getPath();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$btnClose = $dom-&gt;createDocumentFragment();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$btnClose-&gt;appendXML(&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;a href=&#x27;#&#x27; class=&#x27;btn-close&#x27;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;img src=&#x27;$theme_path/images/close.svg&#x27;/&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;/a&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$blocknote = $dom-&gt;createElement(&#x27;div&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$blocknote-&gt;setAttribute(&#x27;class&#x27;, &#x27;footnote-holder&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$blocknote-&gt;setAttribute(&#x27;id&#x27;, &quot;footnote$idNote&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnote =  $dom-&gt;createElement(&#x27;div&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnote-&gt;setAttribute(&#x27;class&#x27;, &#x27;footnote&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnoteTitle =  $dom-&gt;createElement(&#x27;div&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnoteTitle-&gt;setAttribute(&#x27;class&#x27;, &#x27;footnote__title&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnoteTitleSpan =  $dom-&gt;createElement(&#x27;span&#x27;, &quot;($idNote)&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnoteTitleSpan-&gt;setAttribute(&#x27;class&#x27;, &#x27;count&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnoteEntry =  $dom-&gt;createElement(&#x27;div&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnoteEntry-&gt;setAttribute(&#x27;class&#x27;, &#x27;footnote__entry&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnoteEntryP =  $dom-&gt;createElement(&#x27;p&#x27;, $nodeText);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnoteTitle-&gt;appendChild($footnoteTitleSpan);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnoteEntry-&gt;appendChild($footnoteEntryP);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnote-&gt;appendChild($decoration);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnote-&gt;appendChild($btnClose);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnote-&gt;appendChild($footnoteTitle);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$footnote-&gt;appendChild($footnoteEntry);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$blocknote-&gt;appendChild($footnote);</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="envoyer-un-mail"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#envoyer-un-mail" title="Direct link to heading">#</a>Envoyer un mail</h2><p>Dans custom module, déclencher sur save:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public function save(array $form, FormStateInterface $form_state) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $entity = $this-&gt;entity;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $status = parent::save($form, $form_state);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $values=$form_state-&gt;getValues();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if (($values[&#x27;isurgent&#x27;][&#x27;value&#x27;]==1) &amp;&amp; ($values[&#x27;status&#x27;][&#x27;value&#x27;]==1)) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $iSeliste = \Drupal::currentUser()-&gt;id();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $oSeliste = \Drupal::entityTypeManager()-&gt;getStorage(&#x27;person&#x27;)-&gt;load($iSeliste);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $sSelite = $oSeliste-&gt;firstname-&gt;value . &quot; &quot; . $oSeliste-&gt;lastname-&gt;value;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $sAction = ($values[&#x27;action&#x27;][0][&#x27;value&#x27;]==0)?&quot;offre&quot;:&quot;demande&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $sDueDate = $values[&#x27;duedate&#x27;][0][&#x27;value&#x27;]-&gt;format(&quot;d/m/Y&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    _sendEmailForUrgentService($sSelite, $sAction, $sDueDate);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">function _sendEmailForUrgentService($sSeliste, $sAction, $sDueDate) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  \Drupal::service(&#x27;plugin.manager.mail&#x27;)-&gt;mail(&#x27;sel&#x27;, &#x27;emailforurgentservice&#x27;, $sTo, &#x27;fr&#x27;, $params);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  \Drupal::logger(&#x27;sel&#x27;)-&gt;info(&#x27;Courriel pour service urgent : envoi effectué.&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>my hook_mail:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function sel_mail($key, &amp;$message, $params) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $sFrom = &#x27;[redacted]&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $message[&#x27;from&#x27;] = $sFrom;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $message[&#x27;headers&#x27;] = array(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;Content-Type&#x27; =&gt; &#x27;text/html&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;bcc&#x27; =&gt; $params[3],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;From&#x27; =&gt; $sFrom,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;Sender&#x27; =&gt; $sFrom,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;Return-Path&#x27; =&gt; $sFrom,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  switch ($key) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    case &#x27;emailforurgentservice&#x27;:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $message[&#x27;subject&#x27;] = &#x27;[Le Grenier à SÉL] Un service urgent requiert votre attention...&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $sBody  = $params[0] . &quot; a posté une &quot; . $params[1] . &quot; urgente qui est valide jusqu&#x27;au &quot; . $params[2] . &quot;.&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $message[&#x27;body&#x27;][] = check_markup(nl2br($sBody), &#x27;full_html&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      break;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>And in my theme templates folder (mysite/web/themes/contrib/mayo/templates/), there is my email template swiftmailer--sel--emailforurgentservice.html.twig:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;html&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;head&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;style type=&quot;text/css&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;/style&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/head&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;body&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;div&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;table width=&quot;800px&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;tr&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;td&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;div style=&quot;padding: 0px 0px 0px 0px;&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &lt;p&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    {{ body }}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &lt;/p&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;/div&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;/td&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;/tr&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;/table&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/div&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/body&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/html&gt;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>#iframe</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="source-de-liframe-example"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#source-de-liframe-example" title="Direct link to heading">#</a>source de l&#x27;iframe (example)</h2><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-html codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">style</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">type</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">text/css</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token style language-css selector" style="color:rgb(199, 146, 234)">main</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token style language-css"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token style language-css"></span><span class="token style language-css property">width</span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token style language-css"> </span><span class="token style language-css number" style="color:rgb(247, 140, 108)">100</span><span class="token style language-css unit">%</span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token style language-css"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token style language-css"></span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token style language-css"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token style language-css"></span><span class="token style language-css selector class" style="color:rgb(199, 146, 234)">.field-name-body.field-type-text-with-summary</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token style language-css"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token style language-css"></span><span class="token style language-css property">margin</span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token style language-css"> </span><span class="token style language-css number" style="color:rgb(247, 140, 108)">0</span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token style language-css"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token style language-css"></span><span class="token style language-css property">padding</span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token style language-css"> </span><span class="token style language-css number" style="color:rgb(247, 140, 108)">0</span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token style language-css"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token style language-css"></span><span class="token style language-css property">width</span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token style language-css"> </span><span class="token style language-css number" style="color:rgb(247, 140, 108)">100</span><span class="token style language-css unit">%</span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token style language-css"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token style language-css"></span><span class="token style language-css punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token style language-css"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token style language-css"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">style</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">iframe</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">height</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">1600</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">id</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">ifrm</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">src</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://dev.krug.com:8800/rockpepperscissors/</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">width</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">100%</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">iframe</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="allow-style-tag-in-ckeditor"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#allow-style-tag-in-ckeditor" title="Direct link to heading">#</a>Allow style tag in ckeditor</h2><ul><li><code>admin/config/content/ckeditor/edit/Full</code></li><li><code>Advanced content filter</code> to <code>disabled</code> and <code>save</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="static"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#static" title="Direct link to heading">#</a>Static</h2><p>The static should be put in files directory of the drupal.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="config-nginx"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#config-nginx" title="Direct link to heading">#</a>Config nginx</h2><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-nginx codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">location ~ /whatyouwantasurl/?(.*)$ {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        alias /absolute/path/to/files/staticsitedirectory/$1;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        index index.html;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="embed-dune-url-interdite-par-le-site-drupal"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#embed-dune-url-interdite-par-le-site-drupal" title="Direct link to heading">#</a>Embed d&#x27;une URL interdite par le site drupal</h1><p>Il faut configurer le header <code>X-Frame-Options:</code></p><ul><li>Installation du module <code>https://www.drupal.org/project/x_frame_options</code></li><li>Commande en composer: <code>composer require &#x27;drupal/x_frame_options:^1.1&#x27;</code></li><li>Activer le module en B.O. <code>admin/config/system/x_frame_options_configuration/settings</code></li><li>Select <code>ALLOW-FROM uri</code> and <code>Uri field</code> <code>*</code></li><li>Vous pouvez restreindre l&#x27;accès à une URL si vous le souhaitez.</li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="astuces"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#astuces" title="Direct link to heading">#</a>Astuces</h1><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="twig"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#twig" title="Direct link to heading">#</a>Twig</h2><ol><li>La concaténation de strings :<ul><li>&quot;Heure de publication: &quot; ~ {{ node.field_published.value }}</li><li>&quot;background-image: url(#{file_url(node.field_visuel_push.entity.field_media_image.entity.uri.value)});&quot;</li></ul></li></ol></div></article><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/modules"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« <!-- -->modules</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#créer-un-web-service" class="contents__link">Créer un web service</a></li><li><a href="#ajouter-des-paramètres-de-configuration-à-votre-module" class="contents__link">Ajouter des paramètres de configuration à votre module</a></li><li><a href="#empêcher-la-mise-en-cache-dun-node-ou-type-de-node-spécifique" class="contents__link">Empêcher la mise en cache d'un node ou type de node spécifique</a></li><li><a href="#modifier-la-valeur-dun-paragraphe-par-appel-webservice" class="contents__link">Modifier la valeur d'un paragraphe par appel webservice</a></li><li><a href="#créer-une-extension-twig" class="contents__link">Créer une extension Twig</a></li><li><a href="#créer-un-formulaire-avec-un-theme-spécifique" class="contents__link">Créer un formulaire avec un theme spécifique</a></li><li><a href="#créer-un-module-de-block-recevant-le-node-sur-lequel-il-apparait-en-contexte" class="contents__link">Créer un module de block recevant le node sur lequel il apparait en contexte</a></li><li><a href="#mettre-en-cache-le-resultat-dun-appel-externe" class="contents__link">Mettre en cache le resultat d'un appel externe</a></li><li><a href="#obtenir-le-chemin-du-theme-actif" class="contents__link">obtenir le chemin du theme actif</a></li><li><a href="#créer-du-html-depuis-php" class="contents__link">créer du html depuis php</a></li><li><a href="#envoyer-un-mail" class="contents__link">Envoyer un mail</a></li><li><a href="#source-de-liframe-example" class="contents__link">source de l'iframe (example)</a></li><li><a href="#allow-style-tag-in-ckeditor" class="contents__link">Allow style tag in ckeditor</a></li><li><a href="#static" class="contents__link">Static</a></li><li><a href="#config-nginx" class="contents__link">Config nginx</a></li><li><a href="#twig" class="contents__link">Twig</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction">Docs</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://abecms.slack.com">Slack</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Website</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://livingcolor.fr">Website</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1Wg7"><img class="footer__logo" alt="Facebook Open Source Logo" src="https://docusaurus.io/img/oss_logo.png"/></a></div>Copyright © 2020 Abe SAS. Built with Docusaurus.</div></div></footer>
</div>

<script type="text/javascript" src="/styles.d03aa9ed.js"></script>

<script type="text/javascript" src="/runtime~main.bfc5603c.js"></script>

<script type="text/javascript" src="/main.33f566fa.js"></script>

<script type="text/javascript" src="/1.216e67a9.js"></script>

<script type="text/javascript" src="/29.0288bebb.js"></script>

<script type="text/javascript" src="/20ac7829.5e6f2fab.js"></script>

<script type="text/javascript" src="/17896441.e9c11e14.js"></script>

<script type="text/javascript" src="/950718c7.3cf64613.js"></script>


</body>
</html>