(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{151:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"rightToc",(function(){return o})),n.d(t,"metadata",(function(){return u})),n.d(t,"default",(function(){return d}));var r=n(1),a=n(9),i=(n(0),n(155)),l={},o=[{value:"Introduction",id:"introduction",children:[{value:"G\xe9rer les r\xe9p\xe9titions",id:"g\xe9rer-les-r\xe9p\xe9titions",children:[]},{value:"Cr\xe9er une page de vue",id:"cr\xe9er-une-page-de-vue",children:[]},{value:"Permettre la s\xe9lection \xe0 l'utilisateur",id:"permettre-la-s\xe9lection-\xe0-lutilisateur",children:[]},{value:"Impl\xe9menter Ajax",id:"impl\xe9menter-ajax",children:[]}]},{value:"Permettre l'affichage de r\xe9sultats en fonction de 2 champs contextuels diff\xe9rents",id:"permettre-laffichage-de-r\xe9sultats-en-fonction-de-2-champs-contextuels-diff\xe9rents",children:[]},{value:"Titre d'une vue",id:"titre-dune-vue",children:[]},{value:"Passer une variable \xe0 une vue",id:"passer-une-variable-\xe0-une-vue",children:[]},{value:"Afficher tous les nodes qui ont le m\xeame referenced entity parent",id:"afficher-tous-les-nodes-qui-ont-le-m\xeame-referenced-entity-parent",children:[{value:"Exemple",id:"exemple",children:[]}]},{value:"Traductions",id:"traductions",children:[]},{value:"Cr\xe9er une URL de vue en fonction de la langue",id:"cr\xe9er-une-url-de-vue-en-fonction-de-la-langue",children:[]},{value:"Cr\xe9er une vue d'admin",id:"cr\xe9er-une-vue-dadmin",children:[]},{value:"Cr\xe9\xe9r un bouton d'action sur les vues d'admin",id:"cr\xe9\xe9r-un-bouton-daction-sur-les-vues-dadmin",children:[]},{value:"Vue par d\xe9faut d'admin des contenus",id:"vue-par-d\xe9faut-dadmin-des-contenus",children:[]},{value:"Cr\xe9er une vue RSS",id:"cr\xe9er-une-vue-rss",children:[{value:"Configurer les liens",id:"configurer-les-liens",children:[]}]},{value:"Exporter une vue en csv",id:"exporter-une-vue-en-csv",children:[]},{value:"Filtrer par ann\xe9e",id:"filtrer-par-ann\xe9e",children:[]},{value:"Search",id:"search",children:[]},{value:"Ne pas afficher le node actif dans une vue",id:"ne-pas-afficher-le-node-actif-dans-une-vue",children:[]},{value:"form exposed : Ajouter un style ou une classe au tag <code>&lt;form&gt;</code>",id:"form-exposed--ajouter-un-style-ou-une-classe-au-tag-form",children:[]},{value:"form exposed : S\xe9parer le champ sort_by des champs de filtrage :",id:"form-exposed--s\xe9parer-le-champ-sort_by-des-champs-de-filtrage-",children:[]},{value:"form exposed : Skinner les champs de filtre et de tri",id:"form-exposed--skinner-les-champs-de-filtre-et-de-tri",children:[]},{value:"Dans une view, dans l'exposed filter, n'afficher que les termes de taxonomie qui ont au moins un node associ\xe9",id:"dans-une-view-dans-lexposed-filter-nafficher-que-les-termes-de-taxonomie-qui-ont-au-moins-un-node-associ\xe9",children:[]},{value:"Appeler un template de node dans une vue en fonction de sa position dans la vue",id:"appeler-un-template-de-node-dans-une-vue-en-fonction-de-sa-position-dans-la-vue",children:[]},{value:"Passer l'index du node dans la vue au node",id:"passer-lindex-du-node-dans-la-vue-au-node",children:[]},{value:"Pour interpr\xe9ter le HTML d'un champ",id:"pour-interpr\xe9ter-le-html-dun-champ",children:[]},{value:"Corriger l'erreur d'affichage des enfants dans une view :",id:"corriger-lerreur-daffichage-des-enfants-dans-une-view-",children:[]},{value:"Afficher le nom d'une valeur de taxonomie depuis un row in rows",id:"afficher-le-nom-dune-valeur-de-taxonomie-depuis-un-row-in-rows",children:[]}],u={id:"views",title:"views",description:"# Views",source:"@site/docs/views.md",permalink:"/docs/views",sidebar:"docs",previous:{title:"paragraphs",permalink:"/docs/paragraphs"},next:{title:"forms",permalink:"/docs/forms"}},s={rightToc:o,metadata:u},c="wrapper";function d(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(i.b)(c,Object(r.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h1",{id:"views"},"Views"),Object(i.b)("h2",{id:"introduction"},"Introduction"),Object(i.b)("p",null,"ATTENTION: Lorsque l'on fait des views avec affichage de node (dans la config de la vue: format afficher contenu), l'utilisation des twigs de node associ\xe9s aux vues fonctionne mal et si vous avez plusieurs vues diff\xe9fentes qui affichent les m\xeame type de contenu node, leur affichage ne fonctionnera pas correctement. C'est un bug Drupal 8 connu: ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://drupal.stackexchange.com/questions/248748/twig-templates-for-nodes-in-different-views/248768"}),"https://drupal.stackexchange.com/questions/248748/twig-templates-for-nodes-in-different-views/248768"),'\nPour r\xe9soudre ce probl\xe8me, utiliser des modes d\'affichage diff\xe9rents (full, teaser, default ...) pour les nodes.\nPar exemple pour une vue "agenda" qui affiche des nodes dont le type de contenu est "event" : au lieu de cr\xe9er un twig node--view--agenda.html.twig, utiliser un node--event--full.html.twig'),Object(i.b)("blockquote",null,Object(i.b)("blockquote",{parentName:"blockquote"},Object(i.b)("p",{parentName:"blockquote"},"Dans les vues, n'utiliser que des unformatted list of fields avec affichage du Node dans mode d'affichage diff\xe9rent par bloc de vue"))),Object(i.b)("h3",{id:"g\xe9rer-les-r\xe9p\xe9titions"},"G\xe9rer les r\xe9p\xe9titions"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Pour \xe9viter qu'un m\xeame r\xe9sultat se r\xe9p\xe8te dans l'affichage :")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Ouvrir les param\xe8tres avanc\xe9s de la vue"),Object(i.b)("li",{parentName:"ul"},"Passer \"utiliser l'agr\xe9gation\" de 'non' \xe0 'oui'")),Object(i.b)("h3",{id:"cr\xe9er-une-page-de-vue"},"Cr\xe9er une page de vue"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},'Cr\xe9er une view du nom de "Actualit\xe9s"'),Object(i.b)("li",{parentName:"ol"},"show content of type article sorted by newest first"),Object(i.b)("li",{parentName:"ol"},'Create a page doit \xeatre coch\xe9, le nom de la page sera "actualites"'),Object(i.b)("li",{parentName:"ol"},"Display format: Unformatted list of fields."),Object(i.b)("li",{parentName:"ol"},'Vider Items to display et d\xe9cocher "Use a pager"'),Object(i.b)("li",{parentName:"ol"},"Save and Edit")),Object(i.b)("h3",{id:"permettre-la-s\xe9lection-\xe0-lutilisateur"},"Permettre la s\xe9lection \xe0 l'utilisateur"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},'Ajouter un "filter criteria", on ajoute Content: Tags / Non expos\xe9 aux utilisateurs'),Object(i.b)("li",{parentName:"ol"},'Ajouter un "filter criteria", on ajoute Content: D\xe9partement, Sites, March\xe9s, Th\xe9matiques :'),Object(i.b)("li",{parentName:"ol"},"S\xe9lectionner le mode dropdown"),Object(i.b)("li",{parentName:"ol"},"S\xe9lectionner Expose this filter to visitors"),Object(i.b)("li",{parentName:"ol"},"S\xe9lectionner Single filter"),Object(i.b)("li",{parentName:"ol"},'puis Operator "is one of"'),Object(i.b)("li",{parentName:"ol"},'Ajouter un "filter criteria", on ajoute Content: Date / Est compris entre'),Object(i.b)("li",{parentName:"ol"},"Sauvegarder")),Object(i.b)("h3",{id:"impl\xe9menter-ajax"},"Impl\xe9menter Ajax"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Cliquer sur Advanced"),Object(i.b)("li",{parentName:"ol"},"Use Ajax")),Object(i.b)("p",null,"Il faudra ensuite utiliser le module custom view_filter que nous avons cr\xe9\xe9"),Object(i.b)("h2",{id:"permettre-laffichage-de-r\xe9sultats-en-fonction-de-2-champs-contextuels-diff\xe9rents"},"Permettre l'affichage de r\xe9sultats en fonction de 2 champs contextuels diff\xe9rents"),Object(i.b)("p",null,"Ex. J'ai cr\xe9\xe9 un champ au niveau du node article appel\xe9 \"co-auteur\". Ainsi un utilisateur peut-\xeatre auteur ou co-auteur d'un article. Pour afficher tous les articles dans lesquels il est auteur ou co-auteur :\nutiliser le module ",Object(i.b)("inlineCode",{parentName:"p"},"views_contextual_filters_or")),Object(i.b)("p",null,"Puis dans la vue :"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},'Mettre les 2 champs en filtres contextuels avec "fournir une valeur par d\xe9faut" (ici identifiant depuis le contexte de la route car je veux les articles de la personne logg\xe9e en ce moment).\n-Dans param\xe8tres de la requ\xeate, cocher "contextual filter OR"')),Object(i.b)("h2",{id:"titre-dune-vue"},"Titre d'une vue"),Object(i.b)("p",null,"le titre de votre vue ne s'affiche pas en front...\nPour l'afficher en front, il faut dans un module mettre :"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"/**\n * Add title of the view on the views...\n * + style on the krug lovers form\n */\nfunction customization_preprocess_views_view(&$variables) {\n  $view = $variables['view'];\n  $variables['title'] = [\n    '#markup' => $view->getTitle(),\n  ];\n}\n")),Object(i.b)("p",null,"Vous pourrez alors afficher le titre de la vue sur votre front : {{title}}"),Object(i.b)("h2",{id:"passer-une-variable-\xe0-une-vue"},"Passer une variable \xe0 une vue"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Depuis Twig Tweak, on peut faire \xe7a :")),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"{{ drupal_view('article_a_lire_aussi', 'block_1', 10) }}\n")),Object(i.b)("p",null,"Ce nombre 10 sera r\xe9cup\xe9r\xe9 sur la vue ou sur l'unformatted de la vue avec :"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"view.args[0]\n")),Object(i.b)("p",null,"!! A noter !! Cet argument (10) peut \xeatre li\xe9 avec des contextual filters :\nExemple : On cr\xe9\xe9 un contextual filter sur l'id, 10 correspond \xe0 l'id d'un node."),Object(i.b)("p",null,"Par exemple je suis sur un node de contenu et je veux faire varier le nb d'items de ma vue en fonction du nombre d'items que j'ai sur un field \"field_a_lire_aussi\", du c\xf4t\xe9 de mon node :"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"{% for alire in content.field_a_lire_aussi['#items'].getIterator() %}\n    {{ drupal_entity('node', alire.entity.id(), 'teaser') }}\n{% endfor %}\n{% set nb = content.field_a_lire_aussi['#items'].getIterator()|length %}\n{{ drupal_view('article_a_lire_aussi', 'block_1', nb) }}\n")),Object(i.b)("p",null,"et dans mon docroot/themes/custom/inaglobal/templates/view/article-a-lire-aussi/views-view-unformatted--article-a-lire-aussi.html.twig :"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),'{% set nbAlreadyDisplayed = (3 - view.args[0]) %}\n{% for row in rows %}\n    {% if loop.index <= nbAlreadyDisplayed %}\n        {{ row.content }}\n        {% if loop.index != loop.last %}\n            <div class="mb-2"></div>\n        {% endif %}\n    {% endif %}\n{% endfor %}\n')),Object(i.b)("h2",{id:"afficher-tous-les-nodes-qui-ont-le-m\xeame-referenced-entity-parent"},"Afficher tous les nodes qui ont le m\xeame referenced entity parent"),Object(i.b)("h3",{id:"exemple"},"Exemple"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},'J\'ai un type de contenu "s\xe9rie"'),Object(i.b)("li",{parentName:"ul"},'J\'ai un type de contenu "\xe9pisode"'),Object(i.b)("li",{parentName:"ul"},'chaque \xe9pisode r\xe9f\xe9rence une entit\xe9 s\xe9rie via "field_serie"'),Object(i.b)("li",{parentName:"ul"},"Lorsque j'affiche un \xe9pisode, je veux afficher TOUS les autres \xe9pisodes de cette s\xe9rie")),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},'Je cr\xe9e dans ma vue une relation "content r\xe9f\xe9renc\xe9 depuis field_serie"'),Object(i.b)("li",{parentName:"ol"},'Je cr\xe9e une autre relation "content utilise field_serie" avec comme relation la relation pr\xe9c\xe9dente'),Object(i.b)("li",{parentName:"ol"},"Je cr\xe9e un filtre contextuel sur l'ID de node avec en relation la seconde (content utilise field_serie) et je fournis en valeur par d\xe9faut identifiant (ID) \xe0 partir de l'URL\n=> Cela va afficher tous les \xe9pisodes de la s\xe9rie (y compris celui qui s'affiche en \xe9pisode pricnipal sur ma page)"),Object(i.b)("li",{parentName:"ol"},"Je cr\xe9e un nouveau filtre contextuel sur l'ID de node (encore) sans relation et avec en valeur par d\xe9faut l'identifiant \xe0 partir de l'URL et tout en bas dans \"more\" je clique sur exclure\n=> Cela affiche TOUS les \xe9pisodes de la s\xe9rie de l'\xe9pisode affich\xe9 sur la page, sauf l'\xe9pisode lui-m\xeame !")),Object(i.b)("h2",{id:"traductions"},"Traductions"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Ajouter un crit\xe8re de filtre"),Object(i.b)("li",{parentName:"ol"},'S\xe9l\xe9ctionner "content : translation language"'),Object(i.b)("li",{parentName:"ol"},'Filtrer sur "Interface text language selected for page"')),Object(i.b)("h2",{id:"cr\xe9er-une-url-de-vue-en-fonction-de-la-langue"},"Cr\xe9er une URL de vue en fonction de la langue"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Aller dans 'admin/configuration/url aliases' et cr\xe9er un alias du chemin de la vue dans la langue souhait\xe9e. Pour l'utiliser depuis twig, se r\xe9f\xe9rer \xe0 \"Afficher l'url d'une vue\" plus haut.")),Object(i.b)("h2",{id:"cr\xe9er-une-vue-dadmin"},"Cr\xe9er une vue d'admin"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Cr\xe9er une vue"),Object(i.b)("li",{parentName:"ul"},"Dans la vue : Lui mettre un chemin d'url (qui commence par /admin)"),Object(i.b)("li",{parentName:"ul"},"Dans la vue : L'associer \xe0 un menu de la navigation admin"),Object(i.b)("li",{parentName:"ul"},"Pour rendre les colonnes triables au clic sur l'ent\xeate, dans le Format:Tableau entrer dans ",Object(i.b)("strong",{parentName:"li"},"Param\xe8tres")," et cocher les cases dans la colonne ",Object(i.b)("strong",{parentName:"li"},"Classable"))),Object(i.b)("h2",{id:"cr\xe9\xe9r-un-bouton-daction-sur-les-vues-dadmin"},"Cr\xe9\xe9r un bouton d'action sur les vues d'admin"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Activer le module Views Add Button"),Object(i.b)("li",{parentName:"ol"},"Dans la vue concern\xe9e, dans ENTETE, ajouter et configurer un Entity Add Button :")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Entity Type = S\xe9lectionner l'entit\xe9 concern\xe9e"),Object(i.b)("li",{parentName:"ul"},"Button Text for the add button = Libell\xe9 du bouton (e.g. Ajouter un article)"),Object(i.b)("li",{parentName:"ul"},"Button classes for the add link = Coller les classes : button button-action button--primary button--small")),Object(i.b)("h2",{id:"vue-par-d\xe9faut-dadmin-des-contenus"},"Vue par d\xe9faut d'admin des contenus"),Object(i.b)("p",null,"Si la vue admin/content n'existe plus (supprim\xe9 par erreur ou supprim\xe9 par Drupal), voici le moyen de la recr\xe9er :"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},'Goto Configuration > Development > Synchronization > Import tab > Single item, Configuration type: View and paste into the code below into "Paste your configuration here" and press Import. et importer la vue qui est sauvegard\xe9e en yml.')),Object(i.b)("h2",{id:"cr\xe9er-une-vue-rss"},"Cr\xe9er une vue RSS"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Ajouter une page de type Flux \xe0 la vue content par d\xe9faut"),Object(i.b)("li",{parentName:"ol"},"Param\xe8tre du flux : Cr\xe9er le chemin (e.g. /rss)"),Object(i.b)("li",{parentName:"ol"},"Configurer la vue :")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Ajouter les champs Titre, chapo, publi\xe9 le, \xe9crit par, lien vers le contenu (rendre l'url en tant que texte)"),Object(i.b)("li",{parentName:"ul"},"Format : Afficher Param\xe8tre puis faire la mapping avec les champs ajouter pr\xe9c\xe9demment")),Object(i.b)("h3",{id:"configurer-les-liens"},"Configurer les liens"),Object(i.b)("p",null,"Il s'agit d'une vue.\nPour cr\xe9er le lien vers les nodes, utiliser l'id de chaque node et faire une r\xe9\xe9criture de ces ids avec ",Object(i.b)("inlineCode",{parentName:"p"},"/node/{{nid}}")," dedans.\nIls seront r\xe9\xe9cris avec la bonne url"),Object(i.b)("h2",{id:"exporter-une-vue-en-csv"},"Exporter une vue en csv"),Object(i.b)("p",null,"Permettre l'export du catalogue: utiliser les plugins csv_serialization et views_data_export."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},'Aller dans la vue et cr\xe9er une vue exportation des donn\xe9es. Bien lister l\'ensemble des infos et v\xe9rifier que dans format/param\xe8tres, la case "csv" est bien coch\xe9e. V\xe9rifier que la vue fonctionne puis mettre le chemin souhait\xe9 (ex. /admin/export/catalogue fichier: catalogue.csv). Aller dans Admin/Structure/menus/administration/ajouter un lien et mettre le lien vers cet export avec : /admin/export/catalogue?_format=csv')),Object(i.b)("h2",{id:"filtrer-par-ann\xe9e"},"Filtrer par ann\xe9e"),Object(i.b)("p",null,"ATTENTION : pour filtrer par ann\xe9e : il faut un patch a views : ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://www.drupal.org/files/issues/2786577-270_0.patch"}),"https://www.drupal.org/files/issues/2786577-270_0.patch")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"article ",Object(i.b)("a",Object(r.a)({parentName:"li"},{href:"https://www.flocondetoile.fr/blog/filter-content-year-views-drupal-8"}),"https://www.flocondetoile.fr/blog/filter-content-year-views-drupal-8"))),Object(i.b)("h2",{id:"search"},"Search"),Object(i.b)("p",null,"Pour pouvoir rechercher des views, on a utilis\xe9 un trick (Drupal ne sait pas faire de l'index SolR sur les vues...):\n1. On cr\xe9e un type de contenu bloc (search-views) avec un titre et un lien et un body\n1. Pour chaque lien vers une page de views qu'on veut trouver, on cr\xe9e un bloc de ce type\n1. On va ajouter ce bloc dans le search index Drupal en mettant un poids fort au titre du bloc (pour qu'il ressorte en premier)\n1. Dans la vue de recherche on n'oublie pas d'ajouter les champs de ces blocs en r\xe9sultat."),Object(i.b)("h2",{id:"ne-pas-afficher-le-node-actif-dans-une-vue"},"Ne pas afficher le node actif dans une vue"),Object(i.b)("p",null,'Si vous avez une vue int\xe9gr\xe9e dans un node (par exemple "autres articles" affich\xe9s sous un article) et que vous ne voulez pas que le node actif ne s\'affiche dans la vue:'),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Aller dans la vue, filtre contextuel"),Object(i.b)("li",{parentName:"ul"},"Ajouter l'ID et remplir \"fournir une valeur par d\xe9faut\" \"Quand la valeur de filtre n'est pas dispo\" avec l'IDdu contenu \xe0 partir de l'URL"),Object(i.b)("li",{parentName:"ul"},'Tout en bas, dans "MORE", cocher exclure, pour exclure cette valeur d\'ID.')),Object(i.b)("h2",{id:"form-exposed--ajouter-un-style-ou-une-classe-au-tag-form"},"form exposed : Ajouter un style ou une classe au tag ",Object(i.b)("inlineCode",{parentName:"h2"},"<form>")),Object(i.b)("p",null,"  Le twig exposed ne contient pas le tag form. Il faut passer par un module pour modifier ce tag. Par exemple:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"/**\n * Add style on the lovers form\n */\nfunction customization_preprocess_views_view(&$variables) {\n  if ($variables['id'] === 'lovers') {\n    $variables['exposed']['#attributes']['style'] = 'display:flex; align-self: flex-end';\n  }\n}\n")),Object(i.b)("p",null,"Sur le formulaire de la vue lovers, on va ajouter ",Object(i.b)("inlineCode",{parentName:"p"},'style="display:flex; align-self: flex-end"')," sur le tag form.\nPour ajouter une classe : ",Object(i.b)("inlineCode",{parentName:"p"},"$variables['exposed']['#attributes']['class'][] = 'myClass';")),Object(i.b)("h2",{id:"form-exposed--s\xe9parer-le-champ-sort_by-des-champs-de-filtrage-"},"form exposed : S\xe9parer le champ sort_by des champs de filtrage :"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"{{ form|without('sort_by') }}\n\n{{ form.sort_by }}\n")),Object(i.b)("p",null,"Il suffit d'afficher d'abord le form SANS le field en question, puis afficher s\xe9par\xe9ment le field voulu. Valable pour d'autres objets Drupal."),Object(i.b)("h2",{id:"form-exposed--skinner-les-champs-de-filtre-et-de-tri"},"form exposed : Skinner les champs de filtre et de tri"),Object(i.b)("p",null,"une premi\xe8re solution est d'utiliser le module BEF (Better Exposed Filter), mais cela peut-\xeatre compliqu\xe9 d'arriver au r\xe9sultat souhait\xe9."),Object(i.b)("p",null,"Une autre solution : Le faire soi-m\xeame. Voici comment cr\xe9er un filtrage + tri en ajax sur une vue."),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Cocher \"ajax\" dans la vue, configurer les filtres et les tris expos\xe9s \xe0 l'utilisateur (si on ne veut pas rendre l'ordre de tri sl\xe9ecitonnable par d\xe9faut, il faut aller le d\xe9cocher dans Advanced/exposed form/Exposed form style/settings)"),Object(i.b)("li",{parentName:"ol"},"sur le front, utiliser les suggestions pour sp\xe9cialiser le html de l'exposed et des champs.\nPour remplacer un select par des ul/li par exemple, il suffit de cacher le select, de cacher le bouton de soumission du formulaire, et d'ajouter du js pour qu'au clic sur un li, on mette \xe0 jour la valeur du select puis on clique sur le bouton de soumission. Exemple pour un \"trier par\" on cr\xe9er un twig ",Object(i.b)("inlineCode",{parentName:"li"},"select--sort-by.html.twig")," :")),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"{% spaceless %}\n  <select{{ attributes.addClass('js-select-sortby').setAttribute('style', 'display:none') }}>\n    {% for option in options %}\n      {% if option.type == 'optgroup' %}\n        <optgroup label=\"{{ option.label }}\">\n          {% for sub_option in option.options %}\n            <option value=\"{{ sub_option.value }}\"{{ sub_option.selected ? ' selected=\"selected\"' }}>{{ sub_option.label }}</option>\n          {% endfor %}\n        </optgroup>\n      {% elseif option.type == 'option' %}\n        <option value=\"{{ option.value }}\"{{ option.selected ? ' selected=\"selected\"' }}>{{ option.label }}</option>\n      {% endif %}\n    {% endfor %}\n  </select>\n{% endspaceless %}\n<div class=\"filter-block\">\n    <ul class=\"filter-list w-list-unstyled\">\n        {% for option in options %}\n            <li class=\"filter-item{{ option.selected ? ' active' }}\">\n                <div data-selectid=\"{{ option.value }}\" class=\"js-select-ajax-sortby\">{{ option.label }}</div>\n            </li>\n            {% if option.selected %}\n                <script>\n                  if (window.jQuery) {\n                      jQuery('.filter-container').find('.js-btn-sortby').html('{{ option.label }}');\n                  }\n                <\/script>\n            {% endif %}\n        {% endfor %}\n    </ul>\n</div>\n\n<script>\nif (!window.jQuery) {\n  document.addEventListener(\"DOMContentLoaded\", function(event) {\n    jQuery('.js-select-ajax-sortby').on('click', function() {\n        jQuery(this).closest('.filter-selector').find('.js-select-sortby').val(jQuery(this).data('selectid'));\n        jQuery(this).closest('form').find('.js-form-submit').click()\n    })\n  });\n} else {\n  jQuery('.js-select-ajax-sortby').on('click', function() {\n      jQuery(this).closest('.filter-selector').find('.js-select-sortby').val(jQuery(this).data('selectid'));\n      jQuery(this).closest('form').find('.js-form-submit').click()\n  })\n}\n<\/script>\n\n")),Object(i.b)("p",null,"La premi\xe8re partie est du copier/coller du select d'origine avec ",Object(i.b)("inlineCode",{parentName:"p"},".addClass('js-select-sortby').setAttribute('style', 'display:none')"),"qui permet de lui attacher une classe qui nous servira \xe0 le trouver facilement, et un atrribut display:none pour le cacher."),Object(i.b)("p",null,'La seconde partie est le html souhait\xe9.\nLe js, enfin permet de d\xe9tecter quand on clique sur le li de :\n1. retrouver le select et lui mettre la valeur s\xe9lectionn\xe9e\n2. cliquer sur le bouton "soumettre" qui va faire l\'appel ajax.'),Object(i.b)("p",null,"Le test ",Object(i.b)("inlineCode",{parentName:"p"},"if(!window.jQuery)")," permet de savoir si on load ce twig avec la page (au premier chargement), ou si ce twig est retourn\xe9 lors des appels ajax suivants. C'est aussi simple que \xe7a ! En conservant le select d'origine de Drupal, on b\xe9n\xe9ficie de toutes ses fonctionnalit\xe9s associ\xe9es (appel d'ajax)."),Object(i.b)("p",null,"Une autre solution pour le js serait de le d\xe9placer dans un drupal-ajax.js."),Object(i.b)("h2",{id:"dans-une-view-dans-lexposed-filter-nafficher-que-les-termes-de-taxonomie-qui-ont-au-moins-un-node-associ\xe9"},"Dans une view, dans l'exposed filter, n'afficher que les termes de taxonomie qui ont au moins un node associ\xe9"),Object(i.b)("p",null,"dans le fichier montheme.theme, cr\xe9er 2 fonctions:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"getNodesByTaxonomyTermIds va ramener le tableau de termIds qui ont au moins un node associ\xe9")),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"function montheme_form_views_exposed_form_alter(&$form, &$form_state, $form_id) {\n  if($form['#id'] == 'views-exposed-form-agenda-page-1') {\n    Kint::dump($form);\n    $termIds = getNodesByTaxonomyTermIds(array_keys($form['field_thematiques_target_id']['#options']));\n    foreach ($form['field_thematiques_target_id']['#options'] as $term_key => $term) {\n      if(!in_array($term_key,$termIds)) {\n        Check if this is a child by looking for '-' as first char in string\n        unset($form['field_thematiques_target_id']['#options'][$term_key]);\n      }\n    }\n  }\n}\n\nfunction getNodesByTaxonomyTermIds($termIds){\n  $termIds = (array) $termIds;\n  if(empty($termIds)){\n    return $termIds;\n  }\n\n  $query = \\Drupal::database()->select('taxonomy_index', 'ti');\n  $query->fields('ti', array('tid'));\n  $query->innerJoin('node', 'n', 'n.nid = ti.nid');\n  $query->condition('ti.tid', $termIds, 'IN');\n  $query->condition('n.type', 'evenement', '=');\n  $query->groupBy('tid');\n  $result = $query->execute();\n\n  $termIds = $result->fetchCol());\n\n  return $termIds;\n}\n")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},'Pour ne pas afficher les enfants de la taxonomie, il suffit dans les crit\xe8res de filtrage de s\xe9lectionner uniquement les valeurs \xe0 afficher puis \xe0 cocher "limiter la liste aux \xe9l\xe9ments s\xe9lectionn\xe9s".')),Object(i.b)("h2",{id:"appeler-un-template-de-node-dans-une-vue-en-fonction-de-sa-position-dans-la-vue"},"Appeler un template de node dans une vue en fonction de sa position dans la vue"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},'dans "montheme.theme":',Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"  function montheme_theme_suggestions_node_alter(&$suggestions, array $variables) {\n    $suggestions[] = sprintf('%s__%s', $suggestions[count($suggestions) - 2], $variables['elements']['#view_mode']);\n  }\n"))),Object(i.b)("li",{parentName:"ul"},'le code dans le twig "views-view--unformatted":',Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"  {% for row in rows %}\n    {% set rowContent = row.content %}\n    {% if loop.first %}\n      {% set rowContent = rowContent | merge({'#view_mode': 'full_1'}) %}\n    {% endif %}\n    {{ rowContent }}\n  {% endfor %}\n"))),Object(i.b)("li",{parentName:"ul"},'cr\xe9er un twig personnalis\xe9 "node--view--hub-articles--full-1.html.twig".')),Object(i.b)("h2",{id:"passer-lindex-du-node-dans-la-vue-au-node"},"Passer l'index du node dans la vue au node"),Object(i.b)("p",null,"pour un twig node--evenement--default:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"function montheme_preprocess_node__evenement__default(&$vars) {\n    $view = $vars['view'];\n    $node = $vars['node'];\n    foreach($view->result as $key => $row){\n        if($row->nid == $node->id()){\n            $vars['row_index'] = $row->index;\n        }\n    }\n}\n")),Object(i.b)("p",null,"(si le twig s'appellait node--view--home-evenements.html.twig, on aurait comme nom de fonction\nmontheme_preprocess_node",Object(i.b)("strong",{parentName:"p"},"view"),"home_evenements(&$vars))"),Object(i.b)("h2",{id:"pour-interpr\xe9ter-le-html-dun-champ"},"Pour interpr\xe9ter le HTML d'un champ"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"dans le cas d'une vue qui expose des champs, il faut faire :")),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"function h1765_preprocess_views_view_field(&$variables, $hook) {\n  $name = $variables['field']->field;\n\n  switch($name){\n\n    case 'field_chapo':\n      $variables['output'] = html_entity_decode($variables['output']);\n    break;\n\n  }\n}\n")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"et cr\xe9er le views-view-field--field-NOMDUCHAMP.html.twig avec {{ output|raw}}")),Object(i.b)("h2",{id:"corriger-lerreur-daffichage-des-enfants-dans-une-view-"},"Corriger l'erreur d'affichage des enfants dans une view :"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"{% for row in rows %}\n      {{ row.content }}\n{% endfor %}\n")),Object(i.b)("h2",{id:"afficher-le-nom-dune-valeur-de-taxonomie-depuis-un-row-in-rows"},"Afficher le nom d'une valeur de taxonomie depuis un row in rows"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"{{ row.content['#node'].field_categorie_document.0.entity.name.value }}")))}d.isMDXComponent=!0},155:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return d}));var r=n(0),a=n.n(r),i=a.a.createContext({}),l=function(e){var t=a.a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):Object.assign({},t,e)),n},o=function(e){var t=l(e.components);return a.a.createElement(i.Provider,{value:t},e.children)};var u="mdxType",s={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},c=Object(r.forwardRef)((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,u=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&-1===t.indexOf(r)&&(n[r]=e[r]);return n}(e,["components","mdxType","originalType","parentName"]),c=l(n),d=r,p=c[o+"."+d]||c[d]||s[d]||i;return n?a.a.createElement(p,Object.assign({},{ref:t},u,{components:n})):a.a.createElement(p,Object.assign({},{ref:t},u))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[u]="string"==typeof e?e:r,l[1]=o;for(var d=2;d<i;d++)l[d]=n[d];return a.a.createElement.apply(null,l)}return a.a.createElement.apply(null,n)}c.displayName="MDXCreateElement"}}]);