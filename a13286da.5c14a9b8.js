(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{162:function(e,r,t){"use strict";t.r(r),t.d(r,"frontMatter",(function(){return a})),t.d(r,"metadata",(function(){return u})),t.d(r,"rightToc",(function(){return l})),t.d(r,"default",(function(){return s}));var n=t(1),i=t(9),o=(t(0),t(176)),a={},u={id:"dynamisation/users",title:"users",description:"# User",source:"@site/docs/dynamisation/users.md",permalink:"/docs/dynamisation/users",sidebar:"docs",previous:{title:"images",permalink:"/docs/dynamisation/images"},next:{title:"comments",permalink:"/docs/dynamisation/comments"}},l=[{value:"Paths",id:"paths",children:[]},{value:"Cr\xe9er une page profil sur le front",id:"cr\xe9er-une-page-profil-sur-le-front",children:[]},{value:"Cr\xe9er une &#39;suggestion&#39; sur un bouton de validation d&#39;un formulaire",id:"cr\xe9er-une-suggestion-sur-un-bouton-de-validation-dun-formulaire",children:[]},{value:"R\xe9cup\xe9rer l&#39;ID du user connect\xe9",id:"r\xe9cup\xe9rer-lid-du-user-connect\xe9",children:[]},{value:"Connaitre le r\xf4le du user",id:"connaitre-le-r\xf4le-du-user",children:[]},{value:"tester le r\xf4le du user",id:"tester-le-r\xf4le-du-user",children:[]},{value:"D\xe9tecter si l&#39;utilisateur est logg\xe9 ou non",id:"d\xe9tecter-si-lutilisateur-est-logg\xe9-ou-non",children:[]},{value:"Afficher des champs custom du user",id:"afficher-des-champs-custom-du-user",children:[]}],c={rightToc:l};function s(e){var r=e.components,t=Object(i.a)(e,["components"]);return Object(o.b)("wrapper",Object(n.a)({},c,t,{components:r,mdxType:"MDXLayout"}),Object(o.b)("h1",{id:"user"},"User"),Object(o.b)("h2",{id:"paths"},"Paths"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"/user/login"),Object(o.b)("li",{parentName:"ol"},"/user/register"),Object(o.b)("li",{parentName:"ol"},"/user/{user.id}")),Object(o.b)("h2",{id:"cr\xe9er-une-page-profil-sur-le-front"},"Cr\xe9er une page profil sur le front"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Cr\xe9er un param\xe8tre d'affichage personnalis\xe9 (nouveau mode de saisie) sur le form user (en admin) et l'activer puis choisir les champs utilis\xe9s sur cet affichage (on trouve les modes de saisie en bas de \"g\xe9rer l'affichage du formulaire\")."),Object(o.b)("li",{parentName:"ol"},'Cr\xe9er un module et mettre (afin de n\'attribuer le form personnalis\xe9 que sur le front - ici le mode de saisie est "front"):')),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{}),"function monmodule_entity_form_display_alter(&$form_display, $context) {\n  if($context['entity_type'] == 'user' && $context['bundle'] == 'user'){\n    $user = \\Drupal::currentUser();\n    $route = \\Drupal::routeMatch()->getRouteObject();\n    $isAdminPage = \\Drupal::service('router.admin_context')->isAdminRoute($route);\n    if(!in_array('administrator', $user->getRoles()) && !$isAdminPage){\n      $storage = \\Drupal::service('entity_type.manager')->getStorage('entity_form_display');\n      $form_display = $storage->load('user.user.front');\n    }\n  }\n}\n")),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Pour personnaliser la page profil :")),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"page--user--edit.html.twig est la page d'edition"),Object(o.b)("li",{parentName:"ul"},"form--user-form.html.twig contient les champs \xe0 personnaliser. Au lieu d'appeler ",Object(o.b)("inlineCode",{parentName:"li"},"{{children}}")," on peut choisir les champs de saisie \xe0 afficher (attention les 4 derniers champs sont obligatoires pour que le form fonctionne):")),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{}),"    {{element.account.current_pass}}\n    {{element.account.pass}}\n\n    {{element.actions}}\n    {{element.form_build_id}}\n    {{element.form_token}}\n    {{element.form_id}}\n")),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Enfin, chaque champ peut \xeatre personnalis\xe9 via twig (ie. form-element--current-pass-entity-user-edit-form.html.twig)")),Object(o.b)("h2",{id:"cr\xe9er-une-suggestion-sur-un-bouton-de-validation-dun-formulaire"},"Cr\xe9er une 'suggestion' sur un bouton de validation d'un formulaire"),Object(o.b)("p",null,"il est pr\xe9f\xe9rable de faire :"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{}),"  foreach (array_keys($form['actions']) as $action) {\n    if ($action != 'preview' && $form_id === 'user_form' && isset($form['actions'][$action]['#type']) && $form['actions'][$action]['#type'] === 'submit') {\n      $form['actions'][$action]['#submit'][] = '_montheme_user_edit_form_submit';\n    }\n  }\n")),Object(o.b)("p",null,"Plut\xf4t que :"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{}),"  if ($form_id === 'user_form') {\n    $form['#submit'][] = '_montheme_user_edit_form_submit';\n  }\n")),Object(o.b)("h2",{id:"r\xe9cup\xe9rer-lid-du-user-connect\xe9"},"R\xe9cup\xe9rer l'ID du user connect\xe9"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"A l'aide twig tweak :\n",Object(o.b)("inlineCode",{parentName:"li"},"drupal_token('current-user:uid')"))),Object(o.b)("h2",{id:"connaitre-le-r\xf4le-du-user"},"Connaitre le r\xf4le du user"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{}),"{% set roles = user.getroles(TRUE) %}\n{{ dump(roles) }} \n")),Object(o.b)("h2",{id:"tester-le-r\xf4le-du-user"},"tester le r\xf4le du user"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{}),"if 'role' in user.getroles()\n")),Object(o.b)("h2",{id:"d\xe9tecter-si-lutilisateur-est-logg\xe9-ou-non"},"D\xe9tecter si l'utilisateur est logg\xe9 ou non"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{}),"if (\\Drupal::currentUser()->isAnonymous()) {\n  // Anonymous user...\n}\n")),Object(o.b)("p",null,"en twig:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{})," {% if not logged_in %}\n ...\n {% endif %}\n")),Object(o.b)("h2",{id:"afficher-des-champs-custom-du-user"},"Afficher des champs custom du user"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{}),"{{ user.field_example.0.value }}\n")))}s.isMDXComponent=!0},176:function(e,r,t){"use strict";t.d(r,"a",(function(){return p})),t.d(r,"b",(function(){return m}));var n=t(0),i=t.n(n);function o(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function a(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function u(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?a(Object(t),!0).forEach((function(r){o(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function l(e,r){if(null==e)return{};var t,n,i=function(e,r){if(null==e)return{};var t,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||(i[t]=e[t]);return i}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var c=i.a.createContext({}),s=function(e){var r=i.a.useContext(c),t=r;return e&&(t="function"==typeof e?e(r):u({},r,{},e)),t},p=function(e){var r=s(e.components);return i.a.createElement(c.Provider,{value:r},e.children)},d={inlineCode:"code",wrapper:function(e){var r=e.children;return i.a.createElement(i.a.Fragment,{},r)}},b=Object(n.forwardRef)((function(e,r){var t=e.components,n=e.mdxType,o=e.originalType,a=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=s(t),b=n,m=p["".concat(a,".").concat(b)]||p[b]||d[b]||o;return t?i.a.createElement(m,u({ref:r},c,{components:t})):i.a.createElement(m,u({ref:r},c))}));function m(e,r){var t=arguments,n=r&&r.mdxType;if("string"==typeof e||n){var o=t.length,a=new Array(o);a[0]=b;var u={};for(var l in r)hasOwnProperty.call(r,l)&&(u[l]=r[l]);u.originalType=e,u.mdxType="string"==typeof e?e:n,a[1]=u;for(var c=2;c<o;c++)a[c]=t[c];return i.a.createElement.apply(null,a)}return i.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"}}]);