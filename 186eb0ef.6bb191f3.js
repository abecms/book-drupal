(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{138:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return i})),t.d(n,"metadata",(function(){return s})),t.d(n,"rightToc",(function(){return u})),t.d(n,"default",(function(){return c}));var r=t(1),a=t(9),o=(t(0),t(176)),i={},s={id:"dev/tests",title:"tests",description:"# Tests",source:"@site/docs/dev/tests.md",permalink:"/docs/dev/tests",sidebar:"docs",previous:{title:"debug",permalink:"/docs/dev/debug"}},u=[{value:"R\xe9aliser des tests behat",id:"r\xe9aliser-des-tests-behat",children:[]},{value:"Erreurs courantes",id:"erreurs-courantes",children:[{value:"502 bad gateway",id:"502-bad-gateway",children:[]},{value:"Erreurs de classes non trouv\xe9es quand on utilise Kint",id:"erreurs-de-classes-non-trouv\xe9es-quand-on-utilise-kint",children:[]}]}],l={rightToc:u};function c(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},l,t,{components:n,mdxType:"MDXLayout"}),Object(o.b)("h1",{id:"tests"},"Tests"),Object(o.b)("h2",{id:"r\xe9aliser-des-tests-behat"},"R\xe9aliser des tests behat"),Object(o.b)("p",null,"Installer behat"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"composer require --dev behat/behat dmore/behat-chrome-extension drupal/drupal-extension\n")),Object(o.b)("p",null,"Cr\xe9er \xe0 la racine de Drupal un fichier behat.yml (attention au chemin base_url du site et au path drupal_root de Drupal ):"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'default:\n  suites:\n    default:\n      contexts:\n        - FeatureContext\n        - Drupal\\DrupalExtension\\Context\\DrupalContext\n        - Drupal\\DrupalExtension\\Context\\MinkContext\n        - Drupal\\DrupalExtension\\Context\\MessageContext\n        - Drupal\\DrupalExtension\\Context\\DrushContext\n  gherkin:\n    cache: ~\n  extensions:\n    DMore\\ChromeExtension\\Behat\\ServiceContainer\\ChromeExtension: ~\n    Behat\\MinkExtension:\n      goutte: ~\n      base_url: http://ina.dev.dd:8083\n      show_cmd: google-chrome %s\n      javascript_session: chrome\n      chrome:\n        api_url: "http://localhost:9222"\n    Drupal\\DrupalExtension:\n      blackbox: ~\n      api_driver: drupal\n      drupal:\n        drupal_root: /Users/grg/programmation/acquia/sites/ina-dev/docroot\n      region_map:\n        header: "#header"\n        sidebar: "#sidebar-first"\n        content: "#content"\n        footer: ".site-footer"\n')),Object(o.b)("p",null,"Pour savoir si les commandes behat Drupal sont dispos :\n",Object(o.b)("inlineCode",{parentName:"p"},"vendor/bin/behat -dl")),Object(o.b)("p",null,"Pour cr\xe9er le r\xe9pertoire de features :\n",Object(o.b)("inlineCode",{parentName:"p"},"vendor/bin/behat --init")),Object(o.b)("p",null,"Cr\xe9er un fichier de tests dans le r\xe9pertoire features:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'Feature: Test DrupalContext\n    In order to prove the Drupal context using the blackbox driver is working properly\n    As a developer\n    I need to use the step definitions of this context\n\n    Scenario: Test the ability to find a heading in a region\n        Given I am on the homepage\n        When I click "Download & Extend"\n        Then I should see the heading "Core" in the "content" region\n\n    Scenario: Clicking content in a region\n        Given I am at "auteurs"\n        When I click "Afficher plus" in the "content" region\n        Then I should see "Page status" in the "right sidebar"\n        And I should see the link "Drupal News" in the "footer" region\n\n    Scenario: Viewing content in a region\n        Given I am on the homepage\n        Then I should see "Come for the software, stay for the community" in the "left header"\n\n    Scenario: Test ability to find text that should not appear in a region\n        Given I am on the homepage\n        Then I should not see the text "Proprietary software is cutting edge" in the "left header"\n\n    Scenario: Submit a form in a region\n        Given I am on the homepage\n        When I fill in "Search Drupal.org" with "Views" in the "right header" region\n        And I press "Search" in the "right header" region\n        Then I should see the text "Search again" in the "right sidebar" region\n\n    Scenario: Check a link should not exist in a region\n        Given I am on the homepage\n        Then I should not see the link "This link should never exist in a default Drupal install" in the "right header"\n\n    Scenario: Find a button\n        Given I am on the homepage\n        Then I should see the "Search" button\n\n    Scenario: Find a button in a region\n        Given I am on the homepage\n        Then I should see the "Search" button in the "right header"\n\n    Scenario: Find an element in a region\n        Given I am on the homepage\n        Then I should see the "h1" element in the "left header"\n')),Object(o.b)("p",null,"Pour jouer les tests :\n",Object(o.b)("inlineCode",{parentName:"p"},"vendor/bin/behat")),Object(o.b)("p",null,"jouer les tests sur browerstack"),Object(o.b)("h2",{id:"erreurs-courantes"},"Erreurs courantes"),Object(o.b)("h3",{id:"502-bad-gateway"},"502 bad gateway"),Object(o.b)("p",null,Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://www.drupal.org/project/drupal/issues/2241377"}),"https://www.drupal.org/project/drupal/issues/2241377"),"\n",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://www.drupal.org/project/drupal/issues/2527126"}),"https://www.drupal.org/project/drupal/issues/2527126"),"\nCe bug peut apparaitre quand le debug twig est activ\xe9 (pour afficher les templates twig utilis\xe9s directement dans le code html)\n",Object(o.b)("inlineCode",{parentName:"p"},"http.response.debug_cacheability_headers: true")," doit \xeatre activ\xe9\nQuand on utilise paragraphs, cela g\xe9n\xe8re \xe9norm\xe9ment de cl\xe9s de cache envoy\xe9es dans le header http ce que nginx ou autre n'aiment pas.\nPour r\xe9soudre:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"soit on d\xe9sactive cette option..."),Object(o.b)("li",{parentName:"ul"},"soit on agrandit le buffer. dans nginx, il faut ajouter dans la conf:")),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"    fastcgi_buffers 16 16k;\n    fastcgi_buffer_size 32k;\n")),Object(o.b)("h3",{id:"erreurs-de-classes-non-trouv\xe9es-quand-on-utilise-kint"},"Erreurs de classes non trouv\xe9es quand on utilise Kint"),Object(o.b)("p",null,"Il faut faire \xe7a: ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://www.drupal.org/files/issues/devel.ksm_.2857361.18.patch"}),"https://www.drupal.org/files/issues/devel.ksm_.2857361.18.patch")," dans la classe Kint de Drupal..."))}c.isMDXComponent=!0},176:function(e,n,t){"use strict";t.d(n,"a",(function(){return p})),t.d(n,"b",(function(){return b}));var r=t(0),a=t.n(r);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function u(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=a.a.createContext({}),c=function(e){var n=a.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s({},n,{},e)),t},p=function(e){var n=c(e.components);return a.a.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},h=Object(r.forwardRef)((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,l=u(e,["components","mdxType","originalType","parentName"]),p=c(t),h=r,b=p["".concat(i,".").concat(h)]||p[h]||d[h]||o;return t?a.a.createElement(b,s({ref:n},l,{components:t})):a.a.createElement(b,s({ref:n},l))}));function b(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=h;var s={};for(var u in n)hasOwnProperty.call(n,u)&&(s[u]=n[u]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var l=2;l<o;l++)i[l]=t[l];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,t)}h.displayName="MDXCreateElement"}}]);