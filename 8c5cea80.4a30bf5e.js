(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{160:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return l})),t.d(n,"metadata",(function(){return o})),t.d(n,"rightToc",(function(){return d})),t.d(n,"default",(function(){return u}));var r=t(1),a=t(9),i=(t(0),t(177)),l={},o={id:"dynamisation/nodes",title:"nodes",description:"# Nodes",source:"@site/docs/dynamisation/nodes.md",permalink:"/docs/dynamisation/nodes",sidebar:"docs",previous:{title:"seo",permalink:"/docs/config/seo"},next:{title:"paragraphs",permalink:"/docs/dynamisation/paragraphs"}},d=[{value:"Partage d&#39;un article",id:"partage-dun-article",children:[{value:"Share sur Facebook",id:"share-sur-facebook",children:[]},{value:"Share sur Twitter",id:"share-sur-twitter",children:[]},{value:"Share sur Linkedin",id:"share-sur-linkedin",children:[]},{value:"Share sur Whatsapp",id:"share-sur-whatsapp",children:[]},{value:"Share sur Messenger (\xe0 tester uniquement sur mobile)",id:"share-sur-messenger-\xe0-tester-uniquement-sur-mobile",children:[]}]},{value:"Traduire les textes d&#39;un th\xe8me",id:"traduire-les-textes-dun-th\xe8me",children:[]},{value:"Obtenir l&#39;URL / URI d&#39;un reference field en twig",id:"obtenir-lurl--uri-dun-reference-field-en-twig",children:[]},{value:"Champ de type liste",id:"champ-de-type-liste",children:[]},{value:"Champ de type lien",id:"champ-de-type-lien",children:[{value:"Afficher le titre d&#39;un champ de type lien",id:"afficher-le-titre-dun-champ-de-type-lien",children:[]},{value:"Tester si un champ de type lien est externe",id:"tester-si-un-champ-de-type-lien-est-externe",children:[]},{value:"Mettre l&#39;url d&#39;un champ de type lien (link)",id:"mettre-lurl-dun-champ-de-type-lien-link",children:[]}]},{value:"Formater une date dans Twig",id:"formater-une-date-dans-twig",children:[]},{value:"Connaitre les jours de diff\xe9rence entre 2 dates",id:"connaitre-les-jours-de-diff\xe9rence-entre-2-dates",children:[]},{value:"R\xe9cup\xe9rer et formater la date de cr\xe9ation et modification d&#39;un node",id:"r\xe9cup\xe9rer-et-formater-la-date-de-cr\xe9ation-et-modification-dun-node",children:[]},{value:"Afficher l&#39;url d&#39;un node",id:"afficher-lurl-dun-node",children:[]},{value:"Truncate un champ pour afficher un r\xe9sum\xe9",id:"truncate-un-champ-pour-afficher-un-r\xe9sum\xe9",children:[]},{value:"Afficher l&#39;url d&#39;une vue",id:"afficher-lurl-dune-vue",children:[]},{value:"Afficher un node suivant un display mode",id:"afficher-un-node-suivant-un-display-mode",children:[]},{value:"Deux affichages diff\xe9rents pour un m\xeame node",id:"deux-affichages-diff\xe9rents-pour-un-m\xeame-node",children:[]},{value:"Ajouter une classe sur un field",id:"ajouter-une-classe-sur-un-field",children:[]},{value:"Retrouver le nombre d&#39;\xe9l\xe9ments d&#39;un field",id:"retrouver-le-nombre-d\xe9l\xe9ments-dun-field",children:[]},{value:"Import de texte dans un ckeditor",id:"import-de-texte-dans-un-ckeditor",children:[]},{value:"Lister les entit\xe9s r\xe9f\xe9renc\xe9es",id:"lister-les-entit\xe9s-r\xe9f\xe9renc\xe9es",children:[]},{value:"Cr\xe9er un node par programmation",id:"cr\xe9er-un-node-par-programmation",children:[]},{value:"upload de fichier de puis le front",id:"upload-de-fichier-de-puis-le-front",children:[]},{value:"R\xe9cup\xe9rer l&#39;ID de l&#39;auteur d&#39;un node",id:"r\xe9cup\xe9rer-lid-de-lauteur-dun-node",children:[]},{value:"Appeler un node (ou une autre URL) en popin",id:"appeler-un-node-ou-une-autre-url-en-popin",children:[]},{value:"Creation du role contributor",id:"creation-du-role-contributor",children:[]},{value:"Autorisation pour acc\xe9der au site",id:"autorisation-pour-acc\xe9der-au-site",children:[]}],c={rightToc:d};function u(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(i.b)("wrapper",Object(r.a)({},c,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)("h1",{id:"nodes"},"Nodes"),Object(i.b)("h2",{id:"partage-dun-article"},"Partage d'un article"),Object(i.b)("h3",{id:"share-sur-facebook"},"Share sur Facebook"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"<a href=\"//www.facebook.com/sharer/sharer.php?u={{ url('entity.node.canonical', {'node': node.id}) }}\" target=\"_blank\">")),Object(i.b)("h3",{id:"share-sur-twitter"},"Share sur Twitter"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"<a href=\"//twitter.com/home?status={{ url('entity.node.canonical', {'node': node.id}) }}\" target=\"_blank\">")),Object(i.b)("h3",{id:"share-sur-linkedin"},"Share sur Linkedin"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"<a href=\"//www.linkedin.com/shareArticle?mini=true&url={{ url('entity.node.canonical', {'node': node.id}) }}\" target=\"_blank\">")),Object(i.b)("h3",{id:"share-sur-whatsapp"},"Share sur Whatsapp"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"<a href=\"whatsapp://send?text={{ url('entity.node.canonical', {'node': node.id}) }}\">")),Object(i.b)("h3",{id:"share-sur-messenger-\xe0-tester-uniquement-sur-mobile"},"Share sur Messenger (\xe0 tester uniquement sur mobile)"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Necessite d'avoir une app_id valide\n",Object(i.b)("inlineCode",{parentName:"li"},"<a href=\"fb-messenger://share/?link={{ url('entity.node.canonical', {'node': node.id}) }}&app_id=1959734180995099\"> "))),Object(i.b)("h2",{id:"traduire-les-textes-dun-th\xe8me"},"Traduire les textes d'un th\xe8me"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"title=\"{{ 'Go to next page'|t }}")),Object(i.b)("p",null,"Lorsque le code a \xe9t\xe9 livr\xe9 pour pouvoir le saisir en BO, il faut :"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Vider le cache")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Aller sur la page o\xf9 la traduction est pr\xe9sente")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Vider le cache \xe0 nouveau"))),Object(i.b)("p",null,"Pour saisir les traduction, il faut se rendre sur le BO :"),Object(i.b)("p",null,"Configuration => Regional and language => User interface translation"),Object(i.b)("p",null,"Rechercher le texte \xe0 traduire (Go to next page dans l'exemple)  et la langue souhait\xe9e  et saisir la valeur attendue."),Object(i.b)("h2",{id:"obtenir-lurl--uri-dun-reference-field-en-twig"},"Obtenir l'URL / URI d'un reference field en twig"),Object(i.b)("p",null,"The url is not an entity field, so you can't access it directly. Also the entity methods to generate url/links are not accessible in Twig because of the sandbox policies. You can build a path though, if you have the id of the referenced node:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"{% if not node.field_ref.isempty %}\n  {{ path('entity.node.canonical', {'node':  node.field_ref.entity.id}) }}\n{% endif %}\n")),Object(i.b)("h2",{id:"champ-de-type-liste"},"Champ de type liste"),Object(i.b)("p",null,"To get the value of a list element :"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"{{ node.field_bottle_format.value }}\n")),Object(i.b)("p",null,"To get the label :"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"{% set list_value = node.field_bottle_format.value %}\n{{ node.field_bottle_format.getSetting('allowed_values')[list_value] }}\n")),Object(i.b)("p",null,"If the field has multiple values :"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"{% set allowed_values = node.filter_list.getSetting('allowed_values') %}\n  {% set list_values = node.filter_list.getValue() %}\n  {% for list_value in list_values %}\n    <div>\n      {{ allowed_values[list_value['value']] }}\n    </div>\n{% endfor %}\n")),Object(i.b)("h2",{id:"champ-de-type-lien"},"Champ de type lien"),Object(i.b)("h3",{id:"afficher-le-titre-dun-champ-de-type-lien"},"Afficher le titre d'un champ de type lien"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"field_link.title\n")),Object(i.b)("h3",{id:"tester-si-un-champ-de-type-lien-est-externe"},"Tester si un champ de type lien est externe"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"field_link.0.url.isExternal()\n")),Object(i.b)("h3",{id:"mettre-lurl-dun-champ-de-type-lien-link"},"Mettre l'url d'un champ de type lien (link)"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"{{node.field_url_offre.0.url}}\n")),Object(i.b)("h2",{id:"formater-une-date-dans-twig"},"Formater une date dans Twig"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),'{{ node.field_date.value | date(\'U\') | format_date("custom", "l d F") }} pour personnaliser une date\n')),Object(i.b)("h2",{id:"connaitre-les-jours-de-diff\xe9rence-entre-2-dates"},"Connaitre les jours de diff\xe9rence entre 2 dates"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"{% set difference = datePlusGrande - datePlusPetite %}\n")),Object(i.b)("h5",{id:"pour-afficher-les-jours-"},"Pour afficher les jours :"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"{% set leftDays = (difference / 60 / 60 / 24)|round(0, 'common') %}\n")),Object(i.b)("h5",{id:"pour-afficher-les-heures"},"Pour afficher les heures:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"{% set leftDays = (difference / 60 / 60 / 24)|round(3, 'common') %}\n{% set heures = leftDays|split('.') %}\n\n{{(heures.1 * 0.024)|round(0, 'ceil') }}\n\n")),Object(i.b)("h2",{id:"r\xe9cup\xe9rer-et-formater-la-date-de-cr\xe9ation-et-modification-dun-node"},"R\xe9cup\xe9rer et formater la date de cr\xe9ation et modification d'un node"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),'{{ node.created.value | date(\'U\') | format_date("custom", "d F Y") }}\n{{ node.changed.value | date(\'U\') | format_date("custom", "d F Y") }}\n')),Object(i.b)("h2",{id:"afficher-lurl-dun-node"},"Afficher l'url d'un node"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"{{ path('entity.node.canonical', {'node': node.title.entity.id}) }}\n")),Object(i.b)("h2",{id:"truncate-un-champ-pour-afficher-un-r\xe9sum\xe9"},"Truncate un champ pour afficher un r\xe9sum\xe9"),Object(i.b)("p",null,"Il suffit de choisir l'option \"coup\xe9\" dans le format au niveau du format d'affichage du node.\nOn utilisera alors ",Object(i.b)("inlineCode",{parentName:"p"},"{{content.field_name}}")," pour l'afficher"),Object(i.b)("h2",{id:"afficher-lurl-dune-vue"},"Afficher l'url d'une vue"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"{{ path('view.nom_machine_de_la_vue.page_1') }}\n")),Object(i.b)("p",null,"(page_1 correspond \xe0 l'id de la page de la vue). Utiliser un tel chemain est tr\xe8s important pour les traductions puisque le chemin propos\xe9 sera automatiquement dans celui de la langue."),Object(i.b)("h2",{id:"afficher-un-node-suivant-un-display-mode"},"Afficher un node suivant un display mode"),Object(i.b)("p",null,"A l'aide de Twig tweak :"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"{{ drupal_entity('node', monNodeId, 'teaser') }}\n")),Object(i.b)("h2",{id:"deux-affichages-diff\xe9rents-pour-un-m\xeame-node"},"Deux affichages diff\xe9rents pour un m\xeame node"),Object(i.b)("p",null,"Pour pouvoir avoir 2 urls diff\xe9rentes pour un m\xeame node, utiliser le module ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://www.drupal.org/project/view_mode_page"}),"https://www.drupal.org/project/view_mode_page")),Object(i.b)("h2",{id:"ajouter-une-classe-sur-un-field"},"Ajouter une classe sur un field"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},'Pour ajouter une classe "cp-box__btn" sur le lien des field_tags, montheme.theme doit \xeatre modifi\xe9:')),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"function montheme_preprocess_field(&$variables, $hook) {\n  $element = $variables[\"element\"];\n  $name    = $element[\"#field_name\"];\n\n  switch($name){\n    case 'field_tags' :\n      foreach ($variables['items'] as $index => $item) {\n        $variables['items'][$index]['content']['#options']['attributes']['class'][] = 'cp-box__btn';\n      }\n    break;\n  }\n}\n")),Object(i.b)("h2",{id:"retrouver-le-nombre-d\xe9l\xe9ments-dun-field"},"Retrouver le nombre d'\xe9l\xe9ments d'un field"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"{{ kint(row.content['#flagging'].getIterator().field_liens) }}")),Object(i.b)("h2",{id:"import-de-texte-dans-un-ckeditor"},"Import de texte dans un ckeditor"),Object(i.b)("p",null,"Drupal 8 propose des filtres pour modifier du contenu de l'admin vers le front : On met par exemple un tag ",Object(i.b)("inlineCode",{parentName:"p"},"<fn>")," dans son texte en admin et cela devient un\n",Object(i.b)("inlineCode",{parentName:"p"},'<span class="footnote">')," sur le front."),Object(i.b)("p",null,"Pour cr\xe9er des filtres, cf. le module customization\nPour ex\xe9cuter ces filtres sur un texte avant de le sauvegarder lors d'un import par exemple :\n",Object(i.b)("inlineCode",{parentName:"p"},"check_markup($article['content'], 'html_complet')")),Object(i.b)("h2",{id:"lister-les-entit\xe9s-r\xe9f\xe9renc\xe9es"},"Lister les entit\xe9s r\xe9f\xe9renc\xe9es"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"/** @var \\Drupal\\Core\\Field\\EntityReferenceFieldItemList $articles */\n$articles = $basic_page->get('field_articles');\n\n/** @var \\Drupal\\node\\Entity\\Node $article */\nforeach ($articles->referencedEntities() as $article) {\n  $article_titles[] = $article->getTitle();\n}\n")),Object(i.b)("p",null,"Pour les paragraphes:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"/** @var \\Drupal\\entity_reference_revisions\\EntityReferenceRevisionsFieldItemList $votes */\n$votes = $basic_page->get('field_votes');\n\n/** @var \\Drupal\\paragraphs\\Entity\\Paragraph $vote */\nforeach ($votes->referencedEntities() as $vote) {\n  $total_votes += $vote->field_vote->value;\n}\n")),Object(i.b)("h2",{id:"cr\xe9er-un-node-par-programmation"},"Cr\xe9er un node par programmation"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"aller chercher une image via URL et la sauvegarder"),Object(i.b)("li",{parentName:"ul"},"rechercher un terme dans une taxonomie")),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"$existingTerms = \\Drupal::entityTypeManager()->getStorage('taxonomy_term')->loadTree('departement_entite');\n$found = null;\nforeach ($existingTerms as $existingTerm) {\n  if ($existingTerm->name == 'ISH') {\n    $found = $existingTerm->tid;\n    break;\n  }\n}\n$nodeArray = [\n    'type'                        => 'article',\n    'title'                       => 'title',\n    'field_link_cyberce'          => 'link',\n    'field_chapo'                 => 'description',\n    'status'                      => 0,\n    'field_departements_entites'  => [['target_id' => $found]],\n    'uid'                         => 1\n  ];\n  $file_info = system_retrieve_file($article['image'], 'public://pictures/', TRUE, FILE_EXISTS_RENAME);\n  if($file_info->id()){\n    $styles = ImageStyle::loadMultiple();\n    $image_uri = $file_info->getFileUri();\n    foreach ($styles as $style) {\n      $destination = $style->buildUri($image_uri);\n      $style->createDerivative($image_uri, $destination);\n    }\n    $nodeArray['field_image'] = ['target_id' => $file_info->id()];\n  }\n  $node = Node::create($nodeArray);\n  $node->save();\n}\n")),Object(i.b)("h2",{id:"upload-de-fichier-de-puis-le-front"},"upload de fichier de puis le front"),Object(i.b)("p",null,"Pour permettre l'upload de fichier depuis le front et associer ces fichiers \xe0 un node, voici comment proc\xe9der (nous utilisons dropzone et axios dans cet exemple, mais il est possible d'utiliser une autre librairie ou un input de type file):"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Cr\xe9er un champ de type File dans le node souhait\xe9 (on peut autoriser plusieurs valeurs ",Object(i.b)("inlineCode",{parentName:"li"},"Allowed number of values"),")"),Object(i.b)("li",{parentName:"ol"},"Activer le module JSON:API et activer ",Object(i.b)("inlineCode",{parentName:"li"},"Accept all JSON:API create, read, update, and delete operations.")),Object(i.b)("li",{parentName:"ol"},"Dans le fichier du theme ",Object(i.b)("inlineCode",{parentName:"li"},"mytheme.libraries.yml")," ajouter les d\xe9pendances dropzone :")),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"global-styling:\n  Version: 1.x\n  css:\n    theme:\n      ...\n      https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.7.2/dropzone.min.css: {}\n  js:\n    ...\n    https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.7.2/min/dropzone.min.js: { type: external, minified: true }\n    https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js: { type: external, minified: true }\n")),Object(i.b)("ol",{start:4},Object(i.b)("li",{parentName:"ol"},"Dans votre twig node, voici un exemple pour un champ de node de type file appel\xe9 ici ",Object(i.b)("inlineCode",{parentName:"li"},"field_presentation"),". Noter le premier appel pour r\xe9cup\xe9rer un csrf-token puis les headers et ",Object(i.b)("inlineCode",{parentName:"li"},"axios.defaults.withCredentials = true")," (essentiels) pour que Drupal autorise l'upload.")),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),'<form action="/jsonapi/node/brand_plan/4a0d2604-3f00-437a-9fb0-06bea9321021/field_presentation" class="dropzone" id="MyDropzone">\n    <div class="fallback">\n        <input name="file" type="file" multiple/>\n    </div>\n</form>\n\n\n<script>\ndocument.addEventListener("DOMContentLoaded", function(event) {\n    var csrfToken = \'\'\n    jQuery.get(Drupal.url(\'session/token\'))\n        .done(function (token) {\n            console.log(\'token\', token);\n            csrfToken = token\n        })\n\n    Dropzone.options.MyDropzone = {\n        autoProcessQueue : false,\n        dictDefaultMessage: "Drop files or click here to upload a new DICOM series ...",\n        init : function() {\n\n            myDropzone = this;\n\n            //Restore initial message when queue has been completed\n            this.on("addedfiles", function(event) {\n                console.log(myDropzone.files);\n                let file = myDropzone.files[0];\n                let filename = file.name;\n                var reader = new FileReader();\n                reader.readAsArrayBuffer(file);\n\n                reader.onabort = () => console.log(\'file reading was aborted\')\n                reader.onerror = () => console.log(\'file reading has failed\')\n                reader.onload = () => {\n                    const arrayStr = reader.result;\n                    axios.defaults.withCredentials = true\n                    axios.post(\'/jsonapi/node/brand_plan/4a0d2604-3f00-437a-9fb0-06bea9321021/field_presentation\',\n                        arrayStr\n                        , {\n                            headers: {\n                                "Content-Type": "application/octet-stream",\n                                "Accept": "application/vnd.api+json",\n                                "Content-Disposition": \'file; filename="\' + filename + \'"\',\n                                \'X-CSRF-Token\': csrfToken,\n                            }\n                        }\n                    )\n                    .then((response) => {\n                        console.log(response);\n                    })\n                    .catch(function (error) {\n                        console.log(error);\n                    }.bind(this));\n                }\n            });\n        }\n    };\n});\n<\/script>\n')),Object(i.b)("h2",{id:"r\xe9cup\xe9rer-lid-de-lauteur-dun-node"},"R\xe9cup\xe9rer l'ID de l'auteur d'un node"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"node.getOwnerId()\n")),Object(i.b)("h2",{id:"appeler-un-node-ou-une-autre-url-en-popin"},"Appeler un node (ou une autre URL) en popin"),Object(i.b)("p",null,"Drupal8 le g\xe8re de base. Il faut faire \xe7a :"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),'<a href="/node/16/register/registration_type_1" class="use-ajax" data-dialog-type="modal">\n')),Object(i.b)("p",null,"La librairie jqueryUI est utilis\xe9e dans ce cas."),Object(i.b)("p",null,"Et pour resizer automatiquement la modale, utiliser ce script js :"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"Drupal.behaviors.provider = {\n    attach: function (context, settings) {\n        jQuery(\"#drupal-modal\").dialog({height:'auto', width:'50%'});\n    }\n};\n")),Object(i.b)("h1",{id:"variables-globales-par-environnement"},"Variables globales par environnement"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"S\xe9parer les environnement dans settings.php (cf. clef GA dans le projet energyObs) :")),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"switch ($_SERVER['HTTP_HOST']) {\n  default:\n  case 'energyobsyzpt9flua4.devcloud.acquia-sites.com':\n    // Dev env\n     $settings['gaKey'] = 'UA-141900936-1';\n    break;\n  case 'energyobsyrw6e2rkmk.devcloud.acquia-sites.com':\n    // Stage env\n    $settings['gaKey'] = 'UA-141900936-1';\n    break;\n  case 'energy-observer.media':\n    // Prod env\n    $settings['gaKey'] = 'UA-90169649-2';\n    break;\n}\n")),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Dans le fichier .theme :")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"ajouter la librairie Settings => ",Object(i.b)("inlineCode",{parentName:"li"},"use Drupal\\Core\\Site\\Settings;")),Object(i.b)("li",{parentName:"ul"},"r\xe9cup\xe9rer la variable instanci\xe9e dans settings.php => ",Object(i.b)("inlineCode",{parentName:"li"},"$gaKey = Settings::get('gaKey', '');")),Object(i.b)("li",{parentName:"ul"},"cr\xe9er/modifier une variable afin de r\xe9cup\xe9rer sa valeur en twig => ",Object(i.b)("inlineCode",{parentName:"li"},"$vars['gaKey'] = $gaKey;")),Object(i.b)("li",{parentName:"ul"})),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"function solutions_preprocess_html(&$vars) {\n  $gaKey = Settings::get('gaKey', '');\n  $vars['gaKey'] = $gaKey;\n\n  if (!empty($_GET['video'])) {\n    $media = Media::load($_GET['video']);\n    //Kint::dump($media->get('field_title')[0]->getValue()['value']);\n    if ($media) {\n        $vars['get']['video']['id'] = $_GET['video'];\n        $vars['get']['video']['title'] = $media->get('field_title')[0]->getValue()['value'];\n        $vars['get']['video']['image'] = file_create_url($media->get('field_media_image')->entity->getFileUri());\n        $vars['get']['video']['description'] = strip_tags($media->get('field_description')[0]->getValue()['value']);\n        $vars['get']['video']['url'] = file_create_url($media->get('field_media_video_file')->entity->getFileUri());\n    }\n  }\n}\n")),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"dans le twig => ",Object(i.b)("inlineCode",{parentName:"li"},"{{ gaKey }}"))),Object(i.b)("h1",{id:"preview-type-de-contenu"},"Preview type de contenu"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},'cocher "facultatif" dans la section "Apercu avant soumission" dans : structure > type de contenu > (exp: \'article\') > modifier')),Object(i.b)("h1",{id:"acces-sp\xe9cifique-\xe0-la-modification-dun-node"},"Acces sp\xe9cifique \xe0 la modification d'un node."),Object(i.b)("p",null,"On va utiliser le module ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://www.drupal.org/project/nodeaccess"}),"nodeaccess")," dont la config se trouve ici :",Object(i.b)("inlineCode",{parentName:"p"},"admin/config/people/nodeaccess")),Object(i.b)("p",null,"Ce module va nous permettre de donner des droits sp\xe9cifiques par type de contenu et/ou par node. Bref s\xe9curiser un node."),Object(i.b)("p",null,"On peut m\xeame aller jusqu'\xe0 donner acc\xe8s \xe0 1 user \xe0 1 node."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Cr\xe9ation d'un role. ",Object(i.b)("inlineCode",{parentName:"li"},"/admin/people/roles/add"))),Object(i.b)("p",null,"Dans la config du module nodeaccess ",Object(i.b)("inlineCode",{parentName:"p"},"admin/config/people/nodeaccess")," on va dire \xe0 quel type de contenu ce role \xe0 Acc\xe8s."),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Allowed Grants - Quel type de droit modifiable dans l'onglet Grants")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"View"),Object(i.b)("li",{parentName:"ul"},"Edit"),Object(i.b)("li",{parentName:"ul"},"Delete")),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Allowed Roles - Quel Type de role peuvent \xeatre customisables")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Authenticated user"),Object(i.b)("li",{parentName:"ul"},"Administrator"),Object(i.b)("li",{parentName:"ul"},"Utilisateur invit\xe9"),Object(i.b)("li",{parentName:"ul"},"Administrateur r\xe9gion"),Object(i.b)("li",{parentName:"ul"},"Maison Krug Market All Admin"),Object(i.b)("li",{parentName:"ul"},"Maison Krug Market De Contributor\n...")),Object(i.b)("p",null,"Ensuite par type de contenu choisir les roles.\nPensez \xe0 cocher dans le type de contenu souhait\xe9 ",Object(i.b)("inlineCode",{parentName:"p"},"Show grant tab for this node type"),"\nCela permet dans un contenu/node de sp\xe9cifier les droits."),Object(i.b)("p",null,"Dans le contenu de votre choix il y a un onglet ",Object(i.b)("inlineCode",{parentName:"p"},"Grants"),".\nVous pouvez m\xeame aller jusqu'\xe0 accorder l'acc\xe8s ou la modification \xe0 un seul user sur un contenu !."),Object(i.b)("h2",{id:"creation-du-role-contributor"},"Creation du role contributor"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Ajouter un r\xf4le - ie Maison Moet Marche DE Contributor"),Object(i.b)("li",{parentName:"ol"},"Ajouter permission n\xe9cessaire - d\xe9pend du projet")),Object(i.b)("p",null,"Dans le config du module nodeaccess il faut autoriser le nouveau r\xf4le"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Dans ",Object(i.b)("inlineCode",{parentName:"li"},"admin/config/people/nodeaccess")," dans ",Object(i.b)("inlineCode",{parentName:"li"},"Allowed Roles")," et cocher le nouveau role\nEnsuite il pourra \xeatre affect\xe9 \xe0 un node.")),Object(i.b)("h2",{id:"autorisation-pour-acc\xe9der-au-site"},"Autorisation pour acc\xe9der au site"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Cr\xe9er un contenu de type Brand Plan"),Object(i.b)("li",{parentName:"ol"},"l'apeller ",Object(i.b)("inlineCode",{parentName:"li"}," Moet DE - My Brand Plan")),Object(i.b)("li",{parentName:"ol"},"Dans l'onglet ",Object(i.b)("inlineCode",{parentName:"li"},"Grants")," Cocher :")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"View")," et ",Object(i.b)("inlineCode",{parentName:"li"},"Edit")," pour Maison Moet Marche DE Contributor"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"View")," pour Maison Moet Marche DE Reader")))}u.isMDXComponent=!0},177:function(e,n,t){"use strict";t.d(n,"a",(function(){return s})),t.d(n,"b",(function(){return m}));var r=t(0),a=t.n(r);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function d(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=a.a.createContext({}),u=function(e){var n=a.a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):o({},n,{},e)),t},s=function(e){var n=u(e.components);return a.a.createElement(c.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},b=Object(r.forwardRef)((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=d(e,["components","mdxType","originalType","parentName"]),s=u(t),b=r,m=s["".concat(l,".").concat(b)]||s[b]||p[b]||i;return t?a.a.createElement(m,o({ref:n},c,{components:t})):a.a.createElement(m,o({ref:n},c))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,l=new Array(i);l[0]=b;var o={};for(var d in n)hasOwnProperty.call(n,d)&&(o[d]=n[d]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var c=2;c<i;c++)l[c]=t[c];return a.a.createElement.apply(null,l)}return a.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"}}]);